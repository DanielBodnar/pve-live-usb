<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.3, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Fdutils</title>

<meta name="description" content="Fdutils">
<meta name="keywords" content="Fdutils">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#Location" rel="start" title="Location">
<link href="#Command-Index" rel="index" title="Command Index">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<h1 class="settitle" align="center">Fdutils</h1>










<a name="General-Introduction"></a>
<div class="header">
<p>
Next: <a href="#Basic-usage" accesskey="n" rel="next">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<h2 class="unnumbered">General Introduction</h2>

<p>Fdutils is a collection of utilities for configuring and using the
Linux floppy driver.  With fdutils, you can:
</p>
<ol>
<li> Format disks with a higher capacity than usual (up to 1992KB on a 3 1/2
HD disk).
</li><li> Reconfigure the autodetection sequence to automatically detect some of
these extended formats.
</li><li> Access various internal driver structures and drive configuration using
the floppycontrol program.
</li></ol>

<p>This manual describes these utilities, and also the floppy driver
itself.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Location" accesskey="1">Location</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Where to get fdutils and its documentation
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Basic-usage" accesskey="2">Basic usage</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How to get started
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Device-numbers" accesskey="3">Device numbers</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Media-description" accesskey="4">Media description</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How can a floppy disk and a format be described
                               to fdutils?
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Drive-descriptions" accesskey="5">Drive descriptions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How can a drive and its characteristics be 
                               described to fdutils?
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Extended-formats" accesskey="6">Extended formats</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How to store more data on your floppy disks
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Autodetection" accesskey="7">Autodetection</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How the floppy driver distinguishes among the
                               different kinds of disks
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Boottime-configuration" accesskey="8">Boottime configuration</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Lilo boot options understood by the floppy driver
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Floppy-ioctls" accesskey="9">Floppy ioctls</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">The ioctl&rsquo;s understood by the floppy driver
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Commands">Commands</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">The available fdutils commands
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Compile_002dtime-configuration">Compile-time configuration</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How to use GNU autoconf to customize fdutils
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Acronyms">Acronyms</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">A brief listing of acronyms used in this
                               documentation
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Interesting-formats">Interesting formats</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">A brief list of legacy and other formats
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Command-Index">Command Index</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Command Index
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Concept-Index">Concept Index</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Concept Index
</td></tr>
</table>



<a name="Location"></a>
<a name="Where-to-get-fdutils-and-its-documentation"></a>
<h2 class="chapter">1 Where to get fdutils and its documentation</h2>
<a name="index-bugs"></a>
<a name="index-ALPHA-patches"></a>
<a name="index-patches"></a>
<a name="index-diffs"></a>
<a name="index-mailing-list"></a>

<p>Fdutils can be found at the following places (+ mirrors):
</p><div class="example">
<pre class="example">ftp://www.tux.org/pub/knaff/fdutils/fdutils-5.5.tar.gz
ftp://metalab.unc.edu/pub/Linux/utils/disk-management/fdutils-5.5.tar.gz
ftp://tsx-11.mit.edu/pub/linux/sources/sbin/fdutils-5.5.tar.gz
</pre></div>

<p>The FAQ included in this package is also available separately at:
</p><div class="example">
<pre class="example">http://alain.knaff.linux.lu/floppy/FAQ.html
http://www.tux.org/pub/knaff/floppy/FAQ.html
</pre></div>
<p>The FAQ at fdutils.linux.lu and www.tux.org is usually more up to date
than versions found elsewhere.  Thus, if you don&rsquo;t find an answer in the
copy of the FAQ you have, please check this one for more recent info.
</p>
<p>Before reporting a bug, make sure that it has not yet been fixed in the
Alpha patches which can be found at:
</p><div class="example">
<pre class="example">http://fdutils.linux.lu
ftp://www.tux.org/pub/knaff/fdutils
</pre></div>

<p>These patches are named
<code>fdutils-</code><var>version</var><code>-</code><var>ddmm</var><code>.taz</code>, where version
stands for the base version, <var>dd</var> for the day and <var>mm</var> for the
month. Due to a lack of space, I usually leave only the most recent
patch.
</p>
<p>There is an fdutils mailing list at fdutils @ www.tux.org .  Please
send all bug reports to this list.  You may subscribe to the list by
sending a message with &rsquo;subscribe fdutils @ www.tux.org&rsquo; in its
body to majordomo @ www.tux.org . (N.B. Please remove the spaces
around the &quot;@&quot; both times. I left them there in order to fool
spambots.)  Announcements of new fdutils versions will also be sent to
the list, in addition to the linux announce newsgroups.  The mailing
list is archived at http://www.tux.org/hypermail/fdutils/latest
</p><hr>
<a name="Basic-usage"></a>
<div class="header">
<p>
Next: <a href="#Device-numbers" accesskey="n" rel="next">Device numbers</a>, Previous: <a href="#Location" accesskey="p" rel="prev">Location</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Basic-usage-1"></a>
<h2 class="chapter">2 Basic usage</h2>

<p>This chapter describes basic usage of floppies, and gives a few simple
tips for using floppies under Linux.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Disk-organisation" accesskey="1">Disk organisation   </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How a disk is organized, high-level and low-level
                         formats
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#File-systems" accesskey="2">File systems        </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Which file systems does Linux support
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Device-names" accesskey="3">Device names        </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How floppy drives are named
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Identifying-disks" accesskey="4">Identifying disks   </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How to identify a disk
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Nickel-tours" accesskey="5">Nickel tours        </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Short summaries of the various storage methods
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#New-features" accesskey="6">New features        </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">New features of the kernel, mtools, and fdutils
</td></tr>
</table>

<hr>
<a name="Disk-organisation"></a>
<div class="header">
<p>
Next: <a href="#File-systems" accesskey="n" rel="next">File systems</a>, Previous: <a href="#Basic-usage" accesskey="p" rel="prev">Basic usage</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="How-disks-are-organized"></a>
<h3 class="section">2.1 How disks are organized</h3>
<a name="index-low-level-format"></a>
<a name="index-format-_0028low-level-vs_002e-high-level_0029"></a>
<a name="index-high-level-format"></a>

<p>All floppies have two levels of <em>formatting</em>, both of which must be
known in order to read them.  The first is the <em>binary</em> or
<em>sector</em> level format, which is how raw data is stored on the disk.
The second is a higher level organization, often called a <em>file
system</em>, which allows multiple files to be conveniently stored on the
disk.
</p>
<p>For example, a typical 1.44MB disk contains a low-level format, with 18
sectors per track, 80 tracks, and two sides (or heads); each sector can
hold 512 bytes of data for a total of 1474560 bytes (or 1440 KB).  When
used under MS-DOS, this floppy would have a small portion of the disk
used to keep track of files on the disk (including a bootsector, file
allocation tables, directories, etc.).
</p>
<p>The floppy driver generally takes care of reading the binary, or
low-level format.  It can often &quot;guess&quot; the low-level disk geometry
needed to read the disk.  This is called autodetection
(see <a href="#Autodetection">Autodetection</a>).  If the driver can&rsquo;t autodetect the disk
(e.g. if it is in an unusual format) you can tell the driver what the
geometry is either by using the <code>setfdprm</code> (see <a href="#setfdprm">setfdprm</a>)
utility or by using a fixed geometry device device
(e.g. <samp>/dev/fd0H1440</samp>).
</p>
<p>Under Linux, many different file systems from many sources can be used.
Some of these file systems are interpreted via a utility program (for
example <code>mtools</code> for using disks with an MS-DOS file system).  Many
file systems can alternatively be &quot;mounted&quot; to appear in the UNIX
directory structure until subsequently being unmounted; this is usually
implemented by having the kernel itself interpret the file system on the
disk.
</p>
<hr>
<a name="File-systems"></a>
<div class="header">
<p>
Next: <a href="#Device-names" accesskey="n" rel="next">Device names</a>, Previous: <a href="#Disk-organisation" accesskey="p" rel="prev">Disk organisation</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="File-systems-supported-by-Linux"></a>
<h3 class="section">2.2 File systems supported by Linux</h3>
<a name="index-supported-file-systems"></a>
<a name="index-file-systems-supported-by-linux"></a>

<p>The following file systems are supported:
</p>
<dl compact="compact">
<dt><strong>OS/2 HPFS:</strong></dt>
<dd><p>read-only support (mount/kernel)
</p></dd>
<dt><strong>Mac HPFS 1.44MB:</strong></dt>
<dd><p>read-only (xhfs utility)
</p></dd>
<dt><strong>MS-DOS:</strong></dt>
<dd><p>read, write, format (mtools utility <em>and</em> mount/kernel)
</p></dd>
<dt><strong>tar, cpio:</strong></dt>
<dd><p>compatible with many variations of UNIX (tar, cpio utilities)
</p></dd>
<dt><strong>System V, minix, xia, ext, ext2:</strong></dt>
<dd><p>(mount/kernel)
</p></dd>
<dt><strong>pure binary disk access:</strong></dt>
<dd><p>no file system (any program, usually dd, cat, and cp)
</p></dd>
</dl>

<hr>
<a name="Device-names"></a>
<div class="header">
<p>
Next: <a href="#Identifying-disks" accesskey="n" rel="next">Identifying disks</a>, Previous: <a href="#File-systems" accesskey="p" rel="prev">File systems</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="What_0027s-in-a-name"></a>
<h3 class="section">2.3 What&rsquo;s in a name</h3>
<a name="index-floppy-device-name"></a>
<a name="index-file-name-of-floppy-devices"></a>
<a name="index-name-of-floppy-devices"></a>

<p>The following figure shows the meaning of the different parts of the
name of a floppy device:
</p>
<div class="example">
<pre class="example"> +--------------- /dev: directory for devices
 |   +------------- fd: floppy disk device prefix
 |   | +------------ 0: floppy drive #0 (A:) (0-1 typical, 0-7
 |   | |                possible)
 |   | |+-- 3.5&quot; drive: (use d for 5.25&quot; double density drives, and
 |   | ||                    h for 5.25&quot; high density drives,
 |   | ||                    u for 3.5&quot; drive of any density)
 |   | ||   +---- 1440: Capacity (in KB) of format (usually between
 |   | ||   |           360 and 3920)
/dev/fd0u1440
</pre></div>


<hr>
<a name="Identifying-disks"></a>
<div class="header">
<p>
Next: <a href="#Nickel-tours" accesskey="n" rel="next">Nickel tours</a>, Previous: <a href="#Device-names" accesskey="p" rel="prev">Device names</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="What-to-do-if-you-get-an-unidentified-floppy-disk"></a>
<h3 class="section">2.4 What to do if you get an unidentified floppy disk</h3>
<a name="index-indentifying-unknown-disks"></a>

<div class="example">
<pre class="example">dd if=/dev/fd0 of=/tmp/foo count=1
        # If it works:
getfdprm                # This will report what geometry the disk has
file /tmp/foo           # This may indicate the type of file system
mdir a:                 # Check for an MS-DOS file system
tar tvf /dev/fd0        # Check for a tar archive
cpio -itv &lt; /dev/fd0    # Check for a cpio archive
e2fsck /dev/fd0         # Check for an &quot;ext2&quot; file system
        # If it doesn't work:
        # Try the above dd command using various /dev/fd0* devices
</pre></div>

<hr>
<a name="Nickel-tours"></a>
<div class="header">
<p>
Next: <a href="#New-features" accesskey="n" rel="next">New features</a>, Previous: <a href="#Identifying-disks" accesskey="p" rel="prev">Identifying disks</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Nickel-tours-1"></a>
<h3 class="section">2.5 Nickel tours</h3>
<a name="index-nickel-tours"></a>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Mtools" accesskey="1">Mtools             </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Access MS-Dos disks from Unix
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Tar" accesskey="2">Tar                </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Tarring files directly to floppy disks
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#CPIO" accesskey="3">CPIO               </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Another archive format
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Ext2" accesskey="4">Ext2               </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Seconded Extended File System
</td></tr>
</table>

<hr>
<a name="Mtools"></a>
<div class="header">
<p>
Next: <a href="#Tar" accesskey="n" rel="next">Tar</a>, Previous: <a href="#Nickel-tours" accesskey="p" rel="prev">Nickel tours</a>, Up: <a href="#Nickel-tours" accesskey="u" rel="up">Nickel tours</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="mtools-1"></a>
<h4 class="subsection">2.5.1 mtools</h4>
<a name="index-mtools-_0028nickel-tour_0029"></a>

<div class="example">
<pre class="example">mdir a:                # Read directory of MS-DOS disk in drive A:
mcopy /tmp/foo\* a:    # Copy files beginning with foo in /tmp to A:
mcopy a:\* .           # Copy all files from A: to current directory
mformat a:             # Add MS-DOS file system to formatted disk
</pre></div>

<hr>
<a name="Tar"></a>
<div class="header">
<p>
Next: <a href="#CPIO" accesskey="n" rel="next">CPIO</a>, Previous: <a href="#Mtools" accesskey="p" rel="prev">Mtools</a>, Up: <a href="#Nickel-tours" accesskey="u" rel="up">Nickel tours</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Tar-_0028Tape-ARchive_0029"></a>
<h4 class="subsection">2.5.2 Tar (Tape ARchive)</h4>
<a name="index-tar"></a>

<div class="example">
<pre class="example">tar tvf /dev/fd0              # Read directory of tar archive in
                              # drive A:
tar cvf /dev/fd0 foo1 foo2    # Write foo1 and foo2 to A: in tar
                              # format foo1/foo2 can be entire
                              # directory trees
tar xvfp /dev/fd0             # extract entire tar archive in
                              # drive A:
</pre></div>

<p>Tar is not a file system.  Only low-level format (<code>superformat</code>,
see <a href="#superformat">superformat</a>) are needed to prepare a disk to accept a tar
archive.
</p>
<hr>
<a name="CPIO"></a>
<div class="header">
<p>
Next: <a href="#Ext2" accesskey="n" rel="next">Ext2</a>, Previous: <a href="#Tar" accesskey="p" rel="prev">Tar</a>, Up: <a href="#Nickel-tours" accesskey="u" rel="up">Nickel tours</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="CPIO-_0028CoPy-In_002fOut_0029"></a>
<h4 class="subsection">2.5.3 CPIO (CoPy In/Out)</h4>
<a name="index-CPIO"></a>

<div class="example">
<pre class="example">cpio -itv &lt; /dev/fd0        # Read directory of cpio archive in A:
find foo1 foo2 -print | cpio -ov &lt; /dev/fd0
                            # Write foo1/foo2 to A:
                            # foo1/foo2 can be entire directory trees
cpio -idumv &lt; /dev/fd0      # extract entire CPIO archive in drive A:
</pre></div>

<p>Note: blocks reported are in 512-byte units (due to UNIX System V
heritage).  Cpio is not a file system.  Only low-level format (fdformat
or superformat (see <a href="#superformat">superformat</a>) needed.
</p>
<hr>
<a name="Ext2"></a>
<div class="header">
<p>
Previous: <a href="#CPIO" accesskey="p" rel="prev">CPIO</a>, Up: <a href="#Nickel-tours" accesskey="u" rel="up">Nickel tours</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Ext2-_0028Second-Extended-File-System_0029"></a>
<h3 class="section">2.6 Ext2 (Second Extended File System)</h3>
<a name="index-Ext2"></a>

<div class="example">
<pre class="example">mke2fs /dev/fd0 1440          # Makes an ext2 filesystem of 1440
                              # block on A:
mke2fs -c /dev/fd0 1440       # Same as above, but tests floppy first
e2fsck /dev/fd0               # Tests filesystem integrity. (like
                              # chkdsk in Dos)
e2fsck -p /dev/fd0            # Repairs filesystem. (like chkdsk /f
                              # in Dos)
mount -t ext2 /dev/fd0 /mnt   # Mounts the disk in A: on /mnt.
                              # The directory /mnt must already exist
umount /mnt                   # Unmounts /mnt. No process should
                              # have its working directory in /mnt
                              # No process should have open files in
                              # /mnt
</pre></div>

<p>Note: don&rsquo;t use ext2 on 2m disks
On some systems <code>mke2fs</code> is also called mkfs.ext2, and e2fsck is also
called fsck.ext2
</p>
<hr>
<a name="New-features"></a>
<div class="header">
<p>
Previous: <a href="#Nickel-tours" accesskey="p" rel="prev">Nickel tours</a>, Up: <a href="#Basic-usage" accesskey="u" rel="up">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="New-Features-of-1_002e2_002b-kernels"></a>
<h3 class="section">2.7 New Features of 1.2+ kernels</h3>
<a name="index-New-features"></a>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#kernel" accesskey="1">kernel                 </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">New kernel features since 1.2.0
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#mtools" accesskey="2">mtools                 </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">New mtools features since mtools-3.0
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#fdutils" accesskey="3">fdutils                </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Utilities contained in the fdutils package
</td></tr>
</table>

<hr>
<a name="kernel"></a>
<div class="header">
<p>
Next: <a href="#mtools" accesskey="n" rel="next">mtools</a>, Previous: <a href="#New-features" accesskey="p" rel="prev">New features</a>, Up: <a href="#New-features" accesskey="u" rel="up">New features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="New-features-of-1_002e2_002b-kernels"></a>
<h4 class="subsection">2.7.1 New features of 1.2+ kernels</h4>
<a name="index-Kernel-_0028new-features_0029"></a>

<ul>
<li> Faster and more comprehensive automatic sensing of floppy formats
</li><li> Second Floppy Disk Controller (FDC) supported
</li><li> DOS fdformat-style formats (up to 21 sectors on HD 3.5&quot; disk)
</li><li> DOS 2m-style formats (up to 24 sectors equivalent on HD 3.5&quot; disk)
</li><li> non-DOS 2m-inspired formats
</li><li> Several long-standing bugs fixed
</li><li> More exact detection of FDC type
</li><li> More exact detection of floppy drives
</li></ul>

<hr>
<a name="mtools"></a>
<div class="header">
<p>
Next: <a href="#fdutils" accesskey="n" rel="next">fdutils</a>, Previous: <a href="#kernel" accesskey="p" rel="prev">kernel</a>, Up: <a href="#New-features" accesskey="u" rel="up">New features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="New-features-of-mtools_002d3_002e0"></a>
<h4 class="subsection">2.7.2 New features of mtools-3.0</h4>
<a name="index-Mtools-_0028new-features_0029"></a>

<ul>
<li> Support for new floppy formats (fdformat, 2m, 2m-like, ED)
</li><li> 2.88MB (Extra Density) floppies supported
</li><li> More friendly syntax (e.g. &quot;mcopy a:&quot;, &quot;mmove&quot;)
</li><li> Improved mmount
</li><li> 16-bit FATs (needed for some ED formats)
</li><li> Automatically sets disk geometry for Linux
</li><li> Several bug fixes
</li></ul>

<p>NOTE: Mtools has no longer maintained by its original maintainer Emmet
P. Gray after 2.0.7.
</p>
<hr>
<a name="fdutils"></a>
<div class="header">
<p>
Previous: <a href="#mtools" accesskey="p" rel="prev">mtools</a>, Up: <a href="#New-features" accesskey="u" rel="up">New features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="New-Utilities"></a>
<h4 class="subsection">2.7.3 New Utilities</h4>
<a name="index-Fdutils-_0028brief-list-of-supplied-utilities_0029"></a>

<ul>
<li> <code>superformat</code> (replaces fdformat; up to 3.84 MB floppies, faster,
calls mformat)

</li><li> new <code>getfdprm</code>/<code>setfdprm</code>

</li><li> <code>fdrawcmd</code> (allows user-mode programs to do low-level floppy
actions) <code>floppycontrol</code> (general-purpose floppy driver
configuration utility)

</li><li> <code>MAKEFLOPPIES</code> (makes floppy devices)
</li></ul>
<hr>
<a name="Device-numbers"></a>
<div class="header">
<p>
Next: <a href="#Media-description" accesskey="n" rel="next">Media description</a>, Previous: <a href="#Basic-usage" accesskey="p" rel="prev">Basic usage</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Device-numbers-1"></a>
<h2 class="chapter">3 Device numbers</h2>
<a name="index-MAKEFLOPPIES-_0028making-floppy-devices_0029"></a>
<a name="index-device-numbers"></a>
<a name="index-making-floppy-devices"></a>

<p>The floppy device nodes are usually made using the <code>MAKEFLOPPIES</code>
shell script (See <a href="#makefloppies">makefloppies</a>.).
</p>
<p>The major device number for the floppy drives is 2.  The minor device
number contains describes which drive it represents, and may in addition
describe the kind of media which is currently in the drive.
</p>
<p>There are two kind of floppy devices:
</p><ul>
<li> Variable geometry device nodes. Their minor number doesn&rsquo;t depend on the
media in the drive, and is calculated as follows:
<div class="example">
<pre class="example"><var>minor_device</var> = 128 * <var>fdc_nr</var> + <var>unit_nr</var>
</pre></div>

</li><li> Fixed geometry device nodes. Their minor number not only depends on the
drive which they represent, but also the type of media currently in the
drive.  It is computed as follows:

<div class="example">
<pre class="example"><var>minor_device</var> = 128 * <var>fdc_nr</var> + <var>unit_nr</var> + 4 * <var>format_nr</var>
</pre></div>

</li></ul>

<p>In this formula, <var>fdc_nr</var> is the number of the floppy disk
controller (0 or 1, usually 0), and <var>unit_nr</var> is the Unit number (0
to 3, 0 for Dos drive <code>A:</code>, and 1 for Dos drive <code>B:</code>).
<var>Format_nr</var> is only meaningful for the fixed format devices. It
describes the disk geometry that is used.  It is an index into the
<em>geometry list</em> <a href="#geometry-list">geometry list</a>.  Using all available
controller numbers and all available drive numbers, you may thus connect
up to 8 floppy drives to a single Linux box.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Variable-format-devices" accesskey="1">Variable format devices</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Fixed-format-devices" accesskey="2">Fixed format devices</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#geometry-list" accesskey="3">geometry list</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Adding-new-formats" accesskey="4">Adding new formats</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="Variable-format-devices"></a>
<div class="header">
<p>
Next: <a href="#Fixed-format-devices" accesskey="n" rel="next">Fixed format devices</a>, Previous: <a href="#Device-numbers" accesskey="p" rel="prev">Device numbers</a>, Up: <a href="#Device-numbers" accesskey="u" rel="up">Device numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Variable-format-devices-1"></a>
<h3 class="section">3.1 Variable format devices</h3>
<a name="index-Variable-format-devices"></a>

<p>Variable format devices don&rsquo;t have an intrinsic geometry.  When using
these devices, the geometry has to be set either by using autodetection
(see <a href="#Autodetection">Autodetection</a>), or by using the <code>FDSETPRM</code> or
<code>FDGETPRM</code> ioctl.  The latter ioctl can be issued using the
<code>setfdprm</code> (see <a href="#setfdprm">setfdprm</a>) and <code>getfdrpm</code>
(see <a href="#getfdprm">getfdprm</a>) programs. With the default settings, common formats
are detected transparently, and you can access any disk transparently
using the variable format devices.
</p>
<p>The geometry information is kept as long as the disk is in the drive,
and is discarded as soon as the disk is removed, unless the geometry has
been declared <em>permanent</em> by using setfdprm&rsquo;s <code>-p</code> flag
(see <a href="#setfdprm">setfdprm</a>).
</p>
<hr>
<a name="Fixed-format-devices"></a>
<div class="header">
<p>
Next: <a href="#geometry-list" accesskey="n" rel="next">geometry list</a>, Previous: <a href="#Variable-format-devices" accesskey="p" rel="prev">Variable format devices</a>, Up: <a href="#Device-numbers" accesskey="u" rel="up">Device numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Fixed-format-devices-1"></a>
<h3 class="section">3.2 Fixed format devices</h3>
<a name="index-Fixed-format-devices"></a>

<p>Fixed format devices should not be used under normal circumstances.  
</p>

<p>Fixed format devices have an intrinsic geometry.  They are useful for
the <code>fdformat</code> program (which is now considered obsolete), and for
booting off floppies which have formats that are different from the
default format (because during booting, there is no application that can
issue the otherwise needed <code>FDSETPRM</code> ioctl).
</p>
<hr>
<a name="geometry-list"></a>
<div class="header">
<p>
Next: <a href="#Adding-new-formats" accesskey="n" rel="next">Adding new formats</a>, Previous: <a href="#Fixed-format-devices" accesskey="p" rel="prev">Fixed format devices</a>, Up: <a href="#Device-numbers" accesskey="u" rel="up">Device numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-geometry-list"></a>
<h3 class="section">3.3 The geometry list</h3>
<a name="index-Geometry-List"></a>
<a name="index-Format-List"></a>
<a name="index-Available-Formats"></a>
<a name="index-Formats"></a>
<a name="index-Geometries"></a>
<a name="index-Default-Formats"></a>
<a name="index-Builtin-Formats"></a>

<p>The floppy driver contains a builtin list of 32 formats.  This list is used
for two purposes:
</p><ul>
<li> It says which geometry is used for the <em>fixed format</em> devices.
</li><li> It is used for <em>autodetection</em>
</li></ul>

<p>The following formats (geometries) are known:
</p>
<dl compact="compact">
<dt><strong>format_nr</strong></dt>
<dd><p><strong>Format</strong>
</p></dd>
<dt>0</dt>
<dd><p>autodetect
</p></dd>
<dt>1</dt>
<dd><p>360KB, 5.25&quot; DD drive
</p></dd>
<dt>2</dt>
<dd><p>1200KB, 5.25&quot; HD drive
</p></dd>
<dt>3</dt>
<dd><p>360KB, 3.5&quot; DD drive
</p></dd>
<dt>4</dt>
<dd><p>720KB, 3.5&quot; DD drive
</p></dd>
<dt>5</dt>
<dd><p>360KB, 5.25&quot; DD disk in HD drive
</p></dd>
<dt>6</dt>
<dd><p>720KB, 5.25&quot; DD disk in HD drive
</p></dd>
<dt>7</dt>
<dd><p>1440KB, 3.5&quot; HD drive
</p></dd>
<dt>8</dt>
<dd><p>2880KB, 3.5&quot; ED drive
</p></dd>
<dt>9</dt>
<dd><p>3120KB, 3.5&quot; ED drive
</p></dd>
<dt>10</dt>
<dd><p>1440KB, 5.25&quot; HD drive
</p></dd>
<dt>11</dt>
<dd><p>1680KB, 3.5&quot; HD drive
</p></dd>
<dt>12</dt>
<dd><p>410KB, 5.25&quot; DD disk in HD drive
</p></dd>
<dt>13</dt>
<dd><p>820KB, 3.5&quot; DD drive
</p></dd>
<dt>14</dt>
<dd><p>1476KB, 5.25&quot; HD drive
</p></dd>
<dt>15</dt>
<dd><p>1722KB, 3.5&quot; HD drive
</p></dd>
<dt>16</dt>
<dd><p>420KB, 5.25&quot; DD disk in HD drive
</p></dd>
<dt>17</dt>
<dd><p>830KB, 3.5&quot; DD drive
</p></dd>
<dt>18</dt>
<dd><p>1494KB, 5.25&quot; HD drive
</p></dd>
<dt>19</dt>
<dd><p>1743KB, 3.5&quot; HD drive
</p></dd>
<dt>20</dt>
<dd><p>880KB, 5.25&quot; DD drive
</p></dd>
<dt>21</dt>
<dd><p>1040KB, 3.5&quot; DD drive
</p></dd>
<dt>22</dt>
<dd><p>1120KB, 3.5&quot; DD drive
</p></dd>
<dt>23</dt>
<dd><p>1600KB, 5.25&quot; HD drive
</p></dd>
<dt>24</dt>
<dd><p>1760KB, 3.5&quot; HD drive
</p></dd>
<dt>25</dt>
<dd><p>1920KB, 3.5&quot; HD drive
</p></dd>
<dt>26</dt>
<dd><p>3200KB, 3.5&quot; ED drive
</p></dd>
<dt>27</dt>
<dd><p>3520KB, 3.5&quot; ED drive
</p></dd>
<dt>28</dt>
<dd><p>3840KB, 3.5&quot; ED drive
</p></dd>
<dt>29</dt>
<dd><p>1840KB, 3.5&quot; HD drive
</p></dd>
<dt>30</dt>
<dd><p>800KB, 3.5&quot; DD drive
</p></dd>
<dt>31</dt>
<dd><p>1600KB, 3.5&quot; HD drive
</p></dd>
</dl>

<p>This table lists first the format_nr (0-31) used to compute the minor
number, then the capacity of the format (360KB - 3200KB), and then the
type of the drive in which this format is used.
</p>
<p>The formats 0..8 are the standard PC formats.  The remaining formats are
extended capacity formats. Some of them have been taken from Heiko
Schroeder&rsquo;s fdpatches (after correcting some minor bugs).  Others have
been added by David Niemi and me (Alain Knaff).  Formats 9, 12, 13, 16,
17, 30 and 31 are non-interleaved formats with normal sized sectors, and
have the highest capacity that can be achieved without resorting to
interleaving or bigger sectors (<a href="#More-sectors">More sectors</a>).  Formats 10, 11,
14, 15, 18, 19 use interleaving interleaving to achieve a higher
capacity (<a href="#Interleave">Interleave</a>).  Formats 20 and 22 to 29 use bigger sectors
than usual (<a href="#Larger-sectors">Larger sectors</a> and <a href="#Mixed-size-sectors">Mixed size sectors</a>).
</p>
<p>In addition to these techniques, formats 13-19 use more cylinders than
usual (<a href="#More-cylinders">More cylinders</a>).  <strong>USE THESE FORMATS (13-19) ONLY IF
YOUR DRIVE SUPPORTS THE NECESSARY NUMBER OF TRACKS</strong>
</p>
<hr>
<a name="Adding-new-formats"></a>
<div class="header">
<p>
Previous: <a href="#geometry-list" accesskey="p" rel="prev">geometry list</a>, Up: <a href="#Device-numbers" accesskey="u" rel="up">Device numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Adding-new-formats-1"></a>
<h3 class="section">3.4 Adding new formats</h3>
<a name="index-setfdprm-_0028Adding-formats_0029"></a>
<a name="index-Redefining-formats"></a>
<a name="index-Adding-formats"></a>

<p>You can redefine the default formats using the setfdprm program
(<a href="#setfdprm">setfdprm</a>) <a name="DOCF1" href="#FOOT1"><sup>1</sup></a>.  The following
example illustrates how to add a new 19 sector format, and make a device
entry for it.  First, we pick an entry for it, which we want to reuse.
I recommend to redefine an entry which is only rarely used.  For
instance, if you have no 5 1/4 drive on your system, you can redefine
any 5 1/4 entry without a loss.  In our example, we pick 10.
</p>
<p>First we make the device node:
</p><div class="example">
<pre class="example">mknod /dev/fd0H1520 b 2 40
         ^          ^ ^  ^
         |          | |  Minor device number (format number * 4 +
         |          | |                       drive + controller*128)
         |          | Major device number (always 2!)           
         |          Blockdevice
    A name that you choose for the format. I
    recommend to base the name on the capacity,
    but you may choose any name you want.
</pre></div>

<p>Then we redefine the geometry of the new device:
</p><div class="example">
<pre class="example">setfdprm /dev/fd0H1520 1520 19 2 80 0 0x1b 0 0xcf 0x6c
</pre></div>

<p><strong>NB:</strong> This redefines the geometry for any device node with the
same format number, not just the new node.
</p>
<p>The new geometry is only valid until the next reboot (or removal of the
floppy module).  In order to make it permanent, you have to execute the
<code>setfdprm</code> command from your <samp>/etc/rc</samp> file or whenever you
insert the floppy module.
</p>

<hr>
<a name="Media-description"></a>
<div class="header">
<p>
Next: <a href="#Drive-descriptions" accesskey="n" rel="next">Drive descriptions</a>, Previous: <a href="#Device-numbers" accesskey="p" rel="prev">Device numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Media-description-1"></a>
<h2 class="chapter">4 Media description</h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction-_0028Mediaprm_0029" accesskey="1">Introduction (Mediaprm) </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Benefits of the new representation
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Syntax" accesskey="2">Syntax                   </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">What a media description looks like
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Media-definition-file" accesskey="3">Media definition file    </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Refer to media by a symbolic name
</td></tr>
</table>

<hr>
<a name="Introduction-_0028Mediaprm_0029"></a>
<div class="header">
<p>
Next: <a href="#Syntax" accesskey="n" rel="next">Syntax</a>, Previous: <a href="#Media-description" accesskey="p" rel="prev">Media description</a>, Up: <a href="#Media-description" accesskey="u" rel="up">Media description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Introduction"></a>
<h3 class="section">4.1 Introduction</h3>

<p>Fdutils-5.0 introduces a new uniform format description, which is
supported both by setfdprm and superformat.  The new format description
is easier to handle, because it allows to set the different parameters
of a format description in a symbolic and position independent way,
using a series of <em>variable=value</em> clauses.  Moreover, it
automatically fills in sensible default values for unspecified
parameters.  Thus you only need to describe those aspects of the format
that are important to you, and let the system handle the others.
</p>
<p>Moreover, the new description separates those aspects that were specific
to the drive (like for instance its rotation speed) from those that are
specific to the media (spacial density, number of sectors, etc.).
</p>
<p>The same description can be used both by setfdprm and superformat:
</p><div class="example">
<pre class="example">setfdprm /dev/fd0 hd sect=21 cyl=83
superformat /dev/fd0 hd sect=21 cyl=83
</pre></div>

<p>The first line above configures a 21 sector/83 cylinder format for drive
0, and the second line formats a disk using this same format.
</p>

<hr>
<a name="Syntax"></a>
<div class="header">
<p>
Next: <a href="#Media-definition-file" accesskey="n" rel="next">Media definition file</a>, Previous: <a href="#Introduction-_0028Mediaprm_0029" accesskey="p" rel="prev">Introduction (Mediaprm)</a>, Up: <a href="#Media-description" accesskey="u" rel="up">Media description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Syntax-1"></a>
<h3 class="section">4.2 Syntax</h3>

<p>A media description is a series of <em>variable=value</em> and
<em>selector</em> clauses. <em>Value</em> is a number followed by an
optional unit.  The unit is either <code>KB</code> (1024 bytes) or <code>b</code>
(blocks of 512 bytes), or none (bytes).
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Selecting-the-density" accesskey="1">Selecting the density                               </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Selecting-the-number-of-cylinders-heads-and-sectors" accesskey="2">Selecting the number of cylinders heads and sectors </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Selecting-non_002dstandard-sector-sizes" accesskey="3">Selecting non-standard sector sizes                 </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Legacy-formats" accesskey="4">Legacy formats                                      </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Expert-options" accesskey="5">Expert options                                      </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr>
<a name="Selecting-the-density"></a>
<div class="header">
<p>
Next: <a href="#Selecting-the-number-of-cylinders-heads-and-sectors" accesskey="n" rel="next">Selecting the number of cylinders heads and sectors</a>, Previous: <a href="#Syntax" accesskey="p" rel="prev">Syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Selecting-the-density-1"></a>
<h4 class="subsection">4.2.1 Selecting the density</h4>

<p>To select a density just insert its two letter code into the format
description.  Selecting a density also selects its default number of
sectors, heads and cylinders.  However, these latter parameters can be
overridden.
</p>
<dl compact="compact">
<dt><code>hd</code></dt>
<dd><p>High density (1440KB for 3 1/2 and 1200KB for 5 1/4).  The most commonly
used format today.
</p>
</dd>
<dt><code>dd</code></dt>
<dd><p>Double density (720KB for 3 1/2 and 360KB for 5 1/4)
</p>
</dd>
<dt><code>ed</code></dt>
<dd><p>Extra density (2880KB for 3 1/2)
</p>
</dd>
<dt><code>qd</code></dt>
<dd><p>Quad density (720KB for 5 1/4).
</p>
</dd>
<dt><code>sd</code></dt>
<dd><p>Single density (no nominal size).  Used mostly for CP/M.  Only for
experienced users.
</p></dd>
</dl>

<p>If no density is given, the maximal density supported by the drive is
used.  However, in order to keep the drive description and the media
description independent, I strongly suggest that you <strong>always</strong>
indicate the density anyways.
</p>
<hr>
<a name="Selecting-the-number-of-cylinders-heads-and-sectors"></a>
<div class="header">
<p>
Next: <a href="#Selecting-non_002dstandard-sector-sizes" accesskey="n" rel="next">Selecting non-standard sector sizes</a>, Previous: <a href="#Selecting-the-density" accesskey="p" rel="prev">Selecting the density</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Selecting-the-number-of-cylinders_002c-heads-and-sectors"></a>
<h4 class="subsection">4.2.2 Selecting the number of cylinders, heads and sectors</h4>

<p>This subsection describes how to select custom formats with a
non-standard number of heads, cylinders or sectors.  However, note that
just describing the number of sectors, heads and cylinders is not
enough: you also need to indicate which density your custom format is
based on (cf. previous section).
</p>
<dl compact="compact">
<dt><code>sect=<em>nb_of_sectors</em></code></dt>
<dd><p>This describes the number of sectors.
</p></dd>
<dt><code>head=<em>nb_of_heads</em></code></dt>
<dd><p>This describes the number of heads to be used.
</p></dd>
<dt><code>cyl=<em>nb_of_cylinders</em></code></dt>
<dd><p>This described the number of cylinders to be used.
</p></dd>
</dl>

<hr>
<a name="Selecting-non_002dstandard-sector-sizes"></a>
<div class="header">
<p>
Next: <a href="#Legacy-formats" accesskey="n" rel="next">Legacy formats</a>, Previous: <a href="#Selecting-the-number-of-cylinders-heads-and-sectors" accesskey="p" rel="prev">Selecting the number of cylinders heads and sectors</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Selecting-non_002dstandard-sector-sizes-1"></a>
<h4 class="subsection">4.2.3 Selecting non-standard sector sizes</h4>

<p>In order to achieve a higher capacity, you may want to use a bigger
sector size.
</p>
<dl compact="compact">
<dt><code>ssize=<em>sector_size</em></code></dt>
<dd><p>Choses a bigger sector size.  The sector size is expressed in bytes.
Only powers of two between 128 and 32768 are acceptable
</p></dd>
<dt><code>sect=<em>nb_of_sectors</em></code></dt>
<dd><p>Describes the number of sectors.  For example <code>hd sect=11
ssize=1024</code> describes a format where one track (1 side) is made up of 11
sectors of 1024 bytes each (thus 11KB per track, and 22KB per cylinder).
</p></dd>
<dt><code>tracksize=<em>size_of_one_track</em></code></dt>
<dd><p>Describes the size of one track.  For example, <code>hd tracksize=11KB
ssize=1KB</code> describes a format where one track contains 11KB of data
(tracksize) stored in sectors of 1KB each.
</p>
<p>This option exists mainly to describe MSS (mixed sector size) formats.
For example, <code>hd tracksize=12KB mss</code> describes a format where one
track which contains 12 KB of data.  The sectors size are chosen by the
system in a way to take up the least raw space: 8KB + 4KB.
</p>
</dd>
<dt><code>mss</code></dt>
<dd>
<p>This option says that the format is an MSS format.
</p>
</dd>
<dt><code>2m</code></dt>
<dd>
<p>This option says that the format is a so-called 2M format.  These
formats are intended for easy readability on DOS boxes.  Their first
track has the usual 18 sectors, whereas the other tracks have bigger
sector, and in some cases mixed sector sizes.
</p>
</dd>
</dl>

<hr>
<a name="Legacy-formats"></a>
<div class="header">
<p>
Next: <a href="#Expert-options" accesskey="n" rel="next">Expert options</a>, Previous: <a href="#Selecting-non_002dstandard-sector-sizes" accesskey="p" rel="prev">Selecting non-standard sector sizes</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Legacy-formats-1"></a>
<h4 class="subsection">4.2.4 Legacy formats</h4>

<p>The <code>swapsides</code> format allows to describe disks whose sides are
swapped, such as CBM1581 disks.
</p>
<hr>
<a name="Expert-options"></a>
<div class="header">
<p>
Previous: <a href="#Legacy-formats" accesskey="p" rel="prev">Legacy formats</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Expert-options-1"></a>
<h4 class="subsection">4.2.5 Expert options</h4>

<p>The following options are not needed in most common situations, as they
are implied by the <em>density</em> selector.  They may be needed to read
some legacy (CP/M) formats.
</p>
<dl compact="compact">
<dt><code>tpi=48</code></dt>
<dd><p>For 5 1/4 disks only.  This says that the format uses double-spaced
cylinders (implied by double density).
</p></dd>
<dt><code>tpi=96</code></dt>
<dd><p>For 5 1/4 disks only.  This says that the format uses single-spaced
cylinders (implied by quad and high density).
</p></dd>
<dt><code>fm=0</code></dt>
<dd><p>Uses MFM encoding (implied by double, quad, high and extra density)
</p></dd>
<dt><code>fm=1</code></dt>
<dd><p>Uses FM encoding (implied by single density)
</p></dd>
<dt><code>dtr=<em>dtr-code</em></code></dt>
<dd><p>Sets the data transfer rate.  The following table lists the dtr codes
for various transfer rates:
</p><div class="example">
<pre class="example">dtr-code    rate for FM          rate for MFM
=============================================
0           250kb/s              500kb/s
1           150kb/s              300kb/s
2           125kb/s              250kb/s
3           500kb/s              1000kb/s
</pre></div>
</dd>
<dt><code>perp=0</code></dt>
<dd><p>Do not use &quot;perpendicular mode&quot; sector headers (this setting is implied
by single, double, quad and high density).
</p></dd>
<dt><code>perp=1</code></dt>
<dd><p>Use &quot;perpendicular&quot; sector headers (this setting is implied by
extra-density)
</p></dd>
<dt><code>gap=<em>value</em></code></dt>
<dd><p>Sets the size of the read/write gap.  I don&rsquo;t know the purpose of this
parameter (which is passed <em>as-is</em> to the floppy controller): any
value seems to work with any format...
</p></dd>
<dt><code>fmt_gap=<em>value</em></code></dt>
<dd><p>Sets the size of the formatting gap.  This is only used by the now
obsolete <code>fdformat</code> program, and not by superformat.
</p></dd>
</dl>


<hr>
<a name="Media-definition-file"></a>
<div class="header">
<p>
Previous: <a href="#Syntax" accesskey="p" rel="prev">Syntax</a>, Up: <a href="#Media-description" accesskey="u" rel="up">Media description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-media-description-dictionary-in-_002fetc_002ffdmediaprm"></a>
<h3 class="section">4.3 The media description dictionary in /etc/fdmediaprm</h3>

<p><samp>/usr/local/etc/fdmediaprm</samp> <a name="DOCF2" href="#FOOT2"><sup>2</sup></a>
contains a dictionary of commonly used media descriptions.  Each
description is identified by a name, which can then be used by setfdprm
or superformat to refer to it, instead of an explicit description.
</p>
<p>Each definition starts with <code>&quot;</code><em>name</em><code>&quot;:</code>, followed by
the actual description.  Definitions may be spread over several lines,
for better readability.  The file may contain comments, which start with
# and stop at the end of the line.
</p><hr>
<a name="Drive-descriptions"></a>
<div class="header">
<p>
Next: <a href="#Extended-formats" accesskey="n" rel="next">Extended formats</a>, Previous: <a href="#Media-description" accesskey="p" rel="prev">Media description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Drive-descriptions-1"></a>
<h2 class="chapter">5 Drive descriptions</h2>

<p>Unlike earlier version, fdutils-5.0 separates drive descriptions and
media description.  For more details on this separation,
see <a href="#Introduction-_0028Mediaprm_0029">Introduction (Mediaprm)</a>.  Drive descriptions are used to describe the
hardware characteristics of a drive, such as their maximal density,
their rotation speed, their form factor, etc.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Syntax-of-a-drive-description" accesskey="1">Syntax of a drive description      </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">What to put into a drive description
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Drive-definition-file" accesskey="2">Drive definition file              </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Where drive definitions are stored
</td></tr>
</table>

<hr>
<a name="Syntax-of-a-drive-description"></a>
<div class="header">
<p>
Next: <a href="#Drive-definition-file" accesskey="n" rel="next">Drive definition file</a>, Previous: <a href="#Drive-descriptions" accesskey="p" rel="prev">Drive descriptions</a>, Up: <a href="#Drive-descriptions" accesskey="u" rel="up">Drive descriptions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Syntax-2"></a>
<h3 class="section">5.1 Syntax</h3>

<p>A drive description is a series of <em>variable=value</em> and
<em>selector</em> clauses.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Density" accesskey="1">Density               </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">The maximal available density on the drive
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Form-factor" accesskey="2">Form factor           </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Whether this drive is a 3 1/2&quot;, 5 1/4&quot; or 8&quot; drive
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cmos-code" accesskey="3">Cmos code             </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Sums up both density and form factor
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Other-parameters" accesskey="4">Other parameters      </a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Rotation speed and tracks per inch
</td></tr>
</table>

<hr>
<a name="Density"></a>
<div class="header">
<p>
Next: <a href="#Form-factor" accesskey="n" rel="next">Form factor</a>, Previous: <a href="#Syntax-of-a-drive-description" accesskey="p" rel="prev">Syntax of a drive description</a>, Up: <a href="#Syntax-of-a-drive-description" accesskey="u" rel="up">Syntax of a drive description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Density-1"></a>
<h4 class="subsection">5.1.1 Density</h4>

<p>The density of a drive is the highest media density that it supports.
Density is one of <code>sd</code>, <code>dd</code>, <code>qd</code>, <code>hd</code> or
<code>ed</code>.  Usually, you do not need to specify this parameter, as it
can be derived from the drives CMOS code.
</p>

<hr>
<a name="Form-factor"></a>
<div class="header">
<p>
Next: <a href="#Cmos-code" accesskey="n" rel="next">Cmos code</a>, Previous: <a href="#Density" accesskey="p" rel="prev">Density</a>, Up: <a href="#Syntax-of-a-drive-description" accesskey="u" rel="up">Syntax of a drive description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Form-factor-1"></a>
<h4 class="subsection">5.1.2 Form factor</h4>

<p>The form factor of a drive describes the physical dimensions of the
media it accepts.  It is one of <code>3.5</code>, <code>5.25</code> or <code>8</code>.
Usually, you do not need to specify this parameter, as it can be derived
from the drives CMOS code.
</p>
<hr>
<a name="Cmos-code"></a>
<div class="header">
<p>
Next: <a href="#Other-parameters" accesskey="n" rel="next">Other parameters</a>, Previous: <a href="#Form-factor" accesskey="p" rel="prev">Form factor</a>, Up: <a href="#Syntax-of-a-drive-description" accesskey="u" rel="up">Syntax of a drive description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Cmos-code-1"></a>
<h4 class="subsection">5.1.3 Cmos code</h4>

<p>The PC BIOS already knows on its own about the most common drive types.
These are named by an integer from 1 to 6, according to the following
table.
</p><div class="example">
<pre class="example">0        no drive installed
1        5.25 DD
2        5.25 HD
3        3.5 DD
4        3.5 HD
5        3.5 ED
6        3.5 ED
</pre></div>

<p>As you see 3.5 ED drives have two possible codes.  Some BIOSes use 5,
others use 6.  The reason for this is that initially 5 was intended for
floppy tape drives, and only 6 was for 3.5 ED drives.  However, some
BIOS manufacturers didn&rsquo;t know about this convention, and used 5 for the
then &quot;new&quot; 3.5 ED drives.
</p>
<p>Usually, you do not need to specify this parameter, as it can be read
from the physical CMOS of your PC.  This parameter may be useful if your
BIOS does not store the drive&rsquo;s CMOS code at the expected place, or if
you have more than two drives.
</p>
<hr>
<a name="Other-parameters"></a>
<div class="header">
<p>
Previous: <a href="#Cmos-code" accesskey="p" rel="prev">Cmos code</a>, Up: <a href="#Syntax-of-a-drive-description" accesskey="u" rel="up">Syntax of a drive description</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Other-parameters-1"></a>
<h4 class="subsection">5.1.4 Other parameters</h4>

<dl compact="compact">
<dt><code>deviation=<var>deviation</var></code></dt>
<dd><p>Tells how much more/less raw capacity the drive has than the standard.
Due to slightly different rotation speeds <a name="DOCF3" href="#FOOT3"><sup>3</sup></a> and to slightly different data
transfer rates, the raw capacity per track can vary slightly.  For
normal formats, these small deviations from the prescribed raw capacity
is not harmful, as these have plenty of safety margins built in.
However, the new extra capacity formats are affected by this, as they
try to squeeze every available raw byte out of the disk.
</p>
<p>Deviation is expressed in ppm.  Positive values mean a higher raw
capacity than normal, and negative values mean a lower raw capacity than
normal.  The deviation can be measured using the <code>floppymeter</code>
program.
</p>
</dd>
<dt><code>rpm=<var>rotation_speed</var></code></dt>
<dd>
<p>Prescribed rotation speed of the drive, expressed in rotations per
minute.  This is 360 for 5 1/4 HD drives, and 300 for all other commonly
available drive types.  Usually, you do not need to specify this
parameter, as it can be derived from the drive&rsquo;s CMOS code.  It is
useful however for single density drives or other drives not commonly
found on a PC.  Usually, you do not to specify this parameter, as it can
be derived from the drive&rsquo;s form factor and maximal density.
</p>
</dd>
<dt><code>tpi=<var>cylinder_density</var></code></dt>
<dd>
<p>This parameter is only meaningful for 5 1/4 drives.  It expresses
whether the drive is able to use 80 tracks (<code>tpi=96</code>) or only 40
(<code>tpi=48</code>).  Usually, you do not to specify this parameter, as it
can be derived from the drive&rsquo;s maximal density: quad density and high
density drives are 96 tpi, whereas double density drives are 48 tpi.
</p>
</dd>
</dl>


<hr>
<a name="Drive-definition-file"></a>
<div class="header">
<p>
Previous: <a href="#Syntax-of-a-drive-description" accesskey="p" rel="prev">Syntax of a drive description</a>, Up: <a href="#Drive-descriptions" accesskey="u" rel="up">Drive descriptions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-drive-definition-file-in-_002fusr_002flocal_002fetc_002ffddriveprm"></a>
<h3 class="section">5.2 The drive definition file in <samp>/usr/local/etc/fddriveprm</samp></h3>

<p><samp>/usr/local/etc/fddriveprm</samp> <a name="DOCF4" href="#FOOT4"><sup>4</sup></a>
contains a dictionary of commonly used media descriptions.  Each
description is identified by a name, which can then be used by setfdprm
or superformat to refer to it, instead of an explicit description.
</p>
<p>Each definition starts with <code>&quot;drive</code><em>number</em><code>&quot;:</code>,
followed by the actual description.  Definitions may be spread over
several lines, for better readability.  The file may contain comments,
which start with # and stop at the end of the line.
</p>
<hr>
<a name="Extended-formats"></a>
<div class="header">
<p>
Next: <a href="#Autodetection" accesskey="n" rel="next">Autodetection</a>, Previous: <a href="#Drive-descriptions" accesskey="p" rel="prev">Drive descriptions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Storing-more-data-on-a-floppy-disk"></a>
<h2 class="chapter">6 Storing more data on a floppy disk</h2>
<a name="index-extended-formats"></a>
<a name="index-high-capacity-formats"></a>
<a name="index-formatting-disks"></a>

<p>This section describes the techniques that are used by Linux&rsquo; floppy
driver and superformat to store more data than usual on a floppy disk.
</p>
<p>Each section contains a description of the technique used, lists the
usages of the disks formatted using this technique (whether they are
bootable, whether they are accessible on MS-DOS and for which kind of
filesystems they are suitable) and finishes with a table listing the
most interesting formats which can be obtained by the described
technique.
</p>
<p>The table lists for each format the media type it is used for, the total
capacity which can be achieved, the throughput for large reads or writes
and the media description for these disks.  This description can the be
used with superformat to make such disks, or with setfdprm to configure
the drive to read/write to them.  Some formats (the XDF and XXDF
formats) cannot be accessed directly, and thus there is no media
description for them.  For these, we indicate a formatting command used
to make these disks.  The formatting command assume that the disk is in
the first drive (<code>/dev/fd0</code>).  Substitute <code>/dev/fd1</code> if you
want to format XDF or XXDF disks in the second drive.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#More-sectors" accesskey="1">More sectors</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Using more sectors per track by packing them
                          close together
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Interleave" accesskey="2">Interleave</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Use interleave to pack the sectors even closer
                          together
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Sector-skewing" accesskey="3">Sector skewing</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Speeding up multi-track reads
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#More-cylinders" accesskey="4">More cylinders</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Use up to 83 cylinders
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Larger-sectors" accesskey="5">Larger sectors</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Minimize per byte overhead by using larger sectors
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Mixed-size-sectors" accesskey="6">Mixed size sectors</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Minimize slack by using several sector sizes
                          in a same track
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Smart-use-of-the-dtr" accesskey="7">Smart use of the dtr</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How to get more out of your disk by playing games
                          with the data transfer rate
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#g_t2M" accesskey="8">2M</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Make autodetection easier by using a readable
                          first track
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#XDF" accesskey="9">XDF</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Fast high capacity formats
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#XXDF">XXDF</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Fast formats with even higher capacity
</td></tr>
</table>

<hr>
<a name="More-sectors"></a>
<div class="header">
<p>
Next: <a href="#Interleave" accesskey="n" rel="next">Interleave</a>, Previous: <a href="#Extended-formats" accesskey="p" rel="prev">Extended formats</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="More-sectors-per-cylinder"></a>
<h3 class="section">6.1 More sectors per cylinder</h3>
<a name="index-more-sectors-per-track"></a>
<a name="index-sectors-per-track"></a>

<p>The official formats used by MS-DOS and other operating systems are
generally very conservative.  It is often possible to fit more sectors
on each track than the default by simply reducing the size of the gap
between tracks and/or the size of the leftover space at the end of the
disk.
</p>
<p>For example, a 3 1/2 disk has a raw track capacity of around 12500
bytes.  The raw capacity of a floppy disk is not rigorously constant
among different boxes, because both the data transfer rate of the floppy
controller, and the rotation speed of the drive are subject to small
variations.  In order to account for these, we have to use a safety
margin, and we only use up 12450 bytes of the 12500 bytes that are
theoretically available.
</p>
<p>A sector contains a header of 62 bytes and 512 bytes of data.  A
minimum gap of about 45 bytes should be used in order to leave enough
time to the floppy controller to &quot;rest&quot; between reading two successive
sectors.  In total, 619 bytes per sector are thus needed.
</p>
<p>This shows that we can fit 12450 / 619 = 20 sectors per track.
</p>
<p><strong>Usage:</strong> These disks are bootable by LILO, and can be read in
MS-DOS using numerous shareware utilities such as <code>vgacopy</code>, or
<code>fdformat</code> or many others.  Check your nearest Simtel mirror.
</p>
<p>With dos6, you don&rsquo;t need any add-on utilities, just put the following
line in your <code>config.sys</code>:
</p>
<div class="example">
<pre class="example">drivparm=/d:0 /f:7 /h:2 /s:21 /t:82
            ^    ^ \______________/
            |    |          |
   drive number  |     max geometry
                 |
      drive type, consult the dos help system for details
</pre></div>

<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    media description
5 1/4 DD     800KB        30KB/s       dd sect=10
3 1/2 DD     800KB        25KB/s       dd sect=10
3 1/2 HD    1600KB        50KB/s       hd sect=21 
3 1/2 ED    3200KB       100KB/s       ed sect=42 
</pre></div>

<p>The <code>--dd</code>, <code>--hd</code> and <code>--ed</code> options describe the
density of the media to be formatted (double density, high density or
extra density).
</p>
<p>The <code>-s</code> options describes the number of 512 byte sectors per
track.
</p>
<hr>
<a name="Interleave"></a>
<div class="header">
<p>
Next: <a href="#Sector-skewing" accesskey="n" rel="next">Sector skewing</a>, Previous: <a href="#More-sectors" accesskey="p" rel="prev">More sectors</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Using-interleave"></a>
<h3 class="section">6.2 Using interleave</h3>
<a name="index-interleave"></a>

<p>After having read a sector, the floppy controller needs to &quot;rest&quot; for a
short time.  This time is used to compute checksums, to reset internal
circuitry, etc.  During this time, the floppy disk continues to rotate,
and the &quot;rest&quot; time thusly translates to a certain minimal gap size.  If
a smaller gap is used, the next sector header flies by the read-write
head before the floppy controller is ready again to pick up the data.
Thus, it has to wait until the next disk rotation until that sector
comes back again.  This leads to an unacceptably low throughput, as now
the system can only read one sector per rotation instead of all sectors
in one rotation.  If we want to use smaller gaps, we have thus to use
<em>sector interleaving</em>.  This technique consists in arranging the
sectors in a way such that the next logical sector does not immediately
follow the current sector, but instead another sector is inserted
between two successive sectors.  Instead of having the following order:
</p><div class="example">
<pre class="example">1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21
</pre></div>

<p>we would use the following order:
</p>
<div class="example">
<pre class="example">1,12,2,13,3,14,4,15,5,16,6,17,7,18,8,19,9,20,10,21,11,
</pre></div>

<p>This new order allows the floppy controller to rest during the whole
time that sector 12 flies by between reading sector 1 and 2.  This
technique still cuts throughput in half, because two rotations are
needed (one for reading sectors 1 to 11, and the second to read sectors
12 to 21).  However, this is far better than the 21 rotations which
would be needed without interleave.
</p>
<p>This technique allows us to use a gap size of just 1, and thus fit 21
sectors on one track.
</p>

<p><strong>Usage:</strong> Once formatted, interleaved disks can be used in a
similar way to disks which have simply more tracks.  They can be
accessed using <code>vgacopy</code> in Dos, you can boot from them using LILO,
and you may install any filesystem on them.
</p>

<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    media description
5 1/4 HD    1440KB        27KB/s       hd sect=18 
3 1/2 HD    1680KB        26KB/s       hd sect=21 
3 1/2 ED    3360KB        52KB/s       ed sect=42 
</pre></div>

<p>You don&rsquo;t need to tell <code>superformat</code> to use interleaving, it
figures out by itself when interleaving is needed.  You don&rsquo;t need to
tell <code>setfdprm</code> either that a disk is interleaved, as this
information is not needed to read the disk
</p>
<hr>
<a name="Sector-skewing"></a>
<div class="header">
<p>
Next: <a href="#More-cylinders" accesskey="n" rel="next">More cylinders</a>, Previous: <a href="#Interleave" accesskey="p" rel="prev">Interleave</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Sector-skewing-1"></a>
<h3 class="section">6.3 Sector skewing</h3>
<a name="index-sector-skewing"></a>
<a name="index-skewing"></a>

<p>Sector skewing is a technique that allows bigger throughputs.  It does
not increase the capacity of the disk. Sector skewing is only relevant
during formatting. Sector skewed disks are indistinguishable from
non-skewed disk by software, except for a different throughput.
</p>
<p>The principle of sector skewing is to start each track a little bit
later than the previous one, i.e. the first logical sector of the second
cylinder would for example lie near the sixth logical sector of the
first cylinder.  This is done in order to account for the time needed to
seek the drive head from the first cylinder to the second.  Without
skewing, the first sector would already have passed the drive head after
seeking, and we would need to wait for a whole rotation for it to come
back again.
</p>
<p>By default, superformat applies appropriate skewing to all formats, and
the listed throughput values refer to skewed disks. It is possible to
provide different values for the skew using the <code>--head_skew</code> and
<code>--track_skew</code> parameters. <code>head_skew</code> refers to the offset
between both sides of the same cylinder, and <code>track_skew</code> refers to
the offset of two consecutive cylinders. 0 means no skew.
</p>
<hr>
<a name="More-cylinders"></a>
<div class="header">
<p>
Next: <a href="#Larger-sectors" accesskey="n" rel="next">Larger sectors</a>, Previous: <a href="#Sector-skewing" accesskey="p" rel="prev">Sector skewing</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="More-Cylinders"></a>
<h3 class="section">6.4 More Cylinders</h3>
<a name="index-more-cylinder"></a>
<a name="index-cylinders"></a>
<a name="index-tracks"></a>
<a name="index-83-cylinders"></a>

<p>Many nominally 40-cylinders or 80-cylinder drives are capable of more
cylinders, usually 41 and 83 respectively.  These can be used to get
extra capacity.  However, not all drives can seek to these unofficial
extra cylinders, and even on drives which can, these extra cylinders
tend to be less reliable.
</p>
<p><strong>WARNING</strong>: Although most drives are able to use 83 cylinders,
some may not.  If your drive is making strange noises while accessing
these tracks.
</p>

<p>Although most drives support more than 80 tracks, I have heard rumors
that some do not, and repeatedly trying to read beyond track 80 might be
damaging to them.  In order to know whether your drive supports more than
eighty tracks, first set the number of allowed tracks to 82.  (using
<code>floppycontrol --cylinders 82 -d </code><var>drive</var>)
</p>
<p>Then format a disk with a 82 track format (for example
<samp>/dev/fd0H1722</samp>), and copy on or several files to the disk until
there are less than 18 KB of free space on the disk.  Then eject and
reinsert the disk, and compare the files on the disk with the
originals. If they are the same, your drive does support 82 tracks. If
so, you might want to go further and try with 83 cylinders:
<samp>/dev/fd0H1743</samp>)
This single experience should not damage the drive, although repeating
it many times may be dangerous.
</p>
<p>If you do have a drive which supports more than 80 cylinders, you have
to call <code>floppycontrol --cylinders 82 <var>drive</var></code> before you can
use the extra cylinders.  You may put this line into your
<samp>/etc/rc.local</samp>, so that the driver is automatically configured for
the addition cylinder after each boot.
</p>
<p>If on the other hand your drive doesn&rsquo;t support more than 80 tracks,
you should remove the entries for formats 13-19 from your <samp>/dev</samp>
directory after running <code>MAKEFLOPPIES</code>, and you should call
<code>floppycontrol --cylinder 80 <var>drive</var></code> from your
<samp>/etc/rc.local</samp> (or <code>floppycontrol --cylinder 40 <var>drive</var></code>
for 5 1/4 DD drives).
</p>
<p>By default, 83 cylinder are enabled for any high density and double
density drives.  3 1/2 double density drives have 80 cylinders enables,
and 5 1/4 double density drives have 40 enabled.
</p>
<p><strong>Usage:</strong> These disks can be booted from using LILO, and can be
accessed in MS-DOS using <code>vgacopy</code>.
</p>

<p><strong>Interesting Formats:</strong>
</p>
<p>All formats presented in the two previous sections may be amended to use
83 cylinders instead of 80. Just add the <code>cyl=83</code> to the format
description for superformat.  Using more cylinders has no effect on the
throughput.
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    media description
5 1/4 HD    1494KB        27KB/s       hd sect=18 cyl=83 
3 1/2 HD    1743KB        26KB/s       hd sect=21 cyl=83
3 1/2 ED    3486KB        52KB/s       ed sect=42 cyl=83
</pre></div>

<hr>
<a name="Larger-sectors"></a>
<div class="header">
<p>
Next: <a href="#Mixed-size-sectors" accesskey="n" rel="next">Mixed size sectors</a>, Previous: <a href="#More-cylinders" accesskey="p" rel="prev">More cylinders</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Larger-sectors-1"></a>
<h3 class="section">6.5 Larger sectors</h3>
<a name="index-larger-sectors"></a>

<p>The floppy controller allows us to use larger sectors than the default
size of 512 bytes. All powers of two larger than 256 bytes are
acceptable sector sizes.  Large sectors have the same header and gap
sizes than smaller sectors, thus the overhead per byte of data is
smaller.  A little calculation shows this: A 1024 byte sector takes up
at least 1024+62+1 = 1087 raw bytes.  You can fit eleven sectors of this
size into a 12450 byte track.  This represents 11KB of data per track,
versus the 10.5KB only that can be achieved with 512 byte sectors.
</p>
<p><strong>Usage:</strong> MS-DOS and other operating systems cannot normally read
these formats.  Lilo is not yet able to boot from this kind of disks.
</p>
<p><strong>Performance:</strong> When any portion of one of these larger sectors is
read, the entire sector must be read.  When any portion of such a sector
is written to, the entire sector must be read, and then written back
with just the necessary portion modified.  Both of these circumstances
can entail worse performance than are listed in this table for small
reads and (especially) small writes.
</p>
<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput  media description
5 1/4 HD    1440KB        30KB/s     dd sect=9 ssize=1KB
3 1/2 HD    1760KB        55KB/s     hd sect=11 ssize=1KB
3 1/2 ED    3520KB       110KB/s     ed sect=11 ssize=2KB
</pre></div>

<p>The <code>ssize</code> parameter of the format description indicates the
sector size to be used.
</p>
<hr>
<a name="Mixed-size-sectors"></a>
<div class="header">
<p>
Next: <a href="#Smart-use-of-the-dtr" accesskey="n" rel="next">Smart use of the dtr</a>, Previous: <a href="#Larger-sectors" accesskey="p" rel="prev">Larger sectors</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Mixed-sector-size-_0028MSS_0029-formats"></a>
<h3 class="section">6.6 Mixed sector size (MSS) formats</h3>
<a name="index-MSS"></a>
<a name="index-2M-_0028mixed-sector-sizes_0029"></a>
<a name="index-XDF-_0028mixed-sector-sizes_0029"></a>

<p>Using larger sectors has the disadvantage that the granularity is
larger.  For example, when using 4096 byte sectors, there is enough
space to fit two sectors in a track of 12450 bytes raw capacity, but not
three.  However, the two sector format leaves plenty of space available
(4132 bytes), in which smaller sectors would fit.  For example, these
4142 raw bytes can be put to good use by filling them with a 2 KB sector
(2048+62), plus an 1 KB sector (1024+62) and a 512 byte sector, leaving
still 362 bytes for gaps.
</p>
<p>Mixed sector size formats take advantage of this by using sectors of
several different sizes on a same track.  This way, a maximum capacity
of 12KB per track, distributed in one 8k sector and one 4k sector can be
achieved.
</p>

<p><strong>Usage:</strong> There is no known MS-DOS utility which can read basic
MSS disks.  LILO is not yet able to boot from this kind of disks.
</p>
<p><strong>Performance:</strong> As any format with larger sectors, the performance
for small reads and writes is worse due to the larger granularity.
</p>

<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    media description
3 1/2 DD     880KB        28KB/s       hd tracksize=11b mss
5 1/4 HD    1600KB        30KB/s       hd tracksize=10KB mss
3 1/2 DD     880KB        28KB/s       hd tracksize=11b mss
3 1/2 HD    1840KB        28KB/s       hd tracksize=23b mss
3 1/2 HD    1920KB        30KB/s       hd tracksize=12KB mss
3 1/2 ED    3680KB        56KB/s       ed tracksize=23KB mss
3 1/2 ED    3840KB        60KB/s       ed tracksize=24KB mss
</pre></div>

<p>For MSS formats, the system figures out the most efficient repartition
of sector sizes by itself.  You do not need to describe the number of
sectors and their size.  For MSS disks, the capacity of one track is
described directly, using the <code>tracksize</code> parameter.
</p>
<p>The <code>1920KB</code> and <code>3840KB</code> formats may be unreliable on some
computers.
</p>

<hr>
<a name="Smart-use-of-the-dtr"></a>
<div class="header">
<p>
Next: <a href="#g_t2M" accesskey="n" rel="next">2M</a>, Previous: <a href="#Mixed-size-sectors" accesskey="p" rel="prev">Mixed size sectors</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Smart-use-of-the-data-transfer-rate"></a>
<h3 class="section">6.7 Smart use of the data transfer rate</h3>

<p>Due to different drive rotations speeds, 5 1/4 double density disks and
3 1/2 double density disks are accessed using different raw data
transfer rates (300 kb/s for the faster spinning 5 1/4 disks, and only
250 kb/s for the slower spinning 3 1/2 disks).  The method described in
this section consists in using the faster data transfer rate intended
for 5 1/4 disks on 3 1/2 disks, and thus boost the raw capacity per
track of these disks.  This is possible because 300 kb/s is still low
enough not to exceed the specification of the disk surface of a double
density disk (which 500 kb/s would).
</p>

<p><strong>Usage: this method is only available for 3 1/2 double density
disks.  The disk obtained cannot be booted from by LILO, and are
inaccessible from MS-DOS.</strong>
</p>
<p>The following table shows the media description for a format using this
method in conjuncion with the previous methods:
</p><div class="example">
<pre class="example">density     tot. cap.    throughput    media description
3 1/2 DD     1120KB         17KB/s     qd tracksize=7KB mss
</pre></div>

<p>We use the <code>QD</code> density selector to describe this particular DTR
set-up, although the acronym <code>QD</code> is already taken to name 96tpi
double density 5 1/4 disks.  However, as this DTR trickery is only
meaningful for 3 1/2, we hope that there will be no ambiguity.
</p>

<hr>
<a name="g_t2M"></a>
<div class="header">
<p>
Next: <a href="#XDF" accesskey="n" rel="next">XDF</a>, Previous: <a href="#Smart-use-of-the-dtr" accesskey="p" rel="prev">Smart use of the dtr</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="g_t2M-formats"></a>
<h3 class="section">6.8 2M formats</h3>
<a name="index-MSS-_00282M_0029"></a>
<a name="index-Mixed-sector-size-formats-_00282M_0029"></a>
<a name="index-2M"></a>

<p>2M formats use a standard geometry (18 normal sized sectors) on the
first side of the first cylinder, and an MSS geometry on the rest of the
disk.  They are inspired for Ciriaco Garcia de Celis&rsquo; 2M utility for
MS-DOS.
</p>
<p>The advantage of 2M disks over simple MSS disks is twofold:
</p><ul>
<li> They can be accessed from DOS
</li><li> They do not need an autodetect entry, as the boot sector is readable
using a standard geometry.  Mtools can then use the information
contained in the boot sector to configure the floppy driver to read the
rest of the disk.
</li></ul>


<p>Although 2m disk have less sectors on the first track than on the
others, the Linux floppy driver, and 2M&rsquo;s low level floppy access
routines pretend that it contains the same number of sectors.  The
missing sectors are called phantom sectors.  Writes to these sectors are
ignored, and reads return random data.  In order to make up for this, 2M
and mtools pretend that there is a duplicate FAT in the missing sectors,
which is simulated by using data from the first (real) FAT.  Thus 2M
disks work fine for their intended purpose, which is to hold an MS-DOS
filesystem.  <strong>Never use 2M disks for anything other than a MS-DOS
filesystem.  For example, never make an ext2 filesystem on a 2M disk.
If you need a high capacity ext2 filesystem (or minix fs, raw tar or
cpio archive), use the corresponding MSS format instead</strong>
</p>

<p><strong>Usage:</strong> 2M disks are not bootable by LILO. They can be accessed
in MS-DOS using the 2M utility. 2M can be found at
ftp://FTP.Coast.NET/SimTel/msdos/diskutil/2m30.zip or at any other
simtel mirror. <strong>2M disks are not suitable for non MS-DOS
filesystems</strong>.
</p>
<p><strong>Performance:</strong> Just as with MSS disks, performance is bad for
small reads and writes.
</p>
<p>To describe a 2M format, add the keyword <code>2m</code> to its media
description:
</p><div class="example">
<pre class="example">density     tot. cap.    throughput    media description
3 1/2 HD    1840KB        28KB/s       hd tracksize=23b mss 2m
</pre></div>



<hr>
<a name="XDF"></a>
<div class="header">
<p>
Next: <a href="#XXDF" accesskey="n" rel="next">XXDF</a>, Previous: <a href="#g_t2M" accesskey="p" rel="prev">2M</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="XDF-formats"></a>
<h3 class="section">6.9 XDF formats</h3>
<a name="index-MSS-_0028XDF_0029"></a>
<a name="index-Mixed-sector-size-formats-_0028XDF_0029"></a>
<a name="index-XDF"></a>
<a name="index-OS_002f2-_0028XDF_0029"></a>

<p>XDF is the format used for OS/2 installation floppies.
</p>
<p>Just like 2M, XDF uses mixed sector sizes on &quot;generic tracks&quot;.  The
first cylinder uses 512 byte sectors.
</p>
<p>However, for XDF disks, the logical order of the sectors on a given
track, and their physical order is not the same.  This allows a faster
access, in a similar way that interleaving does for disk with normal
sized sectors and too small gaps.  XDF&rsquo;s sector arrangement allows it to
read sectors alternatively from both sides, i.e. the first sector from
side 0, the second from side 1, and the third from side 0 again.  This
differs from the usually formats, where first the entire side 0 is read,
and then the entire side 1.  This technique allows to read both sides of
a disk in roughly three rotations. 
</p>
<p>The following example illustrates how this is done.  In our example we
use the XDF format used for 3 1/2 HD disks, which contains one 8KB
sector, one 2KB sector, one 1KB sector, and one 512 byte sector per
track.  The upper line represents the sectors on side 0, and the lower
line represents the sectors on side 1.  Different numbers represent
different sectors.  Repeated identical numbers represent a single larger
sector.  As the disk is circular, some sectors wrap around at the end:
we find parts of the 8KB sector, represented by 6, both at the beginning
and at the end of each track.
</p>
<div class="example">
<pre class="example">position:|          1         2         5         4
         | 1234567890123456789012345678901234567890
         |==========================================
side 0:  | 6633332244444446666666666666666666666666
side 1:  | 6666444444422333366666666666666666666666

2   512 byte sector
3   1KB sector
4   2KB sector
6   8KB sector
</pre></div>

<p>When reading a track, sectors are read in the following order:
</p><div class="example">
<pre class="example">sector id    head    position at start     position at end
----------------------------------------------------------
    3          0               3                 7
    4          0               9                16
    6          1              18                 5    (1st wrap around)
    2          0               7                 9
    2          1              12                14
    6          0              16                 3    (2nd wrap around)
    4          1               5                12
    3          1              14                18
</pre></div>

<p>We notice that the start of each sector happens at least 2 units of
position (around 300 bytes), after the end of the previously read
sector, thus allowing the floppy disk controller sufficient time to
rest.  Moreover, we notice two wrap-arounds, yielding three rotations to
read the whole cylinder (the third rotation is due to the fact that we
stop at a higher position than we started, and that we also need to
allow some time for seeking to the next track).
</p>
<p>MSS or 2M formats of the same capacity need at least 2 rotations per
side (i.e. 4 per track), yielding a lower throughput.
</p>
<p><strong>Usage:</strong> XDF disks are not bootable by LILO.  They can be
accessed from MS-DOS and OS/2 using <code>xdfcopy.exe</code> or
<code>xdf.com</code>.  They are only suitable for MS-DOS filesystems.  The
floppy driver has no direct support for this format yet, but
<code>mtools</code> is able to read them using the <code>FDRAWCMD</code> ioctl.
</p>
<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    formatting command
5 1/4 HD    1600KB        46KB/s       xdfcopy -0 /dev/fd0
3 1/2 HD    1840KB        38KB/s       xdfcopy -1 /dev/fd0
3 1/2 ED    3840KB       102KB/s       xdfcopy -2 /dev/fd0
</pre></div>

<p>The options <code>-1</code>, <code>-2</code> and <code>-3</code> describe one out of the
five formats understood by <code>xdfcopy</code> (3 XDF formats and 2 XDF
formats).
</p>
<hr>
<a name="XXDF"></a>
<div class="header">
<p>
Previous: <a href="#XDF" accesskey="p" rel="prev">XDF</a>, Up: <a href="#Extended-formats" accesskey="u" rel="up">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="XXDF-formats"></a>
<h3 class="section">6.10 XXDF formats</h3>
<a name="index-MSS-_0028XXDF_0029"></a>
<a name="index-Mixed-sector-size-formats-_0028XXDF_0029"></a>
<a name="index-XXDF"></a>

<p>These use the simple principle as XDF, but use a higher geometry.  No
new principle is used, these formats are simply more daring (smaller
gaps, and smaller margin at the end of the sector).
</p>
<p><strong>Usage:</strong> XXDF disks are not bootable by LILO, and can&rsquo;t be
accessed by MS-DOS.  They are only suitable for MS-DOS filesystems.  The
floppy driver has no direct support for this format yet, but
<code>mtools</code> is able to read them using the <code>FDRAWCMD</code> ioctl.  Due
to their smaller tolerances, XXDF formats may not work on all
drives. Problems may also occur if you write to XXDF disks using a
different drive than the one you used to format the disk.
</p>
<p><strong>Interesting Formats:</strong>
</p>
<div class="example">
<pre class="example">density     tot. cap.    throughput    formatting command
3 1/2 HD    1920KB        45KB/s       xdfcopy -3 /dev/fd0
3 1/2 ED    3840KB        90KB/s       xdfcopy -4 /dev/fd0
</pre></div>
<hr>
<a name="Autodetection"></a>
<div class="header">
<p>
Next: <a href="#Boottime-configuration" accesskey="n" rel="next">Boottime configuration</a>, Previous: <a href="#Extended-formats" accesskey="p" rel="prev">Extended formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="How-autodetection-works"></a>
<h2 class="chapter">7 How autodetection works</h2>
<a name="index-autodetection"></a>
<a name="index-format"></a>
<a name="index-recognize-a-disk"></a>

<p>The principle of autodetection is rather simple. When a floppy disk is
first accessed, and its geometry is not yet known, the floppy driver
tries out a list of up to 8 geometries (format descriptions) until one
is found that matches (i.e. that makes it possible to read the first
sector or track).  This list of geometries is called the
<em>autodetection list</em>.  There is one autodetection list per drive
type (as indicated in the cmos).
</p>
<p>The autodetection list doesn&rsquo;t contain the geometry descriptions
themselves, but rather references to entries in the <em>geometry list</em>
(see <a href="#geometry-list">geometry list</a>).  Each list may contain up to 8 such references.
Each reference can be tagged with a <code>t</code> flag.  If this tag is set,
the floppy driver tries to read the whole track when trying out that
description; if it is not set, it only tries to read the boot sector.
</p>
<p>Reading the whole track is useful to distinguish among geometries which
differ only in the amount of sectors per track.  In order to do this,
put the geometry with the most sectors first in the list, and set its
<code>t</code> tag.  Use the <code>t</code> tag only in this case, as it makes
autodetection slower.
</p>
<p>Autodetection cannot distinguish between geometries that only differ in
the number of heads or in the number of tracks.
</p>
<p>Autodetection is meant to supply only a first approximation of the
actual format of the disk.  It supplies enough information to enable a
program such as <code>mtools</code> to read the boot sector, which contains
the exact information.  <code>Mtools</code> then uses the information
contained in the boot sector to set the exact geometry.
</p>
<p>The autodetection list is set using the following command:
</p><div class="example">
<pre class="example">floppycontrol --autodetect <var>list</var>
</pre></div>

<a name="Example"></a>
<h3 class="section">7.1 Example</h3>

<p>The following example restores the default autodetection sequence for a
3 1/2 ED drive:
</p>
<div class="example">
<pre class="example">floppycontrol --autodetect 7,8,4,25,28,22,31,21
</pre></div>

<p>The following example changes this sequence, so as to add the 1680KB
format (number 11).  As only 8 formats are allowed in the autodetection
list, we have to dump one entry (we chose the last, which is numbered
21).  The 1680KB format is identical with the default 1440KB format
except for the number of sectors.  Thus we must read the whole track in
order to distinguish it from the 18 sector format (<code>t</code> flag).
Furthermore, the 1680KB sector format should be detected first, as
an 21 sector disk would also matches the standard format with its 18
sectors.
</p>
<div class="example">
<pre class="example">floppycontrol --autodetect 11t,7,8,4,25,28,22,31
</pre></div>

<p>The following example attempts to autodetect CBM 1581 disks along with
the more usual formats.  CBM 1581 disks are not among the predefined
formats.  Thus we first have to pick one of the predefined formats and
change it so it fits our needs.  We may for example pick one of the
rarely used 5 1/4 formats, such as h880, which bears number 20).  We
first make a device node bearing the requested number (so that we have a
filename to pass to setfdprm), then we chmod it so it becomes accessible
to mortal users, finally we configure the geometry of the new node, and
enter it into the autodetection list.  We place it at the 4th position,
just behind the usual ED, HD and DD formats, and before the more exotic
extended formats.  Indeed, formats which are nearer to the head of the
list are autodetected faster, and hence more commonly used formats
should be put nearer to the beginning <a name="DOCF5" href="#FOOT5"><sup>5</sup></a>.
</p>
<div class="example">
<pre class="example">mknod /dev/fd0cbm1581 b 2 80
chmod 666 /dev/fd0cbm1581
setfdprm /dev/fd0cbm1581 DD DS sect=10 cyl=80 ssize=512 fmt_gap=35 gap=12 swapsides
floppycontrol --autodetect 7,8,4,20,25,28,22,31
</pre></div>


<p>Some formats use more than 80 tracks. It is not possible for the kernel
to autodetect the number of tracks in a reasonable time, so you have to
use a sufficiently recent version of mtools to set the number of tracks
according to the boot sector of the disk. Mtools 3.0 and up are OK. This
doesn&rsquo;t obviously work with disks containing something else than a
MS-DOS filesystem.
</p><hr>
<a name="Boottime-configuration"></a>
<div class="header">
<p>
Next: <a href="#Floppy-ioctls" accesskey="n" rel="next">Floppy ioctls</a>, Previous: <a href="#Autodetection" accesskey="p" rel="prev">Autodetection</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Configuring-the-floppy-driver-via-LILO-or-insmod"></a>
<h2 class="chapter">8 Configuring the floppy driver via LILO or insmod</h2>

<p>The floppy driver is configured using the <code>floppy=</code> options in
LILO. These options can be typed at the boot prompt, or entered in the
LILO configuration file.
</p>
<p>Example: If your kernel is called <code>linux-2.0</code>, type the following
line at the LILO boot prompt (if you have a Thinkpad):
</p><div class="example">
<pre class="example">linux-2.0 floppy=thinkpad
</pre></div>
<p>You may also enter the following line in <samp>/etc/lilo.conf</samp>, in the description
of <code>linux-2.0</code>:
</p><div class="example">
<pre class="example">append = &quot;floppy=thinkpad&quot;
</pre></div>

<p>Several floppy related options may be given, example:
</p><div class="example">
<pre class="example">linux-2.0 floppy=daring floppy=two_fdc
append = &quot;floppy=daring floppy=two_fdc&quot;
</pre></div>

<p>If you give options both in the LILO configuration file and on the boot
prompt, the option strings of both places are concatenated, the boot
prompt options coming last. That&rsquo;s why there are also options to
restore the default behaviour.
</p>

<p>If you use the floppy driver as a module, use the following syntax:
<code>insmod floppy 'floppy=&quot;<var>options</var>&quot;'</code>. (This line may be
unreadable in the info version of this document. If so, please refer to
the printed version).
</p>
<p>Example:
</p><div class="example">
<pre class="example">insmod floppy 'floppy=&quot;daring two_fdc&quot;'
</pre></div>

<p>Note that in this case <code>floppy=</code> should only be typed out once,
and not once for each option. You need at least modules-1.3.57 for this
method.  However, the older environment variable based syntax is still
available: 
</p><dl compact="compact">
<dt>Bourne (sh, bash, ksh, zsh) syntax:</dt>
<dd><p><code>floppy=&quot;daring two_fdc&quot; insmod floppy</code>
</p></dd>
<dt>C-shell (csh, tcsh) syntax:</dt>
<dd><p><code>setenv floppy &quot;daring two_fdc&quot; ; insmod floppy</code>
</p></dd>
</dl>

<p>Some versions of insmod are buggy in one way or another. If you have
any problems (options not being passed correctly, segfaults during
insmod), first check whether there is a more recent version. If there
isn&rsquo;t, use the old method using environment variables.  Problems with
<code>insmod</code> happen mostly for options involving both a number and a
string, such as <code>floppy=0,4,cmos</code>.  Options only involving strings,
such as <code>floppy=daring</code> are not affected.
</p>
<p>The floppy related options include:
</p>
<dl compact="compact">
<dt><code>floppy=daring</code></dt>
<dd><p>Tells the floppy driver that you have a well behaved floppy controller.
This allows more efficient and smoother operation, but may fail on
certain controllers.
</p>
</dd>
<dt><code>floppy=0,daring</code></dt>
<dd><p>Tells the floppy driver that your floppy controller should be used
with caution.
</p>
</dd>
<dt><code>floppy=one_fdc</code></dt>
<dd><p>Tells the floppy driver that you have only floppy controller (default)
</p>
</dd>
<dt><code>floppy=two_fdc</code></dt>
<dt><code>floppy=<var>address</var>,two_fdc</code></dt>
<dd><p>Tells the floppy driver that you have two floppy controllers. The second
floppy controller is assumed to be at <var>address</var>. If <var>address</var> is
not given, 0x370 is assumed. two_fdc is implied if you use the cmos
option with a drive of id 4 to 7.
</p>
</dd>
<dt><code>floppy=thinkpad</code></dt>
<dd><p>Tells the floppy driver that you have a Thinkpad. Thinkpads use an
inverted convention for the disk change line.
</p>
</dd>
<dt><code>floppy=0,thinkpad</code></dt>
<dd><p>Tells the floppy driver that you don&rsquo;t have a Thinkpad.
</p>

</dd>
<dt><code>floppy=omnibook</code></dt>
<dt><code>floppy=nodma</code></dt>
<dd>
<p>Tells the floppy driver not to use DMA for data transfers.  This is
needed for instance on some HP Omnibooks, which don&rsquo;t have a workable
DMA channel for the floppy driver. This option is also useful if you
frequently get &quot;Unable to allocate DMA memory&quot; messages.  Indeed, DMA
memory needs to be continuous in physical memory, and is thus harder to
find, whereas non-DMA buffers may be allocated in virtual memory.
However, I advise against this if you have an FDC without a FIFO (8272A
or 82072). 82072A and later are OK. You also need at least a 486 to use
nodma.  If you use nodma mode, I suggest you also set the FIFO threshold
to 10 or lower, in order to limit the number of data transfer
interrupts.
</p>
</dd>
<dt><code>floppy=dma</code></dt>
<dd><p>Tells the floppy driver that a workable DMA channel is available
(the default).
</p>
</dd>
<dt><code>floppy=nofifo</code></dt>
<dd><p>Disables the FIFO entirely. This is needed if you get &quot;Bus master
arbitration error&quot; messages from your ethernet card (or from other
devices) while accessing the floppy.
</p>
</dd>
<dt><code>floppy=fifo</code></dt>
<dd><p>Enables the FIFO (default)
</p>
</dd>
<dt><code>floppy=<var>threshold</var>,fifo_depth</code></dt>
<dd><p>Sets the FIFO threshold. This is mostly relevant in DMA mode. If this is
higher, the floppy driver tolerates more interrupt latency, but it
triggers more interrupts (i.e. it imposes more load on the rest of the
system). If this is lower, the interrupt latency should be lower too
(faster processor). The benefit of a lower threshold is less interrupts.
</p>
<p>To tune the FIFO threshold, switch on over/underrun messages using
<code>floppycontrol --messages</code>. Then access a floppy disk. If you get a
huge amount of <code>Over/Underrun - retrying</code> messages, then the FIFO
threshold is too low. Try with a higher value, until you only get an
occasional over/underrun.  It is a good idea to compile the floppy
driver as a module when doing this tuning. Indeed, it allows to try
different FIFO values without rebooting the machine for each test. Note
that you need to do <code>floppycontrol --messages</code> every time you
re-insert the module.
</p>
<p>Usually, tuning the FIFO threshold should not be needed, as the default
(0xa) is reasonable.
</p>
</dd>
<dt><code>floppy=<var>drive</var>,<var>type</var>,cmos</code></dt>
<dd><p>Sets the CMOS type of <var>drive</var> to <var>type</var>. Additionally, this
drive is allowed in the bitmask. This is useful if you have more than
two floppy drives (only two can be described in the physical CMOS), or
if your BIOS uses non-standard CMOS types. The CMOS types are:
</p><dl compact="compact">
<dt><code>0</code></dt>
<dd><p>unknown or not installed
</p></dd>
<dt><code>1</code></dt>
<dd><p>5 1/4 DD
</p></dd>
<dt><code>2</code></dt>
<dd><p>5 1/4 HD
</p></dd>
<dt><code>3</code></dt>
<dd><p>3 1/2 DD
</p></dd>
<dt><code>4</code></dt>
<dd><p>3 1/2 HD
</p></dd>
<dt><code>5</code></dt>
<dd><p>3 1/2 ED
</p></dd>
<dt><code>6</code></dt>
<dd><p>3 1/2 ED
</p></dd>
</dl>

<p>Note that there are two valid types for ED drives. This is because 5 was
initially chosen to represent floppy tapes, and 6 for ED drives.  AMI
ignored this, and used 5 for ED drives. That&rsquo;s why the floppy driver
handles both) Setting the CMOS to 0 for the first two drives (default)
makes the floppy driver read the physical CMOS for those drives.
</p>
</dd>
<dt><code>floppy=unexpected_interrupts</code></dt>
<dd><p>Print a warning message when an unexpected interrupt is received 
(default behaviour)
</p>
</dd>
<dt><code>floppy=no_unexpected_interrupts</code></dt>
<dt><code>floppy=L40SX</code></dt>
<dd><p>Don&rsquo;t print a message when an unexpected interrupt is received. This is
needed on IBM L40SX laptops in certain video modes. (There seems to be
an interaction between video and floppy. The unexpected interrupts only
affect performance, and can safely be ignored.)
</p>
</dd>
<dt><code>floppy=broken_dcl</code></dt>
<dd><p>Don&rsquo;t use the disk change line, but assume that the disk was changed
whenever the device node is reopened. Needed on some boxes where the
disk change line is broken or unsupported.  This should be regarded as a
stopgap measure, indeed it makes floppy operation less efficient due to
unneeded cache flushing, and slightly more unreliable. Please verify
your cable, connection and jumper settings if you have any DCL problems.
However, some older drives, and also some Laptops are known not to have
a DCL.
</p>
</dd>
<dt><code>floppy=debug</code></dt>
<dd>
<p>Print debugging messages
</p>
</dd>
<dt><code>floppy=messages</code></dt>
<dd>
<p>Print informational messages for some operations (disk change
notifications, warnings about over and underruns, and about
autodetection)
</p>
</dd>
<dt><code>floppy=silent_dcl_clear</code></dt>
<dd>
<p>Uses a less noisy way to clear the disk change line (which doesn&rsquo;t
involve seeks). Implied by daring.
</p>

<p>(There are other options as well, but they are considered obsolete, and
thus they are not documented here)
</p>
</dd>
</dl>
<hr>
<a name="Floppy-ioctls"></a>
<div class="header">
<p>
Next: <a href="#Commands" accesskey="n" rel="next">Commands</a>, Previous: <a href="#Boottime-configuration" accesskey="p" rel="prev">Boottime configuration</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Floppy-ioctls-1"></a>
<h2 class="chapter">9 Floppy ioctls</h2>
<a name="index-ioctl-list"></a>
<a name="index-floppy-ioctls"></a>

<p>All these ioctl&rsquo;s may be issued using the floppycontrol program. (See
also floppycontrols man page)
</p>
<dl compact="compact">
<dt><code>FDSETPRM</code></dt>
<dd><p>sets the geometry (number of tracks, heads and sectors,
etc) of a drive.
</p></dd>
<dt><code>FDDEFPRM</code></dt>
<dd><p>sets the geometry in a permanent way (not cleared after a
disk change)
</p></dd>
<dt><code>FDGETPRM</code></dt>
<dd><p>read a previously set drive geometry (or an autodetected
geometry) back.
</p></dd>
<dt><code>FDCLRPRM</code></dt>
<dd><p>makes the driver forget the geometry for a given drive
(to trigger autodetection)
</p></dd>
<dt><code>FDFLUSH</code></dt>
<dd><p>forgets the contents of the floppy buffers. CAUTION: This
doesn&rsquo;t write dirty buffers to the disk. Use fsync first.
</p></dd>
<dt><code>FDGETDRVTYP</code></dt>
<dd><p>displays the type of a drive (name parameter). This is
used by <code>MAKEFLOPPIES</code>. For the naming convention, see the description
of the <code>MAKEFLOPPIES</code> script. For formats which work in several drive
types, <code>FDGETDRVTYP</code> return a name which is appropriate for the oldest
drive type which supports this format.
</p></dd>
<dt><code>FDSETDRVPRM</code></dt>
<dd><p>sets various drive parameters.
</p></dd>
<dt><code>FDGETDRVPRM</code></dt>
<dd><p>reads these parameters back.
</p></dd>
<dt><code>FDGETDRVSTAT</code></dt>
<dd><p>gets the cached drive state (disk changed, write
protected et al.)
</p></dd>
<dt><code>FDPOLLDRVSTAT</code></dt>
<dd><p>polls the drive and return its state.
</p></dd>
<dt><code>FDGETFDCSTAT</code></dt>
<dd><p>gets the floppy controller state.
</p></dd>
<dt><code>FDRESET</code></dt>
<dd><p>resets the floppy controller under certain conditions.
</p></dd>
<dt><code>FDRAWCMD</code></dt>
<dd><p>sends a raw command to the floppy controller.
</p></dd>
<dt><code>FDWERRORCLR</code></dt>
<dd><p>clear the write error stats.
</p></dd>
<dt><code>FDWERRORGET</code></dt>
<dd><p>gets the write error stats.
</p></dd>
<dt><code>FDSETMAXERRS</code></dt>
<dd><p>sets the error thresholds (when to display error messages on the
console, and when to abort operations). The maxerror structure is part
of the drive parameters, but this ioctl is needed in addition to
<code>FDSETDRVPRM</code> because <code>FDSETDRVPRM</code> is only accessible to the
superuser whereas <code>FDSETMAXERRS</code> is accessible to whoever has write access
to the floppy device.
</p>
</dd>
<dt><code>FDMSGON/FDMSGOFF</code></dt>
<dd><p>switch informational messages on/off. This flag is part of the drive
parameters as well, but <code>FDMSGON/FDMSGOFF</code> don&rsquo;t need superuser status.
</p>
</dd>
</dl>

<p>There are other ioctls as well, but they are considered obsolete and
their use is discouraged.
</p><hr>
<a name="Commands"></a>
<div class="header">
<p>
Next: <a href="#Compile_002dtime-configuration" accesskey="n" rel="next">Compile-time configuration</a>, Previous: <a href="#Floppy-ioctls" accesskey="p" rel="prev">Floppy ioctls</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Command-list"></a>
<h2 class="chapter">10 Command list</h2>
<a name="index-Command-list"></a>
<a name="index-List-of-available-commands"></a>

<p>This section describes the available fdutils commands, and the command
line parameters that each of them accepts.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#diskd" accesskey="1">diskd</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">detect a disk change and execute a command
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#diskseekd" accesskey="2">diskseekd</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">seeks the drive from time to time to shake of the
                      dust
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#fdmount" accesskey="3">fdmount</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">automatically mounts and unmounts floppy disks
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#fdrawcmd" accesskey="4">fdrawcmd</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">send raw commands to the floppy disk controller
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#floppycontrol" accesskey="5">floppycontrol</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">configure the floppy driver
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#floppymeter" accesskey="6">floppymeter</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">measures characteristic parameters of a floppy drive
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#getfdprm" accesskey="7">getfdprm</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">print current geometry parameters
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#makefloppies" accesskey="8">makefloppies</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">makes the floppy device entries
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#superformat" accesskey="9">superformat</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">formats high capacity disks
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#setfdprm">setfdprm</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">changes the current and permanent geometry
                      parameters
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#xdfcopy">xdfcopy</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">copies and formats XDF disks
</td></tr>
</table>

<hr>
<a name="diskd"></a>
<div class="header">
<p>
Next: <a href="#diskseekd" accesskey="n" rel="next">diskseekd</a>, Previous: <a href="#Commands" accesskey="p" rel="prev">Commands</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="diskd-1"></a>
<h3 class="section">10.1 diskd</h3>
<a name="index-diskd"></a>

<p>The diskd command has the following syntax:
</p>
<div class="example">
<pre class="example"><code>diskd</code> [<code>-d</code> <var>drive</var>] [<code>-i</code> <var>interval</var>] [<code>-e</code> <var>command</var>]
</pre></div>

<p>Diskd waits for a disk to be inserted into a given <var>drive</var>, and then
either executes the <var>command</var> or exits. This program can be used to
automatically mount a disk as soon as it is inserted.
</p>
<a name="Warning"></a>
<h4 class="subsection">10.1.1 Warning</h4>

<p>This program works by switching the motor on for a very short
interval, and then seeking to track -1. This might damage hardware in
the long run. Amigas, which also use these techniques, are known for
having problems with their disk drives no longer spinning up properly
after a few month of usage.
</p>
<a name="Options"></a>
<h4 class="subsection">10.1.2 Options</h4>

<dl compact="compact">
<dt><code>-d <var>drive</var></code></dt>
<dd><p>Selects the drive to observe for disk insertion. By default, drive 0
(<code>/dev/fd0</code>) is observed.
</p></dd>
<dt><code>-i <var>interval</var></code></dt>
<dd><p>Selects the polling interval. The interval is given in tenths of
seconds. Default is 10 (one second).
</p></dd>
<dt><code>-e <var>command</var></code></dt>
<dd><p>Gives the command to be executed when a disk is inserted. If no
command is given the program simply exits. Typically, the command
mounts the disk. It can be a shell scripts which probes for several
filesystems and disk geometries until it succeeds.
</p></dd>
</dl>

<a name="Bugs"></a>
<h4 class="subsection">10.1.3 Bugs</h4>


<ul>
<li> Automatic unmounting cannot yet be handled. It is indeed not enough to
scan for disk removal, because when the disk is removed, it is already
too late: There might be some buffers needing flushing.  However, the
<code>fdmountd</code> program allows automatic unmounting by using the
<code>SYNC</code> mount options, which switches off write buffering
(see <a href="#fdmount">fdmount</a>).

</li><li> The drive motor is running all the time, and on some computers, the
drive led flickers at each time the drive is polled.  
</li></ul>
<hr>
<a name="diskseekd"></a>
<div class="header">
<p>
Next: <a href="#fdmount" accesskey="n" rel="next">fdmount</a>, Previous: <a href="#diskd" accesskey="p" rel="prev">diskd</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="diskseekd-1"></a>
<h3 class="section">10.2 diskseekd</h3>
<a name="index-diskseekd"></a>
<a name="index-dust-_0028shaking-it-off-from-a-drive_0029"></a>
<a name="index-shaking-off-dust-from-a-drive"></a>

<p>Several people have noticed that Linux has a bad tendency of killing
floppy drives. These failures remained completely mysterious, until
somebody noticed that they were due to huge layers of dust accumulating
in the floppy drives. This cannot happen under Messy Dos, because this
excuse for an operating system is so unstable that it crashes roughly
every 20 minutes (actually less if you are running Windows).  When
rebooting, the BIOS seeks the drive, and by doing this, it shakes the
dust out of the drive mechanism. <code>diskseekd</code> simulates this effect
by seeking the drive periodically.  If it is called as <code>diskseek</code>,
the drive is sought only once.
</p>
<a name="Options-1"></a>
<h4 class="subsection">10.2.1 Options</h4>

<p>The syntax for <code>diskseekd</code> is as follows:
</p><div class="example">
<pre class="example"><code>diskseekd</code> [<code>-d</code> <var>drive</var>] [<code>-i</code> <var>interval</var>] [<code>-p</code> <var>pidfile</var>]
</pre></div>

<dl compact="compact">
<dt><code>-d <var>drive</var></code></dt>
<dd><p>Selects the drive to seek.  By default, drive 0 (<samp>/dev/fd0</samp>) is sought.
</p>
</dd>
<dt><code>-i <var>interval</var></code></dt>
<dd><p>Selects the cleaning interval, in seconds.  If the interval is 0, a
single seek is done. This is useful when calling diskseek from a
crontab.  The default is 1000 seconds (about 16 minutes) for
<code>diskseekd</code> and 0 for <code>diskseek</code>.
</p>
</dd>
<dt><code>-p <var>pidfile</var></code></dt>
<dd><p>Stores the process id of the diskseekd daemon into <var>pidfile</var> instead
of the default <samp>/var/run/diskseekd.pid</samp>.
</p></dd>
</dl>

<a name="Bugs-1"></a>
<h4 class="subsection">10.2.2 Bugs</h4>

<ol>
<li> Other aspects of Messy Dos&rsquo; flakiness are not simulated.
</li><li> This section lacks a few smileys.
</li></ol>
<hr>
<a name="fdmount"></a>
<div class="header">
<p>
Next: <a href="#fdrawcmd" accesskey="n" rel="next">fdrawcmd</a>, Previous: <a href="#diskseekd" accesskey="p" rel="prev">diskseekd</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="fdmount-1"></a>
<h3 class="section">10.3 fdmount</h3>
<a name="index-fdmount"></a>
<a name="index-fdmountd"></a>
<a name="index-fdlist"></a>
<a name="index-fdumount"></a>
<a name="index-automounting"></a>


<div class="example">
<pre class="example"><code>fdmount</code> [<code>-l</code>] [<code>--list</code>] [<code>-d</code>] [<code>--daemon</code>] [<code>--detach</code>]
[<code>-i</code> <var>interval</var>] [<code>--interval</code> <var>interval</var>] [<code>-o</code> <var>mount-options</var>]
[<code>-r</code>] [<code>-readonly</code>] [<code>-s</code>] [<code>--sync</code>] [<code>--nosync</code>] [<code>--nodev</code>]
[<code>--nosuid</code>] [<code>--noexec</code>] [<code>-f</code>] [<code>--force</code>] [<code>-h</code>] [<code>--help</code>]
[<var>drivename</var>] [<var>mountpoint</var>]

<code>fdumount</code> [<code>-f</code>] [<code>--force</code>] [<var>drivename</var>]

<code>fdlist</code>

<code>fdmountd</code> [<code>-i</code> <var>interval</var>] [<code>--interval</code> <var>interval</var>] [<code>-r</code>]
[<code>-readonly</code>] [<code>-s</code>] [<code>--sync</code>] [<code>--nosync</code>] [<code>--nodev</code>]
[<code>--nosuid</code>] [<code>--noexec</code>] [<code>--help</code>] [<var>drivename</var>] [<var>mountpoint</var>]]

</pre></div>


<p>The <code>fdmount</code> program mounts a floppy disk in the specified
drive. It tries to figure out the exact format and filesystem type of
the disk from data in the disk&rsquo;s boot sector or super block and the
auto-detected track layout.
</p>
<p>Currently, fdmount supports the filesystems <code>minix</code>, <code>ext</code>,
<code>ext2</code>, <code>xia</code>, and <code>msdos</code>, and includes special support
for disks formatted by the <code>2M</code> utility for MS-DOS.
</p>
<p>It also checks whether the disk is write protected, in which case 
it is mounted read-only.
</p>
<p>The symbolic <var>drivename</var> is (currently) one of <samp>fd[0-7]</samp>,
corresponding to the special device files <samp>/dev/fd[0-7]</samp>. If
<var>drivename</var> is not specified, <samp>fd0</samp> is assumed.
</p>
<p>The disk is mounted on the directory <var>mountpoint</var>, if specified, or
on <samp>/fd[0-7]</samp>.  In either case, the mount point must be an
existing, writable directory.
</p>

<p><strong>Due to a bug in the floppy driver (?), the polling interval (-i
flag) must be longer than the spindown offset. Thus you need to do (for
example) floppycontrol &ndash;spindown 99 before starting fdmountd in daemon
mode</strong>
</p>
<a name="Options-2"></a>
<h4 class="subsection">10.3.1 Options</h4>

<dl compact="compact">
<dt><code>-l <var>--list</var></code></dt>
<dd><p>List all known drives with their symbolic name, type, and mount
status. 
</p>
</dd>
<dt><code>-d <var>--daemon</var></code></dt>
<dd><p>Run in daemon mode (see below).
</p>
</dd>
<dt><code>--detach</code></dt>
<dd><p>Runs daemon in background, and detaches it from its tty. Messages
produced after the fork are logged to syslog.
</p>
</dd>
<dt><code>-p <var>file</var></code></dt>
<dt><code>--pidfile <var>file</var></code></dt>
<dd>
<p>Dumps the process id of the daemon to
<var>file</var>. This makes killing the daemon easier:
<code>kill -9 `cat <var>file</var>`</code>
</p>
</dd>
<dt><code>-i <var>interval</var></code></dt>
<dt><code>--interval <var>interval</var></code></dt>
<dd><p>Set the polling interval for daemon mode. The unit for <var>interval</var> is
0.1 seconds, the default value is 10 (i.e. 1 second).
</p>
</dd>
<dt><code>-o <var>options</var></code></dt>
<dt><code>--options <var>options</var></code></dt>
<dd><p>Sets filesystem-specific options. So far, these are only available for
DOS and Ext2 disks. The following DOS options are supported:
<code>check</code>, <code>conv</code>, <code>dotsOK</code>, <code>debug</code>, <code>fat</code>,
<code>quiet</code>, <code>blocksize</code>.  The following Ext2 options are
supported: <code>check</code>, <code>errors</code>, <code>grpid</code>, <code>bsdgroups</code>,
<code>nogrpid</code>, <code>sysvgroups</code>, <code>bsddf</code>, <code>minixdf</code>,
<code>resgid</code>, <code>debug</code>, <code>nocheck</code>.  When running as a daemon,
options not applying to the disk that is inserted (because of its
filesystem type) are not passed to mount.
</p>
</dd>
<dt><code>-r <var>--readonly</var></code></dt>
<dd><p>Mount the disk read-only. This is automatically assumed if the
disk is write protected.
</p>
</dd>
<dt><code>-s <var>--sync</var></code></dt>
<dd><p>Mount with the <code>SYNC</code> option.
</p>
</dd>
<dt><code>--nosync</code></dt>
<dd><p>Mounts without the <code>SYNC</code> option, even when running as daemon.
</p>
</dd>
<dt><code>--nodev</code></dt>
<dd><p>Mount with the <code>NODEV</code> option. Ignored for <code>msdos</code>
filesystems, otherwise always set for non-root users.
</p>
</dd>
<dt><code>--nosuid</code></dt>
<dd><p>Mount with the <code>NOSUID</code> option. Ignored for <code>msdos</code>
filesystems, otherwise always set for non-root users.
</p>
</dd>
<dt><code>--noexec</code></dt>
<dd><p>Mount with the <code>NOEXEC</code> option.
</p>
</dd>
<dt><code>-f <var>--force</var></code></dt>
<dd><p>Attempt a mount or unmount operation even <samp>/etc/mtab</samp> says that
the drive is already mounted, or not mounted, respectively.
This option is useful if <samp>/etc/mtab</samp> got out of sync with the
actual state for some reason.
</p>
</dd>
<dt><code>-h <var>--help</var></code></dt>
<dd><p>Show short parameter description
</p>
</dd>
</dl>

<a name="Security"></a>
<h4 class="subsection">10.3.2 Security</h4>

<p>When mounting on the default mount point, the mount points&rsquo; owner is set
to the current user, and the access flags according to the user&rsquo;s umask.
For a specified mountpoint, owner and permissions are left
unchanged. Default mount points are called <code>/fd0</code>, <code>/fd1</code>,
&hellip; , <code>/fd7</code>.
</p>
<p>The user running fdmount must have read access to the floppy device for
read only mounts, and read/write access for read/write mounts.
</p>
<p>Fdmount can be run suid root, allowing users to mount floppy
disks. The following restrictions are placed upon non-root
users:
</p>
<ul>
<li> If a mountpoint is specified explicitly, it must be owned by the user.
</li><li> A user may only unmount a disk if the mount point is owned by the user,
or if it the disk has been mounted by the same user.
</li><li> Non-msdos disks are automatically mounted with the <code>nodev</code> and
<code>nosuid</code> flags set.
</li></ul>

<p>However, <strong>do not rely on fdmount being secure at the moment</strong>.
</p>
<a name="Daemon-mode"></a>
<h4 class="subsection">10.3.3 Daemon mode</h4>

<p>In daemon mode, the specified drive is periodically checked and if a
disk is inserted, it is automatically mounted.
</p>
<p>When the disk is removed, it is automatically unmounted.  However, it is
recommended to unmount the disk manually <em>before</em> removing it. In
order to limit corruption, disks are mounted with the SYNC option when
running in daemon mode, unless the <code>--nosync</code> flag is given.
</p>
<p>Note that this mode has some potential drawbacks:
</p><ul>
<li> Some floppy drives have to move the drive head physically in order to
reset the disk change signal. It is strongly recommended not to use
daemon mode with these drives.  See <a href="#floppycontrol">floppycontrol</a>, for details.
</li><li> If a disk does not contain a filesystem (e.g. a tar archive),
the mount attempt may slow down initial access.
</li><li> As fdmount cannot identify the user trying to use the disk drive,
there is no way to protect privacy. Disks are always mounted with
public access permissions set.
</li></ul>

<a name="Diagnostics"></a>
<h4 class="subsection">10.3.4 Diagnostics</h4>

<dl compact="compact">
<dt><code>error opening device <var>name</var></code></dt>
<dt><code>error reading boot/super block</code></dt>
<dd><p>fdmount failed to read the first 1K of the disk. The disk might be
damaged, unformatted, or it may have a format which is unsupported by the
FDC or the Linux kernel.
</p>
</dd>
<dt><code>unknown filesystem type</code></dt>
<dd><p>No magic number of any of the supported filesystems (see above) 
could be identified.
</p>
</dd>
<dt><code>sorry, can't figure out format (<var>fs</var> filesystem)</code></dt>
<dd><p>The size of the filesystem on the disk is incompatible with
the track layout detected by the kernel and an integer number of
tracks. This may occur if the filesystem uses only part of the
disk, or the track layout was detected incorrectly by the kernel.
</p>
</dd>
<dt><code>failed to mount <var>fs&gt; &lt;size</var>K-disk</code></dt>
<dd><p>The actual <code>mount</code> system call failed.
</p>
</dd>
<dt><code>failed to unmount</code></dt>
<dd><p>The actual <code>unmount</code> system call failed.
</p>
</dd>
<dt><code>cannot create lock file /etc/mtab~</code></dt>
<dd><p>If <samp>/etc/mtab~</samp> exists, you should probably delete it. Otherwise,
check permissions.
</p>
</dd>
<dt><code>Can't access <var>mountpoint</var></code></dt>
<dd><p>Most probably, the default or specified mount point does not exist.
Use mkdir.
</p>
</dd>
<dt><code><var>mountpoint</var> is not a directory</code></dt>
<dd><p>The mountpoint is not a directory.
</p>
</dd>
<dt><code>not owner of <var>mountpoint</var></code></dt>
<dd><p>Non-root users must own the directory specified as mount point.
(This does not apply for the default mount points, /fd[0-3].)
</p>
</dd>
<dt><code>No write permission to <var>mountpoint</var></code></dt>
<dd><p>Non-root users must have write permission on the mount point
directory.
</p>
</dd>
<dt><code>Not owner of mounted directory: UID=<var>uid</var></code></dt>
<dd><p>Non-root users cannot unmount if the mount point is owned
(i.e. the disk was mounted) by another user.
</p>
</dd>
<dt><code>invalid drive name</code></dt>
<dd><p>Valid drive names are <samp>fd0</samp>, <samp>fd1</samp>, etc.
</p>
</dd>
<dt><code>drive <var>name</var> does not exist</code></dt>
<dd><p>The drive does not exist physically, is unknown to the Linux kernel, or
is an unknown type.
</p>
</dd>
<dt><code>Drive <var>name</var> is mounted already</code></dt>
<dd><p>Trying to mount a drive which appears to be mounted already.  Use the
<code>--force</code> option if you think this is wrong.
</p>
</dd>
<dt><code>Drive <var>name</var> is not mounted</code></dt>
<dd><p>Trying to unmount a drive which does not appear to be mounted.  Use the
<code>--force</code> option if you think this is wrong.
</p>
</dd>
<dt><code>ioctl(...) failed</code></dt>
<dd><p>If this occurs with the <code>FDGETDRVTYP</code> or <code>FDGETDRVSTAT</code>,
ioctl&rsquo;s you should probably update your Linux kernel.
</p>
</dd>
<dt><code>mounted <var>fs</var> <var>size</var>-disk (<var>options</var>)</code></dt>
<dd><p>Success message.
</p>
</dd>
</dl>

<a name="Bugs-2"></a>
<h4 class="subsection">10.3.5 Bugs</h4>

<ul>
<li> Fdmount should be more flexible about drive names and default
mount points (currently hard coded).

</li><li> Probably not very secure yet (when running suid root).
Untested with ext and xia filesystems.

</li><li> Can&rsquo;t specify filesystem type and disk layout explicitly.

</li><li> In daemon mode, the drive light stays on all the time.

</li><li> Some newer filesystem types, such as vfat are not yet supported.

</li></ul>
<hr>
<a name="fdrawcmd"></a>
<div class="header">
<p>
Next: <a href="#floppycontrol" accesskey="n" rel="next">floppycontrol</a>, Previous: <a href="#fdmount" accesskey="p" rel="prev">fdmount</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="fdrawcmd-1"></a>
<h3 class="section">10.4 fdrawcmd</h3>
<a name="index-fdrawcmd"></a>
<a name="index-raw-command"></a>
<a name="index-low-level-interaction-with-floppy-driver"></a>
<a name="index-direct-interaction-with-floppy-driver"></a>

<div class="example">
<pre class="example"><code>fdrawcmd</code> [<code>drive=</code><var>drive</var>] [<code>rate=</code><var>rate</var>]
[<code>length=</code><var>length</var>] [<code>repeat=</code><var>repeat</var>]
[<code>cylinder=</code><var>physical-cyl</var>] <var>command</var> [<var>parameters</var> &hellip;] [<var>mode</var>]
</pre></div>

<p><code>fdrawcmd</code>
is used to send raw commands to the floppy disk controller, after
having selected a given drive. You must have write permission to the
selected drive.
</p>
<p>When writing to a disk, data is read from stdin; when reading, data
is printed to stdout.  Diagnostic messages, return values from the
controller, and the value of the disk change line after the command are
printed to stderr.
</p>
<a name="Options-3"></a>
<h4 class="subsection">10.4.1 Options</h4>

<p>All numbers may be given in octal (0211), decimal (137), or hexadecimal
(0x89).
</p>
<dl compact="compact">
<dt><code>drive=<var>drive</var></code></dt>
<dd><p>Selects the drive.  The default is drive 0 (<samp>/dev/fd0</samp>).
</p>
</dd>
<dt><code>rate=<var>rate</var></code></dt>
<dd><p>Selects the data transfer rate. Use 0 for high density disks, 1 for
double density 5 1/4 disks (or 2 Mbps tapes, if the appropriate rate
table is selected), and 2 for double density 3 1/2 disks.
</p>
</dd>
<dt><code>length=<var>length</var></code></dt>
<dd><p>Describes the length of the transferred data for commands reading from
and writing to the disk.  The default is to continue until end of file.
</p>
</dd>
<dt><code>repeat=<var>count</var></code></dt>
<dd><p>Repeat the command <var>count</var> times.  This only works correctly for
commands which don&rsquo;t do any data transfer.
</p>
</dd>
<dt><code>cylinder=<var>count</var></code></dt>
<dd><p>Seek to the given cylinder before executing the command
</p>
</dd>
<dt><code><var>command</var></code></dt>
<dd><p>The name of the command to send.  <var>command</var> may be a spelled out
name (like <code>read</code> or <code>write</code>), or a number representing the
commands floppy disk controller opcode.  A named command has already a
mode associated with it, whereas for a number the mode parameter should
be described using the <code>mode</code> option.
</p>

</dd>
<dt><code><var>parameters</var></code></dt>
<dd><p>The parameters for the command (optional, not all commands need
parameters).
</p>
</dd>
<dt><code><var>mode</var></code></dt>
<dd><p>Various flags or&rsquo;ed together describing the properties of the command.
</p>
</dd>
</dl>


<a name="Commands-1"></a>
<h4 class="subsection">10.4.2 Commands</h4>

<p>The description of the various floppy commands given in this manpage is
very sketchy. For more details get the 82078 spec sheet which can be
found at:
</p><div class="example">
<pre class="example">http://www-techdoc.intel.com/docs/periph/fd_contr/datasheets/
</pre></div>

<p>Look for the chapter <code>COMMAND SET/DESCRIPTIONS</code>.  Older FDCs only
support a subset of the commands described therein, but the syntax for
the commands that do exist is the same.
</p>
<a name="Commands-available-on-all-FDCs"></a>
<h4 class="subsubsection">10.4.2.1 Commands available on all FDCs</h4>

<dl compact="compact">
<dt><code>read <var>drvsel cyl head sect szcod spt rw-gap szcod2</var></code></dt>
<dd><p>Reads <var>length</var> bytes of data from the disk.  <var>drvsel</var> is the
drive selector. Bit 0 and 1 describe the drive, and bit 2 describes the
head.  The remaining parameters give the cylinder, head (yes, again),
sector, size of the sector (128 * 2 ^ <var>szcod</var>), sectors per track
(<code>spt</code>, this is used to switch to the second head when the first
side has been read), and size of the read-write gap. <var>szcod2</var> should
be 0xff.  <code>read</code> returns <var>ST0 ST1 ST2</var> and <var>cyl head sect
szcod</var> of the next sector to be read; see
<samp>/usr/include/linux/fdreg.h</samp> .
</p>
<p>N.B. Certain newer floppy disk controllers are buggy, and do not
correctly recognize the end of transfer when operating in virtual DMA
mode.  For these, you need to set <code>spt</code> to the id of the last
sector to be read (for example, if you intend to read sectors 2, 3, 4,
set <code>spt</code> to 4, even if the disk has more sectors), and set the
<code>no-mt</code> flag.
</p>
</dd>
<dt><code>write <var>drvsel cyl head sect szcod spt rw-gap szcod2</var></code></dt>
<dd><p>Analogous to
<code>read</code>.
</p>
</dd>
<dt><code>sense <var>drvsel</var></code></dt>
<dd><p>Returns the third status byte (<var>ST3</var>)
</p>
</dd>
<dt><code>recalibrate <var>drvsel</var></code></dt>
<dd><p>Recalibrates the drive and returns <var>ST0 ST1</var>.
</p>
</dd>
<dt><code>seek <var>drvsel cyl</var></code></dt>
<dd><p>Moves the head to <var>cyl</var> and returns <var>ST0 ST1</var>.
</p>
</dd>
<dt><code>specify <var>drvsel spec1 spec2</var></code></dt>
<dd><p>Specify various parameters to the drive.
</p>
</dd>
<dt><code>format <var>drvsel szcod sect-per-track fmt-gap fmt-fill</var></code></dt>
<dd><p>Formats the cylinder. The new sectors are filled with <var>fmt-fill</var>.
The header information comes from the input, which is made up of
<var>cyl head sect szcod</var> quadruples. The <var>szcod</var> parameter
from the command line is used to describe the actual size of the
sectors, and the <var>szcod</var> from the input is used to write into the
header. However, the first write to these sectors will use the header
information, and might overwrite the following sectors if the
<var>szcod</var> parameter from the command line was too small.
</p>
</dd>
<dt><code>readid <var>drvsel</var></code></dt>
<dd><p>reads the first sector header that comes and returns 
<var>ST0 ST1 ST2 </var>
and 
<var>cyl head sect szcod </var>
of the encountered header.
</p></dd>
</dl>

<a name="Commands-available-on-82072-and-later"></a>
<h4 class="subsubsection">10.4.2.2 Commands available on 82072 and later</h4>

<dl compact="compact">
<dt><code>dumpregs</code></dt>
<dd><p>Prints the contents of the FDCs registers, if supported.
</p></dd>
</dl>

<a name="Commands-available-on-82072A-and-later"></a>
<h4 class="subsubsection">10.4.2.3 Commands available on 82072A and later</h4>

<dl compact="compact">
<dt><code>configure <var>conf1 conf2 conf3</var></code></dt>
<dd><p>Configures FIFO operation.
</p></dd>
</dl>

<a name="Commands-available-on-82077-and-later"></a>
<h4 class="subsubsection">10.4.2.4 Commands available on 82077 and later</h4>

<dl compact="compact">
<dt><code>version</code></dt>
<dd><p>Echoes 0x90 if the FDC is more recent than 82072A, and 0x80 otherwise
</p>
</dd>
<dt><code>perpendicular <var>rate</var></code></dt>
<dd><p>Sets the perpendicular mode.  Use 0 for normal, 2 for 500kb/s
perpendicular, and 3 for 1 Mb/s perpendicular.
</p>
</dd>
<dt><code>seek_out <var>drvsel n</var></code></dt>
<dd><p>does a relative seek of
<var>n</var>
cylinders towards cylinder 0.
</p>
</dd>
<dt><code>seek_in  <var>drvsel n</var></code></dt>
<dd><p>does a relative seek of <var>n</var> cylinders away from cylinder 0.
</p></dd>
</dl>


<a name="Commands-available-on-82077AA-and-later"></a>
<h4 class="subsubsection">10.4.2.5 Commands available on 82077AA and later</h4>

<dl compact="compact">
<dt><code>lock</code></dt>
<dd><p>Locks the FIFO configuration, so that it survives a FDC software reset.
</p></dd>
<dt><code>unlock</code></dt>
<dd><p>Unlock the FIFO configuration
</p></dd>
</dl>

<a name="Commands-available-on-82078"></a>
<h4 class="subsubsection">10.4.2.6 Commands available on 82078</h4>

<dl compact="compact">
<dt><code>partid</code></dt>
<dd><p>echoes a byte describing the type of the FDC in the 3 high bits, and
the stepping in the three low bits.
</p>
</dd>
<dt><code>powerdown <var>powerconf</var></code></dt>
<dd><p>configures automatic power down of the FDC. The old configuration is echoed
</p>
</dd>
<dt><code>option <var>iso</var></code></dt>
<dd><p>enables/disables ISO formats. Odd values of
<var>iso</var>
enable these formats, whereas even values disable them. ISO formats
don&rsquo;t have index headers, and thus allow to fit slightly more data on
a disk.
</p>
</dd>
<dt><code>save</code></dt>
<dd><p>prints out 16 internal registers of the FDC.
</p>
</dd>
<dt><code>restore <var>r1 r2 r3 ... r16</var></code></dt>
<dd><p>restores the 16 internal registers of the FDC.
</p>
</dd>
<dt><code>format_n_write <var>drvsel szcod sect-per-track fmt-gap fmt-fill</var></code></dt>
<dd><p>formats the cylinder and writes initial data to it. The input data is
made up of a sequence of headers (4 bytes) and data:
<var>header1 data1 header2 data2 ... headern datan</var>
</p>
</dd>
<dt><code>drivespec <var>dspec1 dspec2 ... specn terminator</var></code></dt>
<dd><p>chooses rate tables for various drives. Each dspec byte describes one
drive. Bits 0 and 1 say which drive is described. Bits 2 and 3 describe
the rate table. Only tables 0 and 2 are interesting. Both tables only
differ in the meaning of rate 1. For table 0 (the default) rate 0 is 300
kb/s (used for 5 1/4 DD disks), whereas for table 1 it is 2 Mbps (used
for fast floppy tape drives). Bit 4 is the precompensation table select
bit. It should be set to 0. Bit 5-7 should be zero as well. The
<var>terminator</var> byte ends the <code>drivespec</code> command. It is either
0xc0 or 0x80. If it is 0xc0, no result phase follows; if it is 0x80, the
current data rate table configuration for the four drives is echoed.
</p></dd>
</dl>

<a name="Modes"></a>
<h4 class="subsection">10.4.3 Modes</h4>
<p>The mode option is only needed when you describe the command as a
numerical value. Some mode names are also valid command names. They
are considered as command name if the command name has not yet been
given, and as mode name otherwise.
</p>
<p>If you give a command name followed by explicit modes, both the
implicit flags of the command name, and the explicit modes are or&rsquo;ed
together.
</p>
<p>If on the other hand you give a command name preceded by explicit
modes, only the explicit modes are or&rsquo;ed together.
</p>
<dl compact="compact">
<dt><code>read</code></dt>
<dd><p>Read data from disk using DMA.
</p>
</dd>
<dt><code>write</code></dt>
<dd><p>Write data to the disk.
</p>
</dd>
<dt><code>intr</code></dt>
<dd><p>Wait for an interrupt.
</p>
</dd>
<dt><code>spin</code></dt>
<dd><p>wait for the disk to spin up
</p>
</dd>
<dt><code>disk</code></dt>
<dd><p>Aborts the operation if no disk is in the drive. This only works if you
also chose a physical cylinder to seek to.
</p>
</dd>
<dt><code>no-motor</code></dt>
<dd><p>Don&rsquo;t switch on the drive motor while issuing the command
</p>
</dd>
<dt><code>no-motor-after</code></dt>
<dd><p>Switch off the motor immediately after the command returns.
</p>
</dd>
<dt><code>fm</code></dt>
<dd><p>Uses the FM version of the <code>read</code>, <code>readid</code>, <code>write</code> and
<code>format</code> commands.
</p>
</dd>
<dt><code>no-mt</code></dt>
<dd><p>Do not use MT (multitrack) mode for the <code>read</code>, <code>readid</code> and
<code>write</code> commands. This is needed on certain broken FDC&rsquo;s which
don&rsquo;t recognize end of transfer when running in <code>nodma</code> mode. In
order to use these safely, set <code>no-mt</code>, and chose the id of the
last sector to be read as <code>sect-per-track</code>.
</p>
</dd>
</dl>

<p><code>fdrawcmd</code> opens the device node with the <code>NDELAY</code> flag. This
means that the driver should not try to autodetect the disk type (it
might not be formatted), and that it should not reset the FDC. If a
reset was needed, the command simply fails. If that happens, execute
<code>floppycontrol --resetnow 0</code> , and try again.
</p>

<hr>
<a name="floppycontrol"></a>
<div class="header">
<p>
Next: <a href="#floppymeter" accesskey="n" rel="next">floppymeter</a>, Previous: <a href="#fdrawcmd" accesskey="p" rel="prev">fdrawcmd</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="floppycontrol-1"></a>
<h3 class="section">10.5 floppycontrol</h3>
<a name="index-floppycontrol"></a>
<a name="index-configuration-of-floppy-driver"></a>

<div class="example">
<pre class="example"><code>floppycontrol</code> [<code>-p</code>] [<code>--pollstate</code>] [<code>--printfdstate</code>]
[<code>-a</code> <var>operation-abort-threshold</var>] [<code>-c</code> <var>read-track-threshold</var>]
[<code>-r</code> <var>recalibrate-threshold</var>] [<code>-R</code> <var>reset-threshold</var>]
[<code>-e</code> <var>reporting-threshold</var>] [<code>-f</code>] [<code>-x</code>] [<code>-d</code> <var>drive</var>][<code>-F</code>] [<code>-T</code>]
[<code>-reset</code> <var>condition</var>] [<code>--debug</code>] [<code>--nodebug</code>] [<code>--messages</code>]
[<code>--nomessages</code>] [<code>--broken_dcl</code>] [<code>--working_dcl</code>] [<code>--inverted_dcl</code>]
[<code>--no_inverted_dcl</code>] [<code>--silent_dcl_clear</code>] [<code>--noisy_dcl_clear</code>]
[<code>-c</code><var>cmos-type</var>] [<code>-hlt</code> <var>hlt</var>] [<code>-hut</code> <var>hut</var>] [<code>-srt</code> <var>srt</var>] [<code>-o</code> <var>spindown</var>]
[<code>-u</code> <var>spinup</var>] [<code>-s</code> <var>select-delay</var>] [<code>-rps</code> <var>rotations-per-second</var>]
[<code>-O</code> <var>spindown-offset</var>] [<code>-track</code> <var>max-tracks</var>] [<code>-timeout</code> <var>seconds</var>]
[<code>-C</code> <var>check-interval</var>] [<code>-n</code> <var>native-format</var>]
[<code>-autodetect</code> <var>autodetection-sequence</var>] [<code>-P</code>] [<code>--clrwerror</code>]
[<code>--printwerror</code>] [<code>-h</code>]
</pre></div>

<p>The <code>floppycontrol</code> program is used to configure the floppy driver.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#General-options" accesskey="1">General options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">General purpose options
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#One-time-actions" accesskey="2">One time actions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Perform various actions
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Printing-options" accesskey="3">Printing options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Print out current configuration
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Drive-type-configuration" accesskey="4">Drive type configuration</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Do you have a 3 1/2 double density drive or
                             a 5 1/4 high density drive?
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#DCL-configuration" accesskey="5">DCL configuration</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Disk change line configuration.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Timing-parameters" accesskey="6">Timing parameters</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Change the timings of various operations
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Debugging" accesskey="7">Debugging</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Switching debugging messages on/off
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Error-handling-options" accesskey="8">Error handling options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">How should the floppy driver react when
                             encountering disk errors
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Write-error-reporting" accesskey="9">Write error reporting</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">gather statistics about write errors
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Misc-options">Misc options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Other configuration options
</td></tr>
</table>

<hr>
<a name="General-options"></a>
<div class="header">
<p>
Next: <a href="#One-time-actions" accesskey="n" rel="next">One time actions</a>, Previous: <a href="#floppycontrol" accesskey="p" rel="prev">floppycontrol</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="General-Options"></a>
<h4 class="subsection">10.5.1 General Options</h4>

<dl compact="compact">
<dt><code>-h</code></dt>
<dt><code>--help</code></dt>
<dd><p>Print a help screen.
</p>
</dd>
<dt><code>-d <var>drive</var></code></dt>
<dt><code>--drive <var> drive</var></code></dt>
<dd><p>Selects the drive to configure. The default is drive 0
(<samp>/dev/fd0</samp>).
</p>
</dd>
</dl>

<hr>
<a name="One-time-actions"></a>
<div class="header">
<p>
Next: <a href="#Printing-options" accesskey="n" rel="next">Printing options</a>, Previous: <a href="#General-options" accesskey="p" rel="prev">General options</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="One-time-actions-1"></a>
<h4 class="subsection">10.5.2 One time actions</h4>
<a name="index-ejecting-a-disk"></a>
<a name="index-flushing-floppy-cache"></a>
<a name="index-resetting-controller"></a>

<p>The following <code>floppycontrol</code> options don&rsquo;t set a configuration
parameter, but perform a one-time action. They are available to anybody
who has write access to the drive
</p>
<dl compact="compact">
<dt><code>-f</code></dt>
<dt><code>--flush</code></dt>
<dd><p>Flushes (throws away) the dirty data buffers associated with this drive.
</p></dd>
<dt><code>-x</code></dt>
<dt><code>--eject</code></dt>
<dd><p>Ejects the disk out of the drive (Sparc). The dirty buffers are first
committed to disk before ejecting it. Fails if the disk is mounted.
</p>
</dd>
<dt><code>--reset <var> condition</var></code></dt>
<dd><p>Resets the FDC under
<var>condition</var> . Condition may be one of the following:
</p><dl compact="compact">
<dt><code>0</code></dt>
<dd><p>resets the FDC only if a reset is needed anyways,
</p></dd>
<dt><code>1</code></dt>
<dd><p>resets the FDC
also if a raw command has been performed since the last reset, and 
</p></dd>
<dt><code>2</code></dt>
<dd><p>resets the FDC unconditionally.
</p></dd>
</dl>

<p>This command may be needed after some failed raw commands
(see <a href="#fdrawcmd">fdrawcmd</a>).
</p>

</dd>
<dt><code>-F</code></dt>
<dt><code>--formatend</code></dt>
<dd><p>Issues an end format ioctl. This might be needed after exiting a
<code>fdformat</code> in an unclean way. <code>superformat</code> is not subject to
this.
</p>
</dd>
</dl>

<hr>
<a name="Printing-options"></a>
<div class="header">
<p>
Next: <a href="#Drive-type-configuration" accesskey="n" rel="next">Drive type configuration</a>, Previous: <a href="#One-time-actions" accesskey="p" rel="prev">One time actions</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Printing-current-settings"></a>
<h4 class="subsection">10.5.3 Printing current settings</h4>
<a name="index-printing-current-settings"></a>
<a name="index-determining-drive-type"></a>
<a name="index-detecting-a-disk-change"></a>

<dl compact="compact">
<dt><code>-T</code></dt>
<dt><code>--type</code></dt>
<dd><p>Print out the drive name of a floppy device. This is used by the
<code>MAKEFLOPPIES</code> script. The drive name is a letter (describing the
drive type) followed by the capacity of the format in bytes. The letter
is E for 3.5 ED drives, H for 3.5 HD drives, D for 3.5 DD drives, h for
5.25 HD drives and d for 5.25 DD drives. The drive type letter
corresponds to the oldest drive type supporting the format of this
device node (not necessarily the type of the drive referred by this
node.)  For the generic format nodes (/dev/fd0 et al.)  the name of
&quot;native format&quot; of the drive is printed, and for the default formats, if
a generic format has been redefined, its name becomes <code>(null)</code>.
</p>
</dd>
<dt><code>-p</code></dt>
<dt><code>--print</code></dt>
<dd><p>Prints out the configuration of the drive. The names of the various
fields are the same as the names of the option to set them, see below.
</p>
</dd>
<dt><code>-P</code></dt>
<dt><code>--printstate</code></dt>
<dd><p>Prints out the cached internal state of the driver. The first line lists
various attributes about the disk:
</p><dl compact="compact">
<dt><code>drive present</code></dt>
<dt><code>disk present</code></dt>
<dt><code>disk writable</code></dt>
<dd><p>These are only updated when the drive is accessed.
</p></dd>
<dt><code>spinup</code></dt>
<dd><p>is the time when the motor became switched on for the last time.
</p>
</dd>
<dt><code>select</code></dt>
<dd><p>is the time when the drive became selected for the last time
</p>
</dd>
<dt><code>first_read</code></dt>
<dd><p>is the time when the first read request after the last spin up
completed.
</p>
</dd>
<dt><code>probed_fmt</code></dt>
<dd><p>is the index of the autodetected format in the autodetection
sequence for this drive.
</p>
</dd>
<dt><code>cylinder</code></dt>
<dd><p>is the cylinder where the drive head currently sits.  If this number is negative, it has the following meaning:
</p><ul>
<li> -1 means that the driver doesn&rsquo;t know, but the controller does (a seek
command must be issued).
</li><li> -2 means that the controller doesn&rsquo;t know either, but is sure that it
not beyond the 80th track.  The drive needs a recalibration.
</li><li> -3 means that the head may be beyond the 80th track.  The drive needs
two successive recalibrations, because at each recalibration, the
controller only issues 80 move head commands per recalibration.
</li></ul>

</dd>
<dt><code>maxblock</code></dt>
<dd><p>is the highest block number that has been read.
</p></dd>
<dt><code>maxcylinder</code></dt>
<dd><p>is a boolean which is set when a sector that is not on cylinder 0/head 0
has been read.  These are used for smart invalidation of the buffer
cache on geometry change.  The buffer cache of the drive is only
invalidated on geometry change when this change actually implies that a
block that has already been read changes position. This optimization is
useful for mtools which changes the geometry after reading the boot
sector.
</p>
</dd>
<dt><code>generation</code></dt>
<dd><p>is roughly the number of disk changes noticed since boot. Disk changes
are noticed if the disk is actually changed, or if a flush command is
issued and for both cases if any I/O to/from the disk occurs. (i.e. if
you insert several disks, but don&rsquo;t do any I/O to them, the generation
number stays the same.)
</p>
</dd>
<dt><code>refs</code></dt>
<dd><p>is number of open file descriptors for this drive. It is always at
least one, because floppycontrol&rsquo;s file descriptor is counted too.
</p>
</dd>
<dt><code>device</code></dt>
<dd><p>is format type (as derived from the minor device number) which is
currently being used.
</p>
</dd>
<dt><code>last_checked</code></dt>
<dd><p>is date (in jiffies) when the drive was last checked for a disk
change, and a disk was actually in the drive.
</p></dd>
</dl>


</dd>
<dt><code>--pollstate</code></dt>
<dd><p>Polls the drive and then prints out the internal state of the
driver.(<code>--Printstate</code> only prints out the cached information
without actually polling the drive for a disk change.)
</p>
</dd>
<dt><code>--printfdcstate</code></dt>
<dd><p>Prints out the state of the controller where the target drive is
attached to.
</p><dl compact="compact">
<dt><code>spec1</code></dt>
<dt><code>spec2</code></dt>
<dd><p>are the current values of those registers.
</p>
</dd>
<dt><code>rate</code></dt>
<dd><p>is current data transfer rate
</p>
</dd>
<dt><code>rawcmd</code></dt>
<dd><p>is true if a raw command has been executed since the last reset. If this
is the case, a reset will be triggered when a drive on the same FDC is
next opened.
</p>
</dd>
<dt><code>dor</code></dt>
<dd><p>is the value of the digital output register. The 4 high bits are a bit
mask describing which drives are spinning, the 2 low bits describe the
selected drive, bit 2 is used to reset the FDC, and bit 3 describes
whether this FDC has hold of the interrupt and the DMA. If you have two
FDCs, bit 3 is only set on one of them.
</p>
</dd>
<dt><code>version</code></dt>
<dd><p>is the version of the FDC. See <samp>linux/include/linux/fdreg.h</samp> for a
listing of the FDC version numbers.
</p>
</dd>
<dt><code>reset</code></dt>
<dd><p>is true if a reset needs to be issued to the FDC before processing the
next request.
</p>
</dd>
<dt><code>need_configure</code></dt>
<dd><p>is true if this FDC needs configuration by the <code>FD_CONFIGURE</code>
command.
</p>
</dd>
<dt><code>has_fifo</code></dt>
<dd><p>is set if the FDC understands the <code>FD_CONFIGURE</code> command.
</p>
</dd>
<dt><code>perp_mode</code></dt>
<dd><p>describes the perpendicular mode of this FDC. 0 is non-perpendicular mode,
2 is HD perpendicular mode, 3 is ED perpendicular mode, and 1 is unknown.
</p>
</dd>
<dt><code>address</code></dt>
<dd><p>is the address of the first I/O port of the FDC.  Normally, this is
0x3f0 for the first FDC and 0x370 for the second.
</p></dd>
</dl>

</dd>
</dl>

<hr>
<a name="Drive-type-configuration"></a>
<div class="header">
<p>
Next: <a href="#DCL-configuration" accesskey="n" rel="next">DCL configuration</a>, Previous: <a href="#Printing-options" accesskey="p" rel="prev">Printing options</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Drive-type-configuration-and-autodetection"></a>
<h4 class="subsection">10.5.4 Drive type configuration and autodetection</h4>
<a name="index-CMOS-type"></a>
<a name="index-drive-type"></a>
<a name="index-swapping-drives"></a>

<p>The following options handle the different available drive types, such
as double density vs. high density vs. extra density drives, and 5 1/4
drives vs 3 1/2 drives.  Usually the drive type is stored in a
non-volatile memory, called CMOS, under the form of an integer ranging
from 1 to 6.
</p>
<p>Different drive types are able to handle and autodetect different
formats (different autodetection lists). They also have different
&quot;native format name&quot;. The native format is the &quot;usual&quot; format with the
highest capacity supported by the drive. (For example 720KB on a double
density 3 1/2 drive, and 1.2MB on a high density 5 1/4 drive.)
</p>
<p>These settings are only changeable by the super user.
</p>
<dl compact="compact">
<dt><code>-c <var>cmos-type</var></code></dt>
<dt><code>--cmos <var> cmos-type</var></code></dt>
<dd><p>Set the virtual CMOS type of the floppy drive. This is useful if
</p><ul>
<li> the physical CMOS type is wrong (this may happen with BIOSes
which use a non-standard mapping),
</li><li> you have more than two drives
(the physical CMOS may only describe up to two drives).
</li><li> you have a BIOS that allows swapping drives A: and B: for DOS.
</li></ul>
 
<p>Right now, this CMOS parameter is not used by the kernel, except for
feeding it back to other applications (for instance <code>superformat</code>,
<code>floppymeter</code> or <code>MAKEFLOPPIES</code>).  It is also possible to
supply a virtual CMOS type with the <code>cmos</code> boot option
(see <a href="#Boottime-configuration">Boottime configuration</a>).  If possible, I recommend you use the
boot option, rather than <code>floppycontrol</code>, because the boot option
also sets any parameters derived from the CMOS type, such as the
autodetection list and the native format, whereas <code>floppycontrol</code>
does not.
</p>
</dd>
<dt><code>-A  <var>autodetect-seq</var></code></dt>
<dt><code>--autodetect <var> autodetect-seq</var></code></dt>
<dd><p>Set the autodetection sequence (see <a href="#Autodetection">Autodetection</a>) The autodetection
sequence is a comma-separated list of at most eight format
descriptors. Each format descriptor is a format number optionally
followed by the letter <code>t</code>.  For drive 0, the format number is the
minor device number divided by 4.  The autodetection sequence is used by
the driver to find out the format of a newly inserted disk. The formats
are tried one after the other, and the first matching format is
retained. To test the format, the driver tries to read the first sector
on the first track on the first head when <code>t</code> is not given, or the
whole first track when <code>t</code> is given. Thus, autodetection cannot
detect the number of tracks. However, this information is contained in
the boot sector, which is now accessible. The boot sector can then be
used by mtools to configure the correct number of tracks.
</p>
<p>Example:
</p><div class="example">
<pre class="example">7,4,24t,25
</pre></div>
<p>means to try out the formats whose minor device numbers are 28 (1.44M),
16 (720KB), 96 (1.76MB), and 100 (1.92MB), in this order. For the 1.76MB
format, try to read the whole track at once.
</p>
<p>Reading the whole track at once allows you to distinguish between two
formats which differ only in the number of sectors. (The format with the
most sectors must be tried first.)  If you use mtools<a name="DOCF6" href="#FOOT6"><sup>6</sup></a>, you do not need this feature, as mtools can figure out
the number of sectors without any help from the floppy driver, by
looking at the boot sector.
</p>
<p>Reading the whole track at once may also speed up the first read by 200
milliseconds. However, if, on the other hand, you try to read a disk
which has less sectors than the format, you lose some time.
</p>
<p>I suggest that you put the most often used format in the first place
(barring other constraints), as each format that is tried out takes
400 milliseconds.
</p>
</dd>
<dt><code>-n <var>native-format</var></code></dt>
<dt><code>--native_format <var> native-format</var></code></dt>
<dd><p>Set the native format of this drive. The native format of a drive is the
highest standard format available for this drive. (Example: For a 5 1/4
HD drive it is the usual 1200K format.) This is format is used to make
up the format name for the generic device (which is the name of the
native format). This drive name is read back from the kernel by the
<code>MAKEFLOPPIES</code> script which uses it to decide which device nodes to
create.
</p>
</dd>
</dl>


<hr>
<a name="DCL-configuration"></a>
<div class="header">
<p>
Next: <a href="#Timing-parameters" accesskey="n" rel="next">Timing parameters</a>, Previous: <a href="#Drive-type-configuration" accesskey="p" rel="prev">Drive type configuration</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Configuration-of-the-disk-change-line"></a>
<h4 class="subsection">10.5.5 Configuration of the disk change line</h4>
<a name="index-disk-change-line"></a>
<a name="index-Thinkpad"></a>
<a name="index-disk-change-detection"></a>
<a name="index-disk-absent-during-operation-_0028false-alert_0029"></a>

<dl compact="compact">
<dt><code>--broken_dcl</code></dt>
<dd><p>Assumes that the disk change line of the drive is broken.  If this is
set, disk changes are assumed to happen whenever the device node is
first opened. The physical disk change line is ignored.
</p>
<p>This option should be used if disk changes are either not detected at
all, or if disk changes are detected when the disk was actually not
changed.  If this option fixes the problem, I&rsquo;d recommend that you try to
trace the root cause of the problem.  Indeed, this options results in
reduced performance due to spurious cache flushes.  
</p>
<p>The following hardware problems may lead to a bad disk change line:
</p><ul>
<li> If the floppy cable is not inserted straight, or if it is kinked, the
disk change line is likely to suffer, as it is on the edge of the cable.
Gently press on both connectors of the cable (drive and controller) to
insure that all wires make contact.  Visually inspect the cable, and if
it shows obvious traces of damage, get a new one.
</li><li> On some drives, the locations disk change line may be chosen by
jumper. Make sure that your floppy controller and your drive agree on
which line is the disk change line. 
</li><li> Some older drives (mostly double density 5 1/4 drives) don&rsquo;t have a disk
change line.  In this case, you have no choice other than to leave the
<code>broken_dcl</code> option on.
</li></ul>

</dd>
<dt><code>--working_dcl</code></dt>
<dd><p>Assumes that the disk change line works all right. Switching from
broken to working may lead to unexpected results after the first disk
change.
</p>
</dd>
<dt><code>--inverted_dcl</code></dt>
<dd><p>Assumes that this disk drive uses an inverted disk change
line. Apparently this is the case for IBM thinkpads.
</p>
</dd>
<dt><code>--no_inverted_dcl</code></dt>
<dd><p>Assumes that this drive follows the standard convention for the disk
change line.
</p>
</dd>
<dt><code>--noisy_dcl_clear</code></dt>
<dd><p>Switches off silent disk change line clearing for this drive.
</p>
</dd>
</dl>

<hr>
<a name="Timing-parameters"></a>
<div class="header">
<p>
Next: <a href="#Debugging" accesskey="n" rel="next">Debugging</a>, Previous: <a href="#DCL-configuration" accesskey="p" rel="prev">DCL configuration</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Timing-Parameters"></a>
<h4 class="subsection">10.5.6 Timing Parameters</h4>
<a name="index-strange-noises-during-seek"></a>

<p>This section describes how to configure drive timings.  To set these
parameters, you need superuser privileges. All times are in &quot;jiffy&quot;
units (10 milliseconds), unless otherwise specified.
</p>
<dl compact="compact">
<dt><code>--hlt <var> hlt</var></code></dt>
<dd><p>Set the head load time (in microseconds) for this floppy drive.  The
head load time describes how long the floppy controller waits after
seeking or changing heads before allowing access to a track.
</p>
</dd>
<dt><code>--hut <var> hut</var></code></dt>
<dd><p>Set the head unload time (in microseconds) for this floppy drive.  The
head unload time describes how long the floppy controller waits after an
access before directing its attention to the other head, or before
seeking.
</p>
</dd>
<dt><code>--srt <var> srt</var></code></dt>
<dd><p>Set the step rate (in microseconds) for this floppy drive.  The step
rate describes how long the drive head stays on one cylinder when
seeking.  Setting this value to low (too fast seeks) may make seeks
fail, because the motor doesn&rsquo;t follow fast enough.
</p>
</dd>
<dt><code>-u <var>spinup-time</var></code></dt>
<dt><code>--spinup <var> spinup-time</var></code></dt>
<dd><p>Set the spinup time of the floppy drive. In order to do read or write
to the floppy disk, it must spin. It takes a certain time for the
motor to reach enough speed to read or write. This parameter describes
this time. The floppy driver doesn&rsquo;t try to access the drive before
the spinup time has elapsed. With modern controllers, you may set this time
to zero, as the controller itself enforces the right delay.
</p>
</dd>
<dt><code>-o <var>spindown-time</var></code></dt>
<dt><code>--spindown <var> spindown-time</var></code></dt>
<dd><p>Set the spindown time of this floppy drive. The motor is not stopped
immediately after the operation completes, because there might be more
operations following. The spindown time is the time the driver waits
before switching off the motor.
</p>
</dd>
<dt><code>-O <var>spindown-offset</var></code></dt>
<dt><code>--spindown_offset <var> spindown-offset</var></code></dt>
<dd><p>Set the spindown offset of this floppy drive. This parameter is used
to set the position in which the disk stops. This is useful to
minimize the next access time. (If the first sector is just near the
head at the very moment at which the disk has reached enough speed,
you win 200 milliseconds against the most unfavorable situation).
</p>
<p>This is done by clocking the time where the first I/O request
completes, and using this time to calculate the current position of
the disk.
</p>
</dd>
<dt><code>-s <var>select-delay</var></code></dt>
<dt><code>--select_delay <var> select-delay</var></code></dt>
<dd><p>Set the <var>select delay</var> of this floppy drive. This is the delay that
the driver waits after selecting the drive and issuing the first command
to it. For modern controllers/drives, you may set this to zero.
</p>
</dd>
<dt><code>-C <var>check-interval</var></code></dt>
<dt><code>--checkfreq <var> check-interval</var></code></dt>
<dd><p>Set the maximal disk change check interval.  The disk change line is
checked whenever a read or write to the device is issued, and it has not
been checked for more than <var>interval</var> jiffies.
</p></dd>
</dl>


<hr>
<a name="Debugging"></a>
<div class="header">
<p>
Next: <a href="#Error-handling-options" accesskey="n" rel="next">Error handling options</a>, Previous: <a href="#Timing-parameters" accesskey="p" rel="prev">Timing parameters</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Debugging-messages"></a>
<h4 class="subsection">10.5.7 Debugging messages</h4>

<p>This subsection describes how to switch the available debugging messages
on and off.
</p>
<dl compact="compact">
<dt><code>--debug</code></dt>
<dd><p>Switch debugging output on. The debugging information includes timing
information. This option might be useful to fine-tune the timing
options for your local setups. (But for most normal purposes, the
default values are good enough.)
</p>
</dd>
<dt><code>--nodebug</code></dt>
<dd><p>Switch debugging output off.
</p>
</dd>
<dt><code>--messages</code></dt>
<dd><p>Print informational messages after autodetection, geometry parameter
clearing and dma over/underruns.
</p>
</dd>
<dt><code>--nomessages</code></dt>
<dd><p>Don&rsquo;t print informational messages after these events.
</p>
</dd>
</dl>


<hr>
<a name="Error-handling-options"></a>
<div class="header">
<p>
Next: <a href="#Write-error-reporting" accesskey="n" rel="next">Write error reporting</a>, Previous: <a href="#Debugging" accesskey="p" rel="prev">Debugging</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Error-Handling-Options"></a>
<h4 class="subsection">10.5.8 Error Handling Options</h4>

<p>The following options configure the behavior of the floppy driver in
case of read/write errors. They may be used by any user who has write
privileges for the drive. Whenever the floppy driver encounters an
error, a retry counter is incremented. If the value of this counter gets
bigger than the thresholds described below, the corresponding actions
are performed at the next retry. The counter is reset when the read or
write finally terminates, whether successfully or not.
</p><dl compact="compact">
<dt><code>-a <var>operation-abort-threshold</var></code></dt>
<dt><code>--abort <var> operation-abort-threshold</var></code></dt>
<dd><p>Tell the floppy driver to stop trying to read/write a sector after
<var>operation-abort-threshold</var>
retries, and signal the I/O error to the user.
</p>
</dd>
<dt><code>-t <var>read-track-threshold</var></code></dt>
<dt><code>--readtrack <var> read-track-threshold</var></code></dt>
<dd><p>Tell the floppy driver to switch from track-reading mode to
sector-at-a-time-mode after
<var>read-track-threshold</var>
retries.
</p></dd>
<dt><code>-r <var>recalibrate-threshold</var></code></dt>
<dt><code>--recalibrate <var> recalibrate-threshold</var></code></dt>
<dd><p>Tell the floppy driver to recalibrate the drive after
<var>recalibrate-threshold</var> retries.
</p>
</dd>
<dt><code>-R <var>reset-threshold</var></code></dt>
<dt><code>--reset <var> reset-threshold</var></code></dt>
<dd><p>Tell the floppy driver to reset the controller after
<var>reset-threshold</var> retries. After a controller reset, the floppy
driver also recalibrates all drives connected to that controller.
</p>

</dd>
<dt><code>-e <var>error-report-threshold</var></code></dt>
<dt><code>--reporting <var> error-report-threshold</var></code></dt>
<dd><p>Tell the floppy driver to start printing error messages to the console
after <var>error-report-threshold</var> retries.
</p></dd>
</dl>


<hr>
<a name="Write-error-reporting"></a>
<div class="header">
<p>
Next: <a href="#Misc-options" accesskey="n" rel="next">Misc options</a>, Previous: <a href="#Error-handling-options" accesskey="p" rel="prev">Error handling options</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Write-error-reporting-1"></a>
<h4 class="subsection">10.5.9 Write error reporting</h4>

<p>Due to the buffer cache, write errors cannot always be reported to the
writing user program as soon as the write system call returns.  Indeed,
the actual writing may take place much later. If a write error is
encountered, the floppy driver stores information about it in its per
drive write error structure.  This write error structure stays until
explicitly cleared.  It can for example be queried by a backup program
which wants to make sure that the data has been written successfully.
</p>
<dl compact="compact">
<dt><code>--clrwerror</code></dt>
<dd><p>Clears the write error structure.
</p>
</dd>
<dt><code>--printwerror</code></dt>
<dd><p>Prints the contents of the write error structure:
</p><dl compact="compact">
<dt><code>write_errors</code></dt>
<dd><p>is a count of how many write errors have occurred since the structure was last
cleared.
</p></dd>
<dt><code>badness</code></dt>
<dd><p>is the maximal number of retries that were needed to complete an
operation (reads, writes and formats).
</p></dd>
<dt><code>first_error_sector</code></dt>
<dd><p>is where the first (chronologically) write error occurred.
</p></dd>
<dt><code>first_error_generation</code></dt>
<dd><p>is the disk change generation in which did the first write error
occurred.  The disk change generation is a number which is incremented
at each disk change.
</p></dd>
<dt><code>last_error_sector</code></dt>
<dd><p>and
</p></dd>
<dt><code>last_error_generation</code></dt>
<dd><p>are similar.
</p></dd>
</dl>

</dd>
</dl>


<hr>
<a name="Misc-options"></a>
<div class="header">
<p>
Previous: <a href="#Write-error-reporting" accesskey="p" rel="prev">Write error reporting</a>, Up: <a href="#floppycontrol" accesskey="u" rel="up">floppycontrol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Other-drive-configuration-options"></a>
<h4 class="subsection">10.5.10 Other drive configuration options</h4>

<p>This subsection lists per drive configuration options, which don&rsquo;t fit
in any other category.  They are available only to the superuser:
</p>
<dl compact="compact">
<dt><code>--tracks <var> max-tracks</var></code></dt>
<dd><p>Set the maximal numbers of physical tracks that this drive may
handle. If you have a drive which is only able to handle 80 tracks
(making strange noises when you try to format or read a disk with more
than 80 tracks), use this option to prevent unprivileged users of
damaging your drive by repeatedly reading disks with more than 80
tracks.
</p>
<p>If you trust your users and your disks, you don&rsquo;t need this. With most
drives you don&rsquo;t need to worry anyways. See <a href="#More-cylinders">More cylinders</a>, for
details.
</p>
</dd>
<dt><code>-i <var>sector-interleave</var></code></dt>
<dt><code>--interleave <var>sector-interleave</var></code></dt>
<dd><p>Set the number of sectors beyond which sector interleaving will be used.
This option will only be used by the <code>FDFMTTRK</code> ioctl.  The
<code>fdformat</code> command, which is now considered obsolete, uses
<code>FDFMTTRK</code> ioctl, but <code>superformat</code> does not.
</p>
</dd>
</dl>
<hr>
<a name="floppymeter"></a>
<div class="header">
<p>
Next: <a href="#getfdprm" accesskey="n" rel="next">getfdprm</a>, Previous: <a href="#floppycontrol" accesskey="p" rel="prev">floppycontrol</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="floppymeter-1"></a>
<h3 class="section">10.6 floppymeter</h3>
<a name="index-floppymeter"></a>
<a name="index-rotation-speed"></a>
<a name="index-raw-capacity"></a>

<div class="example">
<pre class="example"><code>floppymeter</code> [<code>-f</code>] [<code>-w</code> <var>warmup-delay</var>] [<code>-W</code> <var>window</var>]
[<code>-c</code> <var>cycles</var>] [<code>-h</code>] <var>drive</var>
</pre></div>

<p>The <code>floppymeter</code> program measures characteristic parameters of a
floppy drive and floppy controller, such as the rotation speed of the
drive, the data transfer rate of the controller, and the resulting raw
capacity of a disk track.  To use this program, insert a disposable
floppy in the drive, and type <code>floppymeter --</code><var>density</var>, where
density describes the density of the disk used for the test. (Should be
one of <code>dd, hd</code> or <code>ed</code>). <strong>CAUTION: the data on the
disk will be erased</strong>.  This program should be used to verify whether the
drive and controller are out of tolerance if you experience problems
with some high capacity formats.  It only needs to be run once per
drive: although a disk is needed to perform the measurements, the
measured data only depend on the drive and the controller, and not on
the disk.
</p>
<p>To measure the raw capacity of the disk track, the floppymeter program
formats the first track of the drive in a special way that allows it to
read the raw data (gaps and headers) of the disk. <strong>Thus, all data
previously stored on that disk is lost</strong>.
</p>
<p>The rotation speed is measured by timing the return time of a
<code>readid</code> command.  In order to gain more precision, the command is
issued many times in a row. During this phase, the number of rotations
since the start of the test, the average time per rotation since the start,
and a sliding average of the times of the last 30 rotations is printed,
and updated continuously.
</p>
<p>The data transfer rate is deduced from the two parameters above.
</p>
<p>At the end of the program, all parameters (raw capacity, duration of one
rotation, and data transfer rate) are printed again, as well as their
relative deviation to the standard value.  Finally, it suggests a
capacity deviation description line, which can be directly pasted into
the drive definition file (See <a href="#Drive-descriptions">Drive descriptions</a>.).
</p>
<p>Usually, the data transfer rate should not deviate more than 150 ppm
from the expected value, and the rotation speed of the drive should not
deviate more than 3000 ppm from the expected value.  If these deviations
are bigger, you may get problems with certain high capacity formats.
</p>
<p>If the raw capacity of the drive is too small, some high capacity
formats may become unformattable on this drive/controller combo.
</p>
<p>If on the other hand, the raw capacity of the drive is too big, you may
get problems when writing to a disk formatted by this drive on another
drive with a smaller raw capacity. In order to avoid this, increase
superformats gap parameter (<code>-G</code>).
</p>
<dl compact="compact">
<dt><code>-h</code></dt>
<dd><p>Prints a short help
</p>
</dd>
<dt><code>--dd</code></dt>
<dd><p>Tells the program that we use a Double Density disk.
</p>
</dd>
<dt><code>--hd</code></dt>
<dd><p>Tells the program that we use a High Density disk.
</p>
</dd>
<dt><code>--ed</code></dt>
<dd><p>Tells the program that we use an Extra Density disk.
</p>
</dd>
<dt><code>-f</code></dt>
<dd><p>Runs the measurement non interactively.  With this option, the program
doesn&rsquo;t ask for confirmation, and doesn&rsquo;t display the continuously
updated values during the rotation speed measurement.
</p>
</dd>
<dt><code>-W <var>Window</var></code></dt>
<dd><p>This value describes how many rotations are used for the computation of
the sliding average. Default is 30.
</p>
</dd>
<dt><code>-c <var>cycles</var></code></dt>
<dd><p>Describes the number of rotations clocked during the rotations speed
determination test. Default is 1000.
</p>
</dd>
</dl>

<a name="Bugs-3"></a>
<h4 class="subsection">10.6.1 Bugs</h4>

<p>This program is quite new, and may have bugs. Here are a few suggested
tests to check its sanity:
</p><ul>
<li> The deviation of the data transfer rate solely depends on the
controller. It should not be different between two drives connected to
the same controller. However, the drive rotation speed may be different
for different drives.
</li><li> All data transfer rates (for double, high and extra density) are derived
from a same master frequency. Thus the <em>deviation</em> of the data
transfer rate should be independent of the density used.
</li></ul>
<hr>
<a name="getfdprm"></a>
<div class="header">
<p>
Next: <a href="#makefloppies" accesskey="n" rel="next">makefloppies</a>, Previous: <a href="#floppymeter" accesskey="p" rel="prev">floppymeter</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="getfdprm-1"></a>
<h3 class="section">10.7 getfdprm</h3>
<a name="index-getfdprm"></a>
<a name="index-reading-back-the-geometry-information"></a>
<a name="index-geometry-information-_0028reading-back_0029"></a>

<div class="example">
<pre class="example"><code>getfdprm</code> [<var>drive</var>]
</pre></div>

<p><code>getfdprm</code>
prints the current geometry information for <var>drive</var> .
This information can be set using
<code>setfdprm</code>
</p>
<hr>
<a name="makefloppies"></a>
<div class="header">
<p>
Next: <a href="#setfdprm" accesskey="n" rel="next">setfdprm</a>, Previous: <a href="#getfdprm" accesskey="p" rel="prev">getfdprm</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="makefloppies-1"></a>
<h3 class="section">10.8 makefloppies</h3>

<div class="example">
<pre class="example"><code>MAKEFLOPPIES</code> [<code>-tlvng</code>] [<var>drives</var>]
</pre></div>

<p>The <code>MAKEFLOPPIES</code> shell script creates the new floppy block device
node.  It uses the floppycontrol program to translate the minor device
numbers into meaningful names. It also uses these names to decide
whether to create a given block device file or not, depending on the
type of the physical drive (for instance, for a 3 1/2 drive, the formats
corresponding to a 5 1/4 drive are not created).
</p>
<p>If you have more than two floppy drives, you need to tell the kernel
the CMOS types of those additional drives using the
<code>floppy=</code><var>drive</var><code>,</code><var>type</var><code>,cmos</code> lilo option.
</p>
<p>If the <var>drives </var> parameter is given, only the device nodes for the
listed drives are made. By default, all only the two first drives are
tried.
</p>
<p><code>MAKEFLOPPIES</code> does not work if you redefine your default formats.
</p>
<p><strong>Caution</strong>:
<code>MAKEFLOPPIES</code> removes already existing floppy device nodes.
</p>
<a name="Options-4"></a>
<h4 class="subsection">10.8.1 Options</h4>

<dl compact="compact">
<dt><code>-t</code></dt>
<dd><p>Use the old naming convention for 3 1/2 devices (e.g. <samp>fd0H720</samp>
instead of <samp>fd0u720</samp>).
</p>
</dd>
<dt><code>-m</code></dt>
<dd><p>Base the name for the created devices on the type of the media
(e.g. <samp>fd0h720</samp> instead of <samp>fd0u720</samp>).
</p>
</dd>
<dt><code>-l</code></dt>
<dd><p>Local. Creates device nodes in the local directory, not /dev
</p>
</dd>
<dt><code>-v</code></dt>
<dd><p>Verbose
</p>
</dd>
<dt><code>-n</code></dt>
<dd><p>Dry run. (just report what would be done, do not do anything)
</p>
</dd>
<dt><code>-g</code></dt>
<dd><p>Group.  Allow read/write access to floppy devices only for group
&lsquo;<samp>floppy</samp>&rsquo;
</p>
</dd>
</dl>

<a name="Bugs-4"></a>
<h4 class="subsection">10.8.2 Bugs</h4>
<p>The MAKEFLOPPIES script does not work on redefined &quot;default&quot; formats, If
you redefine default formats, you need to create the needed device nodes
manually.
</p><hr>
<a name="setfdprm"></a>
<div class="header">
<p>
Next: <a href="#superformat" accesskey="n" rel="next">superformat</a>, Previous: <a href="#makefloppies" accesskey="p" rel="prev">makefloppies</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="setfdprm-1"></a>
<h3 class="section">10.9 setfdprm</h3>
<a name="index-setfdprm"></a>
<a name="index-setting-the-geometry-information"></a>
<a name="index-geometry-information-_0028setting_0029"></a>

<div class="example">
<pre class="example"><code>setfdprm</code> [<code>-p</code>] <var>device</var> <var>media-description</var>

<code>setfdprm</code> [<code>-c</code> | <code>-y</code> | <code>-n</code>] <var>device</var>

</pre></div>

<p><code>setfdprm</code> is a utility that can be used to load disk parameters
into the auto-detecting floppy devices and &quot;fixed parameter&quot; floppy
devices, to clear old parameter sets and to disable or enable diagnostic
messages.  These parameters are derived from a media-description,
see <a href="#Media-description">Media description</a> for more details.
</p>
<p>Without any options, <code>setfdprm</code> loads the <var>device</var> (for example
<samp>/dev/fd0</samp> or <samp>/dev/fd1</samp>) with a new parameter set with the
<var>name</var> entry found in <samp>/etc/mediaprm</samp> (usually named 360/360,
etc.).  For autodetecting floppy devices, these parameters stay in
effect until the media is changed. For &quot;fixed parameter&quot; devices, they
stay in effect until they are changed again.
</p>
<p><code>Setfdprm</code> can also be used by the superuser to redefine the
default formats.
</p>
<a name="Options-5"></a>
<h4 class="subsection">10.9.1 Options</h4>

<dl compact="compact">
<dt><code>-p <var>device name</var></code></dt>
<dd><p>Permanently loads a new parameter set for the specified auto-configuring
floppy device for the configuration with <var>name</var> in
<samp>/etc/mediaprm</samp>. Alternatively, the parameters can be given directly
from the command line.
</p>
</dd>
<dt><code>-c <var>device</var></code></dt>
<dd><p>Clears the parameter set of the specified auto-configuring floppy device.
</p>
</dd>
<dt><code>-y <var>device</var></code></dt>
<dd><p>Enables format detection messages for the specified auto-configuring floppy
device.
</p>
</dd>
<dt><code>-n <var>device</var></code></dt>
<dd><p>Disables format detection messages for the specified auto-configuring
floppy device.
</p>
</dd>
</dl>

<a name="Bugs-5"></a>
<h4 class="subsection">10.9.2 Bugs</h4>
<p>This documentation is grossly incomplete.
</p><hr>
<a name="superformat"></a>
<div class="header">
<p>
Next: <a href="#xdfcopy" accesskey="n" rel="next">xdfcopy</a>, Previous: <a href="#setfdprm" accesskey="p" rel="prev">setfdprm</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="superformat-1"></a>
<h3 class="section">10.10 superformat</h3>
<a name="index-superformat"></a>
<a name="index-formatting-disks-_0028non-XDF_0029"></a>

<div class="example">
<pre class="example"><code>superformat</code> [<code>-D</code> <var>dos-drive</var>] [<code>-v</code> <var>verbosity-level</var>] [<code>-b</code> <var>begin-track</var>]
[<code>-e</code> <var>end-track</var>] [<code>--superverify</code>] [<code>--dosverify</code>]
[<code>--noverify</code>] [<code>--verify_later</code>] [<code>--zero-based</code>]
[<code>-G</code> <var>format-gap</var>] [<code>-F</code> <var>final-gap</var>] [<code>-i</code> <var>interleave</var>] [<code>-c</code> <var>chunksize</var>]
[<code>-g</code> <var>gap</var>] [<code>--absolute-skew</code> <var>absolute-skew</var>] [<code>--head-skew</code> <var>head-skew</var>]
[<code>--track-skew</code> <var>track-skew</var>] [<code>--biggest-last</code>] <var>drive</var> [<var>media-description</var>]
</pre></div>

<p><code>superformat</code> is used to format disks with a capacity of up to
1992K HD or 3984K ED.  See <a href="#Extended-formats">Extended formats</a>, for a detailed
description of these formats. See <a href="#Media-description">Media description</a>, for a detailed
description of the syntax for the media description.  If no media
description is given, superformat formats a disk in the highest
available density for that drive, using standard parameters (i.e. no
extra capacity formats).
</p>
<p>When the disk is formatted, <code>superformat</code> automatically invokes
<code>mformat</code> in order to put an MS-DOS filesystem on it. You may
ignore this filesystem, if you don&rsquo;t need it.
</p>
<p>Superformat allows one to format 2m formats.  Be aware, however, that these
<code>2m</code> formats were specifically designed to hold an MS-DOS
filesystem, and that they take advantage of the fact that the MS-DOS
filesystem uses redundant sectors on the first track (the FAT, which is
represented twice). The second copy of the FAT is <em>not</em> represented
on the disk.
</p>
<p>High capacity formats are sensitive to the exact rotation speed of the
drive and the resulting difference in raw capacity.  That&rsquo;s why
<code>superformat</code> performs a measurement of the disks raw capacity
before proceeding with the formatting.  This measurement is rather time
consuming, and can be avoided by storing the relative deviation of the
drive capacity into the drive definition file file. See <a href="#Drive-descriptions">Drive descriptions</a>, for more details on this file. The line to be inserted
into the drive definition file is printed by superformat after
performing its measurement.  However, this line depends on the drive and
the controller.  Do not copy it to other computers.  Remove it before
installing another drive or upgrade your floppy controller.  Swap the
drive numbers if you swap the drives in your computer.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Common-options" accesskey="1">Common options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">The most frequently used options
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Advanced-options" accesskey="2">Advanced options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">For experts
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Sector-skewing-options" accesskey="3">Sector skewing options</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Optimizing throughput by creatively
                                 arranging the sectors
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Examples" accesskey="4">Examples</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Some example command lines
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Troubleshooting" accesskey="5">Troubleshooting</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Most common failure modes
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Superformat-bugs" accesskey="6">Superformat bugs</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Nobody is perfect
</td></tr>
</table>

<hr>
<a name="Common-options"></a>
<div class="header">
<p>
Next: <a href="#Advanced-options" accesskey="n" rel="next">Advanced options</a>, Previous: <a href="#superformat" accesskey="p" rel="prev">superformat</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Common-Options"></a>
<h4 class="subsection">10.10.1 Common Options</h4>
<p>Many options have a long and a short form.
</p>
<dl compact="compact">
<dt><code>-h</code></dt>
<dt><code>--help</code></dt>
<dd><p>Print the help.
</p>
</dd>
<dt><code>-D <var>drive</var></code></dt>
<dt><code>--dosdrive <var>dos-drive</var></code></dt>
<dd><p>Selects DOS drive letter for <code>mformat</code> (for example <code>a:</code> or
<code>b:</code>).  The colon may be omitted.  The default is derived from the
minor device number.  If the drive letter cannot be guessed, and is not
given on the command line, <code>mformat</code> is skipped.
</p>
</dd>
<dt><code>-v <var>verbosity-level</var></code></dt>
<dt><code>--verbosity <var>verbosity-level</var></code></dt>
<dd><p>Sets the verbosity level. 1 prints a dot for each formatted track. 2
prints a changing sign for each formatted track (- for formatting the
first head, = for formatting the second head, x for verifying the
first head, and + for verifying the second head). 3 prints a complete
line listing head and track. 6 and 9 print debugging information.
</p>
</dd>
<dt><code>--superverify</code></dt>
<dd><p>Verifies the disk by first reading the track, than writing a pattern of
U&rsquo;s, and then reading it again.  This is useful as some errors only show
up after the disk has once been written.  However, this is also slower.
</p>
</dd>
<dt><code>-B</code></dt>
<dt><code>--dosverify</code></dt>
<dd><p>Verifies the disk using the <code>mbadblocks</code> program.
<code>mbadblocks</code> marks the bad sectors as bad in the FAT.  The
advantage of this is that disks which are only partially bad can still
be used for MS-DOS filesystems.
</p>
</dd>
<dt><code>-V</code></dt>
<dt><code>--verify_later</code></dt>
<dd><p>Verifies the whole disk at the end of the formatting process instead
of at each track. Verifying the disk at each track has the advantage
of detecting errors early on.
</p>
</dd>
<dt><code>-f</code></dt>
<dt><code>--noverify</code></dt>
<dd><p>Skips the verification altogether.
</p>
</dd>
<dt><code>--print-drive-deviation</code></dt>
<dd><p>Do not format, but print the drive deviation. If file
<samp>/etc/driveprm</samp> exists and provides a deviation for the drive,
nothing is printed and the disk is not formatted.
</p>
</dd>
</dl>

<hr>
<a name="Advanced-options"></a>
<div class="header">
<p>
Next: <a href="#Sector-skewing-options" accesskey="n" rel="next">Sector skewing options</a>, Previous: <a href="#Common-options" accesskey="p" rel="prev">Common options</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Advanced-Options"></a>
<h4 class="subsection">10.10.2 Advanced Options</h4>
<p>Usually, superformat uses sensible default values for these options,
which you normally don&rsquo;t need to override.  They are intended for expert
users.  Most of them should only be needed in cases where the hardware
or superformat itself has bugs.
</p>
<dl compact="compact">
<dt><code>-b <var>begin-track</var></code></dt>
<dt><code>--begin_track  <var>begin-track</var></code></dt>
<dd><p>Describes the track where to begin formatting.  This is useful if the
previous formatting failed halfway through.  The default is 0.
</p>
</dd>
<dt><code>-e <var>end-track</var></code></dt>
<dt><code>--end_track <var>end-track</var></code></dt>
<dd><p>Describes where to stop formatting. <var>end_track</var> is the last track to
be formatted plus one. This is mainly useful for testing purposes. By
default, this is the same as the total number of tracks.  When the
formatting stops, the final skew is displayed (to be used as absolute
skew when you&rsquo;ll continue).
</p>
</dd>
<dt><code>-S <var>sizecode</var></code></dt>
<dt><code>--sizecode <var>sizecode</var></code></dt>
<dd><p>Set the sector size to be used. The sector size is 128 * (2 ^
<var>sizecode</var>).  Sector sizes below 512 bytes are not supported, thus
sizecode must be at least 2. By default 512 is assumed, unless you ask
for more sectors than would fit with 512 bytes.
</p>
</dd>
<dt><code>--stretch <var>stretch</var></code></dt>
<dd><p>Set the stretch factor. The stretch factor describes how many physical
tracks to skip to get to the next logical track (2 ^ <var>stretch</var>).  On
double density 5 1/4 disks, the tracks are further apart from each
other.
</p>
</dd>
<dt><code>-G <var>fmt-gap</var></code></dt>
<dt><code>--format_gap <var>fmt-gap</var></code></dt>
<dd><p>Set the formatting gap. The formatting gap tells how far the sectors
are away from each other. By default, this is chosen so as to evenly
distribute the sectors along the track.
</p>
</dd>
<dt><code>-F <var>final-gap</var></code></dt>
<dt><code>--final_gap <var>final-gap</var></code></dt>
<dd><p>Set the formatting gap to be used after the last sector.
</p>
</dd>
<dt><code>-i <var>interleave</var></code></dt>
<dt><code>--interleave <var>interleave</var></code></dt>
<dd><p>Set the sector interleave factor.
</p>
</dd>
<dt><code>-c <var>chunksize</var></code></dt>
<dt><code>--chunksize <var>chunksize</var></code></dt>
<dd><p>Set the size of the chunks. The chunks are small auxiliary sectors
used during formatting. They are used to handle heterogeneous sector
sizes (i.e. not all sectors have the same size) and negative
formatting gaps.
</p>
</dd>
<dt><code>--biggest-last</code></dt>
<dd><p>For MSS formats, make sure that the biggest sector is last on the track.
This makes the format more reliable on drives which are out of spec.
</p>
</dd>
<dt><code>--zero-based</code></dt>
<dd><p>Formats the disk with sector numbers starting at 0, rather than
1. Certain CP/M boxes or Music synthesizers use this format. Those disks
can currently not be read/written to by the standard Linux read/write
API; you have to use fdrawcmd to access them.  As disk verifying is done
by this API, verifying is automatically switched off when formatting
zero-based.
</p>
</dd>
</dl>

<hr>
<a name="Sector-skewing-options"></a>
<div class="header">
<p>
Next: <a href="#Examples" accesskey="n" rel="next">Examples</a>, Previous: <a href="#Advanced-options" accesskey="p" rel="prev">Advanced options</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Sector-skewing-options-1"></a>
<h4 class="subsection">10.10.3 Sector skewing options</h4>

<p>In order to maximize the user data transfer rate, the sectors are
arranged in such a way that sector 1 of the new track/head comes under
the head at the very moment when the drive is ready to read from that
track, after having read the previous track. Thus the first sector of
the second track is not necessarily near the first sector of the first
track.  The skew value describes for each track how far sector number
1 is away from the index mark. This skew value changes for each head
and track. The amount of this change depends on how fast the disk
spins, and on how much time is needed to change the head or the track.
</p>
<dl compact="compact">
<dt><code>--absolute_skew <var>absolute-skew</var></code></dt>
<dd>
<p>Set the absolute skew. This skew value is used for the first formatted
track.  It is expressed in raw bytes.
</p>
</dd>
<dt><code>--head_skew <var>head-skew</var></code></dt>
<dd>
<p>Set the head skew. This is the skew added for passing from head 0 to
head 1.  It is expressed in raw bytes.
</p>
</dd>
<dt><code>--track_skew <var>track-skew</var></code></dt>
<dd>
<p>Set the track skew. This is the skew added for seeking to the next
track.  It is expressed in raw bytes.
</p>
</dd>
</dl>

<p>Example: (absolute skew=3, head skew=1, track skew=2)
</p>
<div class="example">
<pre class="example">track 0 head 0: 4,5,6,1,2,3	(skew=3)
track 0 head 1: 3,4,5,6,1,2	(skew=4)

track 1 head 0: 1,2,3,4,5,6	(skew=0)
track 1 head 1: 6,1,2,3,4,5	(skew=1)

track 2 head 0: 4,5,6,1,2,3	(skew=3)
track 2 head 1: 3,4,5,6,1,2	(skew=4)
</pre></div>

<p>N.B. For simplicity&rsquo;s sake, this example expresses skews in units of
sectors. In reality, superformat expects the skews to be expressed in
raw bytes.
</p>
<hr>
<a name="Examples"></a>
<div class="header">
<p>
Next: <a href="#Troubleshooting" accesskey="n" rel="next">Troubleshooting</a>, Previous: <a href="#Sector-skewing-options" accesskey="p" rel="prev">Sector skewing options</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Examples-1"></a>
<h4 class="subsection">10.10.4 Examples</h4>
<p>In all the examples of this section, we assume that drive 0 is a 3 1/2
and drive 1 a 5 1/4.
</p>

<p>The following example shows how to format a 1440K disk in drive 0:
</p><div class="example">
<pre class="example">superformat /dev/fd0 hd
</pre></div>


<p>The following example shows how to format a 1200K disk in drive 1:
</p><div class="example">
<pre class="example">superformat /dev/fd1 hd
</pre></div>


<p>The following example shows how to format a 1440K disk in drive 1:
</p><div class="example">
<pre class="example">superformat /dev/fd1 hd sect=18
</pre></div>


<p>The following example shows how to format a 720K disk in drive 0:
</p><div class="example">
<pre class="example">superformat /dev/fd0 dd
</pre></div>


<p>The following example shows how to format a 1743K disk in drive 0 (83
cylinders times 21 sectors):
</p><div class="example">
<pre class="example">superformat /dev/fd0 sect=21 cyl=83
</pre></div>


<p>The following example shows how to format a 1992K disk in drive 0 (83
cylinders times 2 heads times 12 KB per track)
</p><div class="example">
<pre class="example">superformat /dev/fd0 tracksize=12KB cyl=83 mss
</pre></div>


<p>The following example shows how to format a 1840K disk in drive 0. It
will have 5 2048-byte sectors, one 1024-byte sector, and one 512-byte
sector per track:
</p><div class="example">
<pre class="example">superformat /dev/fd0 tracksize=23b mss 2m ssize=2KB
</pre></div>


<p>All these formats can be autodetected by mtools, using the floppy
driver&rsquo;s default settings.
</p>
<hr>
<a name="Troubleshooting"></a>
<div class="header">
<p>
Next: <a href="#Superformat-bugs" accesskey="n" rel="next">Superformat bugs</a>, Previous: <a href="#Examples" accesskey="p" rel="prev">Examples</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Troubleshooting-1"></a>
<h4 class="subsection">10.10.5 Troubleshooting</h4>

<dl compact="compact">
<dt><code>FDC busy, sleeping for a second</code></dt>
<dd><p>When another program accesses a disk drive on the same controller as the
one being formatted, <code>superformat</code> has to wait until the other
access is finished.  If this happens, check whether any other program
accesses a drive (or whether a drive is mounted), kill that program (or
unmount the drive), and the format should proceed normally.
</p>
</dd>
<dt><code>I/O errors during verification</code></dt>
<dd><p>Your drive may be too far out of tolerance, and you may thus need to
supply a margin parameter.  Run <code>floppymeter</code> (see <a href="#floppymeter">floppymeter</a>)
to find out an appropriate value for this parameter, and add the
suggested <code>margin</code> parameter to the command line
</p>
</dd>
</dl>

<hr>
<a name="Superformat-bugs"></a>
<div class="header">
<p>
Previous: <a href="#Troubleshooting" accesskey="p" rel="prev">Troubleshooting</a>, Up: <a href="#superformat" accesskey="u" rel="up">superformat</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Bugs-6"></a>
<h4 class="subsection">10.10.6 Bugs</h4>
<p>Opening up new window while <code>superformat</code> is running produces
overrun errors. These errors are benign, as the failed operation is
automatically retried until it succeeds.
</p><hr>
<a name="xdfcopy"></a>
<div class="header">
<p>
Previous: <a href="#superformat" accesskey="p" rel="prev">superformat</a>, Up: <a href="#Commands" accesskey="u" rel="up">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="xdfcopy-1"></a>
<h3 class="section">10.11 xdfcopy</h3>
<a name="index-xdfcopy"></a>
<a name="index-XDF-_0028formatting-and-copying-disks_0029"></a>
<a name="index-formatting-XDF-disks"></a>

<div class="example">
<pre class="example"><code>xdfcopy</code> [<code>-</code><var>format-id</var>] [<code>-d</code>] [<code>-n</code>] [<code>-h</code> <var>head-skew</var>] [<code>-t</code> <var>cylinder-skew</var>] [<code>-T</code>
<var>end-cylinder</var>] [<var>source</var>] <var>target</var>
</pre></div>


<p><code>Xdfcopy</code> is a utility to copy and format XDF disks. XDF (eXtended
Density Format) is a format used by OS/2 which can hold 1840KB of data
(on a 3 1/2 high density disk). Its advantage over 2m formats is that it
is faster: 38KB/s. Because of this fast speed, I extended the XDF
standard to higher capacities (1992KB) with a transfer rate of 45KB/s. I
called the new formats XXDF.
</p>
<p>This program works best with kernels newer than 2.0.0.
</p>
<p>If both source and target are given, xdfcopy copies the disk image from
file to floppy disk or vice-versa. When copying to a floppy disk, the
disk is first formatted, unless the <code>-n</code> option is given.
</p>
<p>If no source is given, the target is only formatted. In this case, the
target must be a floppy drive.
</p>
<a name="Options-6"></a>
<h4 class="subsection">10.11.1 Options</h4>

<a name="Selecting-a-format"></a>
<h4 class="subsubsection">10.11.1.1 Selecting a format</h4>

<p>Formats are selected by the format_id. The following formats are understood:
</p>
<dl compact="compact">
<dt><code>0</code></dt>
<dd><p>Formats a 5 1/4 XDF disk (1520 KB, 45.6 KB/s).
</p>
</dd>
<dt><code>1</code></dt>
<dd><p>Formats a 3 1/2 high density XDF disk (1840 KB, 38.3 KB/s).
</p>
</dd>
<dt><code>2</code></dt>
<dd><p>Formats a 3 1/2 extra density XDF disk (3680 KB, 102 KB/s)
</p>
</dd>
<dt><code>3</code></dt>
<dd><p>Formats a 3 1/2 high density XXDF disk (1920 KB, 45 KB/s)
</p>
</dd>
<dt><code>4</code></dt>
<dd><p>Formats a 3 1/2 extra density XXDF disk (3840 KB, 90 KB/s) 
</p></dd>
</dl>

<a name="Misc-options-1"></a>
<h4 class="subsection">10.11.2 Misc options</h4>

<dl compact="compact">
<dt><code>-D <var>dosdrive</var></code></dt>
<dd><p>Describes the DOS drive letter for mformat. If this option is given, an
MS-DOS filesystem is automatically installed on the disk after the
low-level format is complete. In order for this to work, the drive has
to be configured to accept the 23x2x80 geometry in your /etc/mtools or
your ~/.mtoolsrc file. Moreover, this only works with a version of
mtools that is more recent than 3.0.
</p>
<p>Example of a working mtoolsrc line:
</p><div class="example">
<pre class="example">A /dev/fd0  0  0 0  0
</pre></div>

<p>Examples of a non-working mtoolsrc line:
</p><div class="example">
<pre class="example">A /dev/fd0 12 80 2 18
</pre></div>

</dd>
<dt><code>-n</code></dt>
<dd><p>Don&rsquo;t format the disk before copying the disk image to the disk.
</p>
</dd>
</dl>

<a name="Options-for-power-users"></a>
<h4 class="subsection">10.11.3 Options for power users</h4>

<dl compact="compact">
<dt><code>-t <var>cylinder skew</var></code></dt>
<dd><p>Uses a different track skew than the default (14). For more details on
skews, see <a href="#superformat">superformat</a>. In this version of xdfcopy, the <code>-t</code>
parameter is ignored.
</p>
</dd>
<dt><code>-h <var>head skew</var></code></dt>
<dd><p>Uses a different head skew than the default (0) In this version, this
parameter is ignored
</p>
</dd>
<dt><code>-d</code></dt>
<dd><p>Debugging. For each read or write operation, the time it took to
complete the operation is printed (in milliseconds). This can be used
to optimize the skews.
</p>
</dd>
<dt><code>-T <var>end-cylinders</var></code></dt>
<dd><p>Tells how many cylinders to format.  With the XXDF formats, it is
actually possible to format up to 83 cylinders, yielding a format of
up to 1992KB on a 3 1/2 high density disk.
</p>
</dd>
</dl>
<hr>
<a name="Compile_002dtime-configuration"></a>
<div class="header">
<p>
Next: <a href="#Acronyms" accesskey="n" rel="next">Acronyms</a>, Previous: <a href="#Commands" accesskey="p" rel="prev">Commands</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Compile_002dtime-configuration-via-GNU-autoconf"></a>
<h2 class="chapter">11 Compile-time configuration via GNU autoconf</h2>
<a name="index-configure-options"></a>
<a name="index-compile_002dtime-configuration"></a>

<p>Before it can be compiled, fdutils must be configured using the GNU
autoconf script <code>./configure</code>.  In most circumstances, running
<code>./configure</code> without any parameters is enough. However, you may
customize fdutils using various options to <code>./configure</code>. The
following options are supported:
</p><dl compact="compact">
<dt><code>--prefix <var>directory</var></code></dt>
<dd><p>Prefix used for any directories used by fdutils.  By default, this is
<samp>/usr/local</samp>.  Fdutils is installed in <samp>$prefix/lib</samp>, looks for
its system wide configuration file in <samp>$prefix/etc</samp>.  Man pages are
installed in <samp>$prefix/man</samp>, info pages in <samp>$prefix/info</samp> etc.
</p>
</dd>
<dt><code>--sysconfdir <var>directory</var></code></dt>
<dd><p>Directory containing the system-wide configuration files such as
<samp>mediaprm</samp> and <samp>driveprm</samp>.  By default, this is derived from
<code>prefix</code> (see above).  N.B. For backward compatibility reasons, the
old-style floppy parameter file <samp>fdprm</samp> is always in <samp>/etc</samp>,
regardless of the setting for <code>sysconfdir</code>
</p>
</dd>
<dt><code>--enable-fdmount-floppy-only</code></dt>
<dd><p>Allows usage of the <code>fdmount</code> program only to members of the group
<code>floppy</code>
</p>
</dd>
</dl>

<p>In addition to the above-listed options, the other standard GNU autoconf
options apply.  Type <code>./configure --help</code> to get a complete list of
these.
</p>
<hr>
<a name="Acronyms"></a>
<div class="header">
<p>
Next: <a href="#Interesting-formats" accesskey="n" rel="next">Interesting formats</a>, Previous: <a href="#Compile_002dtime-configuration" accesskey="p" rel="prev">Compile-time configuration</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Acronyms-1"></a>
<h2 class="appendix">Appendix A Acronyms</h2>

<dl compact="compact">
<dt><em>SD (Single density)</em></dt>
<dd><p>Single density disks use a data transfer rate of 125 kb/s and are no
longer in use today, because of their low capacity.
</p>
</dd>
<dt><em>DD (Double density)</em></dt>
<dd><p>Double density disks normally hold 360KB (5 1/4) or 720KB (3 1/2) of
data per disk.
</p>
<p>Double density disks have only a hole on one side (for write
protection).
</p>
<p>Double density uses a data transfer rate of 250 kb/s or 300 kb/s
depending on the drive type: 5 1/4 high density drives use 300 kb/s when
writing to a double density diskm 250 kb/s is used in all other
circumstances. The reason why double density disks in high density
drives need a higher data transfer rate is because these drives rotate
faster (360 rpm instead of 300 rpm).
</p>
</dd>
<dt><em>HD (High density)</em></dt>
<dd><p>High density disks normally hold 1200KB (5 1/4) or 1440KB (3 1/2) of
data per disk.  High density 3 1/2 disks are marked as such by the
presence of a second square hole, just opposed to the write protect
hole.  3 1/2 high density disks are the most commonly used type of disks
today.
</p>

</dd>
<dt><em>QD (Quad density)</em></dt>
<dd><p>Quad density is a hybrid between double and high density.  It only
exists for 5 1/4 disks, and holds 720KB of data.  It can be obtained by
formatting DD disks in a HD drive.  QD uses double density for the
density along the tracks (data transfer rate), and high density for the
density perpendicular to the tracks (spacing between tracks, and thus
number of tracks).  This came to existence because these two aspects are
limited by two different factors: the density along the track is limited
by the quality of the media, whereas the density perpendicular to the
tracks is mainly limited by the drive mechanism (this density, expressed
in bits per inch comes nowhere near the limits of the media, even with
HD).  Thus quad density is an easy way to double the capacity of an
ordinary double density disk, just by formatting it in a HD drive.
</p>
</dd>
<dt><em>ED (Extra density)</em></dt>
<dd><p>Extra density refers to a disk density that can normally hold 2880KB of
data per disk.  Extra density disks only exist as 3 1/2 disks.  ED disks
are marked with a second squared hole opposed to the square hole, which
is a little bit closer to the middle of the edge than that of HD disks.
This format never really took off, because it only was released when
storage media with a much higher capacity, such as CD-Roms, tapes and
Zip disks became popular.
</p>
<p>ED uses a data transfer rate of 250 kb/s.
</p>
</dd>
<dt><em>DS (Double sided)</em></dt>
<dd><p>Self explanatory.
</p>
</dd>
<dt><em>SS (Single sided)</em></dt>
<dd><p>Self explanatory
</p>
</dd>
<dt><em>MSS (Mixed size sectors)</em></dt>
<dd><p>Mixed sector size formats are formats which use sectors of several
different sizes on a single track. See <a href="#Mixed-size-sectors">Mixed size sectors</a>, for
details.
</p>
</dd>
<dt><em>2M (2 Megabytes)</em></dt>
<dd><p>2M is a high capacity format developed by Ciriaco de Celis.  The basic
principle is the same as MSS: mix sectors of several sizes on a same
track, in order to minimize both slack space and header overhead.  2M is
different from MSS in that it uses a normal 18 sector format on its
first track. See <a href="#g_t2M">2M</a>, for details.
</p>
</dd>
<dt><em>rpm (Rotations per minute)</em></dt>
<dd><p>All 3 1/2 drives and 5 1/4 DD drives run at 300 rotations per minute,
whereas 5 1/4 HD drives run at 360 rotations per minute.
</p>
</dd>
<dt><em>rps (Rotations per second)</em></dt>
<dd><p>See above.
</p>

</dd>
<dt><em>tpi (tracks per inch)</em></dt>
<dd><p>Expresses how close cylinders are to each other.  Usually, 5 1/4 double
density disks have 48 tpi, whereas 5 1/4 high density and quad density
disks have 96 tpi.  3 1/2 disks use 135.5 tpi.
</p>
</dd>
<dt><em>XDF (eXtended Density Format)</em></dt>
<dd><p>XDF is a disk format used for the OS/2 distribution disks.  Its
operating systems are similar to 2M and MSS disk, but it is faster due
to a more creative arrangement of sectors. See <a href="#XDF">XDF</a>, for details.
</p>
</dd>
<dt><em>XXDF (eXtended XDF)</em></dt>
<dd><p>XXDF is an Linux enhancement for XDF. It can store 1992 KB of data on an
ED disk instead of just 1840 available with the regular XDF
format. See <a href="#XXDF">XXDF</a>, for details.
</p>
</dd>
<dt><em>MFM (Multi Frequency Modulation)</em></dt>
<dd><p>MFM is a low level encoding of disk data. It is used for DD, HD and ED
disks, i.e. virtually all disks that are available today.  The PC
hardware can only read MFM and FM disks.  The doc at:
</p><div class="example">
<pre class="example">http://www.moria.de/~michael/floppy/floppy.ps
</pre></div>
<p>contains more detailed information about FM and MFM encoding.
</p>
</dd>
<dt><em>FM (Frequency modulation)</em></dt>
<dd><p>FM is a low level encoding of disk data. It was used for SD disks, and
is now considered to be obsolete.  The doc at:
</p><div class="example">
<pre class="example">http://www.moria.de/~michael/floppy/floppy.ps
</pre></div>
<p>contains more detailed information about FM and MFM encoding.
</p>
</dd>
<dt><em>kb (kilobit)</em></dt>
<dd><p>1000 bits
</p>
</dd>
<dt><em>kb/s (kilobit per second)</em></dt>
<dd><p>We express the raw data throughput to and from the disk in this unit,
which is also used in the documentation of the floppy disk controller.
</p>
</dd>
<dt><em>B</em></dt>
<dd><p>Byte. A byte is 8 bits, and is the smallest individually addressable
unit of data.
</p>
</dd>
<dt><em>KB (K-Byte)</em></dt>
<dd><p>1024 bytes. Sometimes also noted K.
</p>
</dd>
<dt><em>KB/s (K-Byte)</em></dt>
<dd><p>We express the usable data throughput to and from the disk in KB/s.
Roughly, 1 KB/s = 8 kb/s. However, the usable data throughput is always
lower than the raw throughput due to header overhead, interleaving and
seek overhead.
</p>
</dd>
<dt><em>MB (Megabyte)</em></dt>
<dd><p>Initially, 1 megabyte was 1024*1024 bytes (i.e. 1048576 bytes). However,
when talking of floppy disk capacity, we understand it as 1000KB, that
is 1000*1024 bytes, i.e. 1024000 bytes.
</p>
</dd>
<dt><em>MB/s (million bytes per second)</em></dt>
<dd><p>We express (high) raw data throughput to and from the disk in kb/s,
which is also used in the documentation of the floppy disk controller.
</p>
</dd>
</dl>
<hr>
<a name="Interesting-formats"></a>
<div class="header">
<p>
Next: <a href="#Command-Index" accesskey="n" rel="next">Command Index</a>, Previous: <a href="#Acronyms" accesskey="p" rel="prev">Acronyms</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Interesting-formats-1"></a>
<h2 class="appendix">Appendix B Interesting formats</h2>

<p>This table lists a few interesting formats.  Some of them are not
included in the table of predefined formats due to lack of space.  You
may use these by setting the geometry of the variable geometry device
using <code>setfdprm</code>.  Most of the entries in the following table do
not describe a single format, but rather a family of formats which share
a common characteristic.  For this reason, no precise parameters are
included.
</p>
<dl compact="compact">
<dt><strong>80/90/160/180 KB 5.25&quot;</strong></dt>
<dd><p>Original IBM PC, CP/M, Apple II, TRS-80, etc.  Single density, FM
(not MFM), 40-track.  Some systems also used &quot;hard&quot; sectoring, with
an index hole for each sector.  These are probably readable on
standard FDCs if anyone cares to go to the effort.  160KB/180KB
formats were double-sided.
</p>
</dd>
<dt><strong>320 KB 5.25&quot;</strong></dt>
<dd><p>CP/M, Zenith Z-100, some forms of MS-DOS.  8-sector DD 40-track.
</p>
</dd>
<dt><strong>400 KB 5.25&quot;</strong></dt>
<dd><p>AT&amp;T 7300/3B1: cpio format, 10 sectors, DS, 40 tracks.
</p>
<p>PC: MS-DOS, 10 sectors, DS, 40 tracks; formatted by various
utilities; readable by some versions of MS-DOS.
</p>
</dd>
<dt><strong>&lt;720KB 3.5&quot; formats</strong></dt>
<dd>
<ul>
<li> Some dedicated word-processing systems use lower than normal capacity
floppies (some may be 40-track either via &quot;stretching&quot; or by having odd
drives; others may be single-sided or use fewer sectors per track, or
use &quot;single density&quot; or FM).

</li><li> Atari ST 360 KB floppies: these are 9 sector 250kb/s 80-track
single-sided, using a slightly incompatible MS-DOS-like FAT.  Very
common distribution format for Atari ST software.

</li><li> Mac 400 KB: single-sided 80-tracks, Mac MFS or HFS file system, Group
Code Recording, zone bit recording, variable RPMs from 300 to 600 in 5
zones, and auto-eject mechanism.  Impossible to read on normal PC drives
without some form of hardware assistance.
</li></ul>

</dd>
<dt><strong>720 KB 3.5&quot;</strong></dt>
<dd><ul>
<li> PC: 9 sectors, DS, 80-track; very common.
</li><li> Atari ST: same as Atari ST 360 KB except double-sided.
</li></ul>

</dd>
<dt><strong>720 KB 5.25&quot;</strong></dt>
<dd><p>&quot;Quad Density&quot;: 9 sectors, DS, 80-track; name is rather misleading,
as it is double density 80 track.
</p>
</dd>
<dt><strong>800 KB</strong></dt>
<dd><ul>
<li> PC: 10 sectors, DS, 80 tracks; readable by MS-DOS; formatted by
many PC utilities; &quot;almost standard&quot;.
</li><li> Atari ST &quot;Twister&quot;: 10 sectors, DS, 80-track; slightly incompatible
MS-DOS-like FAT; sector skewing (originated by David Small).
</li><li> Mac 800 KB: same as Mac 400KB except double-sided.
</li></ul>
</dd>
<dt><strong>880 KB</strong></dt>
<dd>
<ul>
<li> PC: 11 sectors, DS, 80 tracks, interleaved(?).  Formatted by various PD
utilities such as fdformat.
</li><li> Amiga: uses &quot;single-sector&quot; tracks the size of 11 sectors; DS; 80
tracks.  Written by a custom chip rather than a standard FDC; it is very
difficult to access these using a standard FDC, though it might be
possible in theory, using some trickery.
</li></ul>

</dd>
<dt><strong>880 KB - 960 KB</strong></dt>
<dd><p>Atari ST: 11/12 sectors, DS, 80-track, interleaved(?); not very
reliable, formatted by various PD utilities.
</p>
</dd>
<dt><strong>960 KB</strong></dt>
<dd><p>2m and Linux; 6 sectors interleaved(?), DS, 250kb/s?, 80-track, 1K
sectors(?).
</p>
</dd>
<dt><strong>1001 KB</strong></dt>
<dd><p>&quot;Japanese&quot; format: 300kb/s, 77 tracks, HD drives/disks.
</p>
</dd>
<dt><strong>1040 KB</strong></dt>
<dd><p>2m and Linux only; 13 sectors, DS, 300kb/s, 80-track.
</p>
</dd>
<dt><strong>1120 KB</strong></dt>
<dd><p>2m and Linux only; 14 sectors interleaved, DS, 300kb/s, 80-track.  Can
only be formatted on Linux; even on Linux, it is difficult to format
these on an ED drive.
</p>
</dd>
<dt><strong>1200 KB 5.25&quot; HD</strong></dt>
<dd><p>&quot;AT&quot;: 360 rpm 500kb/s 80-track 15-sector MS-DOS.
</p>
</dd>
<dt><strong>1360 KB 5.25&quot; HD</strong></dt>
<dd><p>Highest &quot;fdformat&quot; noninterleaved 5.25&quot; format.  360 rpm 500kb/s
17-sector MS-DOS.
</p>
</dd>
<dt><strong>1440 KB 5.25&quot; HD</strong></dt>
<dd><p>Interleaved 18-sector 360 rpm 500kb/s; highest &quot;fdformat&quot; 5.25&quot; format.
18-sector MS-DOS.
</p>
<p>2m and Linux only: noninterleaved 1024-byte sector 18-sector-equivalent
360 rpm 500kb/s; 18-sector MS-DOS.  A good substitute for 1.44MB 3.5&quot;
floppies.
</p>
</dd>
<dt><strong>1600 KB 5.25&quot; HD</strong></dt>
<dd><p>2m and Linux only: interleaved?  500kb/s 80-track; 1 8KB sector, 1
2KB sector?
</p>
</dd>
<dt><strong>1760 KB 3.5&quot; HD</strong></dt>
<dd><p>2m and Linux only: 11 1KB sectors; 500kb/s, noninterleaved?
</p>
</dd>
<dt><strong>1840 KB 3.5&quot; HD</strong></dt>
<dd><p>2m and Linux only: 23-sector equivalent; 500kb/s, noninterleaved.
</p>
</dd>
<dt><strong>1920 KB 3.5&quot; HD</strong></dt>
<dd><p>2m and Linux only: 3 4KB sectors; 500kb/s, interleaved?
</p>
<p>2m and Linux only: 1 8KB sector, 1 4KB sector; 500kb/s, interleaved?
</p>
</dd>
<dt><strong>2880 KB 3.5&quot; ED</strong></dt>
<dd><p>&quot;Extra Density&quot; or &quot;Extra High Density&quot;.   1 Mb/s, 36-sector, DS, 80-
track.
</p>
</dd>
<dt><strong>3200 KB 3.5&quot; ED</strong></dt>
<dd><p>Non-interleaved, 80 track, 40-sector 1 Mb/s.  Highest capacity that
MS-DOS can read directly(?)
</p>
</dd>
<dt><strong>3520 KB 3.5&quot; ED</strong></dt>
<dd><p>2m and Linux only: 1 16KB sector, 1 4KB sector, 1 2KB sector?
Non-interleaved, 80 track 1 Mb/s.  Highest capacity that 2m can format.
</p>
</dd>
<dt><strong>3840 KB 3.5&quot; ED</strong></dt>
<dd><p>2m and Linux only: 1 16KB sector, 1 8KB sector (or is it 3 8KB
sectors?).  Non-interleaved, 80 track 1 Mb/s.  Formatted only by Linux,
but readable and writeable by 2m.
</p></dd>
</dl>


<p>Linux is able to read almost any MFM disk. These include many CP/M disks
and also Commodore 1581 disks. Please get Michael Haardt&rsquo;s documentation
on floppy drives for a detailed description of those formats. This can
be ftp&rsquo;ed from the following location:
</p><div class="example">
<pre class="example">http://www.moria.de/~michael/floppy/
</pre></div>

<p>Commodore 1581 disks are not yet described in this documentation.  Use
<code>setfdprm /dev/fd0 DD DS sect=10 cyl=80 swapsides</code>. If you want to
use these disks often, redefine one of the &quot;default&quot; formats to be
Commodore 1581, and then put it into the autodetection list for the
drive. The following example describes how to redefine format number 31
(minor device number 124) to be Commodore 1581:
</p><div class="example">
<pre class="example">mknod /dev/fd0cbm1581 b 2 124
setfdprm /dev/fd0cbm1581 DD DS sect=10 cyl=80 swapsides
floppycontrol --autodetect /dev/fd0 31,7,8,4,25,28,22,21
</pre></div>

<p>The two latter commands have to be issued after each reboot, so I
suggest you put them into your <samp>/etc/rc</samp> files if you use many
Commodore 1581 disks.
</p>
<hr>
<a name="Command-Index"></a>
<div class="header">
<p>
Next: <a href="#Concept-Index" accesskey="n" rel="next">Concept Index</a>, Previous: <a href="#Interesting-formats" accesskey="p" rel="prev">Interesting formats</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Command-Index-1"></a>
<h2 class="unnumbered">Command Index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Command-Index_pg_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-X"><b>X</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-pg" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-diskd"><code>diskd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#diskd">diskd</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-diskseekd"><code>diskseekd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#diskseekd">diskseekd</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fdlist"><code>fdlist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdmount">fdmount</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fdmount"><code>fdmount</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdmount">fdmount</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fdmountd"><code>fdmountd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdmount">fdmount</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fdrawcmd"><code>fdrawcmd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdrawcmd">fdrawcmd</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fdumount"><code>fdumount</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdmount">fdmount</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floppycontrol"><code>floppycontrol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#floppycontrol">floppycontrol</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floppymeter"><code>floppymeter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#floppymeter">floppymeter</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-getfdprm"><code>getfdprm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#getfdprm">getfdprm</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-MAKEFLOPPIES-_0028making-floppy-devices_0029"><code>MAKEFLOPPIES (making floppy devices)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-numbers">Device numbers</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-setfdprm"><code>setfdprm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#setfdprm">setfdprm</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setfdprm-_0028Adding-formats_0029"><code>setfdprm (Adding formats)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Adding-new-formats">Adding new formats</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-superformat"><code>superformat</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#superformat">superformat</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Command-Index_pg_letter-X">X</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-xdfcopy"><code>xdfcopy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#xdfcopy">xdfcopy</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Command-Index_pg_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Command-Index_pg_letter-X"><b>X</b></a>
 &nbsp; 
</td></tr></table>

<hr>
<a name="Concept-Index"></a>
<div class="header">
<p>
Previous: <a href="#Command-Index" accesskey="p" rel="prev">Command Index</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Concept-index"></a>
<h2 class="unnumbered">Concept index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Concept-Index_cp_symbol-1"><b>2</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_symbol-2"><b>8</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Concept-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-X"><b>X</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-cp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_symbol-1">2</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-2M">2M</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t2M">2M</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-2M-_0028mixed-sector-sizes_0029">2M (mixed sector sizes)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mixed-size-sectors">Mixed size sectors</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_symbol-2">8</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-83-cylinders">83 cylinders</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-cylinders">More cylinders</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Adding-formats">Adding formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Adding-new-formats">Adding new formats</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ALPHA-patches">ALPHA patches</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Location">Location</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-autodetection">autodetection</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Autodetection">Autodetection</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-automounting">automounting</a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdmount">fdmount</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Available-Formats">Available Formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-bugs">bugs</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Location">Location</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Builtin-Formats">Builtin Formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-CMOS-type">CMOS type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Drive-type-configuration">Drive type configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Command-list">Command list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Commands">Commands</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dtime-configuration">compile-time configuration</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Compile_002dtime-configuration">Compile-time configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-configuration-of-floppy-driver">configuration of floppy driver</a>:</td><td>&nbsp;</td><td valign="top"><a href="#floppycontrol">floppycontrol</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-configure-options">configure options</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Compile_002dtime-configuration">Compile-time configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-CPIO">CPIO</a>:</td><td>&nbsp;</td><td valign="top"><a href="#CPIO">CPIO</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cylinders">cylinders</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-cylinders">More cylinders</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Default-Formats">Default Formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-detecting-a-disk-change">detecting a disk change</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Printing-options">Printing options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-determining-drive-type">determining drive type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Printing-options">Printing options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-device-numbers">device numbers</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-numbers">Device numbers</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-diffs">diffs</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Location">Location</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-direct-interaction-with-floppy-driver">direct interaction with floppy driver</a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdrawcmd">fdrawcmd</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disk-absent-during-operation-_0028false-alert_0029">disk absent during operation (false alert)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#DCL-configuration">DCL configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disk-change-detection">disk change detection</a>:</td><td>&nbsp;</td><td valign="top"><a href="#DCL-configuration">DCL configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disk-change-line">disk change line</a>:</td><td>&nbsp;</td><td valign="top"><a href="#DCL-configuration">DCL configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-drive-type">drive type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Drive-type-configuration">Drive type configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dust-_0028shaking-it-off-from-a-drive_0029">dust (shaking it off from a drive)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#diskseekd">diskseekd</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ejecting-a-disk">ejecting a disk</a>:</td><td>&nbsp;</td><td valign="top"><a href="#One-time-actions">One time actions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Ext2">Ext2</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ext2">Ext2</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extended-formats">extended formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formats">Extended formats</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Fdutils-_0028brief-list-of-supplied-utilities_0029">Fdutils (brief list of supplied utilities)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdutils">fdutils</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file-name-of-floppy-devices">file name of floppy devices</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-names">Device names</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file-systems-supported-by-linux">file systems supported by linux</a>:</td><td>&nbsp;</td><td valign="top"><a href="#File-systems">File systems</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Fixed-format-devices">Fixed format devices</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Fixed-format-devices">Fixed format devices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floppy-device-name">floppy device name</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-names">Device names</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floppy-ioctls">floppy ioctls</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Floppy-ioctls">Floppy ioctls</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-flushing-floppy-cache">flushing floppy cache</a>:</td><td>&nbsp;</td><td valign="top"><a href="#One-time-actions">One time actions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format">format</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Autodetection">Autodetection</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format-_0028low-level-vs_002e-high-level_0029">format (low level vs. high level)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Disk-organisation">Disk organisation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Format-List">Format List</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Formats">Formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formatting-disks">formatting disks</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formats">Extended formats</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formatting-disks-_0028non-XDF_0029">formatting disks (non XDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#superformat">superformat</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formatting-XDF-disks">formatting XDF disks</a>:</td><td>&nbsp;</td><td valign="top"><a href="#xdfcopy">xdfcopy</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Geometries">Geometries</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-geometry-information-_0028reading-back_0029">geometry information (reading back)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#getfdprm">getfdprm</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-geometry-information-_0028setting_0029">geometry information (setting)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#setfdprm">setfdprm</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Geometry-List">Geometry List</a>:</td><td>&nbsp;</td><td valign="top"><a href="#geometry-list">geometry list</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-high-capacity-formats">high capacity formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formats">Extended formats</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-high-level-format">high level format</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Disk-organisation">Disk organisation</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-indentifying-unknown-disks">indentifying unknown disks</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Identifying-disks">Identifying disks</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-interleave">interleave</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Interleave">Interleave</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ioctl-list">ioctl list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Floppy-ioctls">Floppy ioctls</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Kernel-_0028new-features_0029">Kernel (new features)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#kernel">kernel</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-larger-sectors">larger sectors</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Larger-sectors">Larger sectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-List-of-available-commands">List of available commands</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Commands">Commands</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-low-level-format">low level format</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Disk-organisation">Disk organisation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-low-level-interaction-with-floppy-driver">low level interaction with floppy driver</a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdrawcmd">fdrawcmd</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-mailing-list">mailing list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Location">Location</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-making-floppy-devices">making floppy devices</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-numbers">Device numbers</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Mixed-sector-size-formats-_00282M_0029">Mixed sector size formats (2M)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t2M">2M</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Mixed-sector-size-formats-_0028XDF_0029">Mixed sector size formats (XDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XDF">XDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Mixed-sector-size-formats-_0028XXDF_0029">Mixed sector size formats (XXDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XXDF">XXDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-more-cylinder">more cylinder</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-cylinders">More cylinders</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-more-sectors-per-track">more sectors per track</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-sectors">More sectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-MSS">MSS</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mixed-size-sectors">Mixed size sectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-MSS-_00282M_0029">MSS (2M)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t2M">2M</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-MSS-_0028XDF_0029">MSS (XDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XDF">XDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-MSS-_0028XXDF_0029">MSS (XXDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XXDF">XXDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Mtools-_0028new-features_0029">Mtools (new features)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#mtools">mtools</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mtools-_0028nickel-tour_0029">mtools (nickel tour)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mtools">Mtools</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-name-of-floppy-devices">name of floppy devices</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Device-names">Device names</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-New-features">New features</a>:</td><td>&nbsp;</td><td valign="top"><a href="#New-features">New features</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nickel-tours">nickel tours</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Nickel-tours">Nickel tours</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-OS_002f2-_0028XDF_0029">OS/2 (XDF)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XDF">XDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-patches">patches</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Location">Location</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-printing-current-settings">printing current settings</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Printing-options">Printing options</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-raw-capacity">raw capacity</a>:</td><td>&nbsp;</td><td valign="top"><a href="#floppymeter">floppymeter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-raw-command">raw command</a>:</td><td>&nbsp;</td><td valign="top"><a href="#fdrawcmd">fdrawcmd</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reading-back-the-geometry-information">reading back the geometry information</a>:</td><td>&nbsp;</td><td valign="top"><a href="#getfdprm">getfdprm</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-recognize-a-disk">recognize a disk</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Autodetection">Autodetection</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Redefining-formats">Redefining formats</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Adding-new-formats">Adding new formats</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-resetting-controller">resetting controller</a>:</td><td>&nbsp;</td><td valign="top"><a href="#One-time-actions">One time actions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotation-speed">rotation speed</a>:</td><td>&nbsp;</td><td valign="top"><a href="#floppymeter">floppymeter</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-sector-skewing">sector skewing</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Sector-skewing">Sector skewing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sectors-per-track">sectors per track</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-sectors">More sectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setting-the-geometry-information">setting the geometry information</a>:</td><td>&nbsp;</td><td valign="top"><a href="#setfdprm">setfdprm</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-shaking-off-dust-from-a-drive">shaking off dust from a drive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#diskseekd">diskseekd</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-skewing">skewing</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Sector-skewing">Sector skewing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-strange-noises-during-seek">strange noises during seek</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Timing-parameters">Timing parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-supported-file-systems">supported file systems</a>:</td><td>&nbsp;</td><td valign="top"><a href="#File-systems">File systems</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-swapping-drives">swapping drives</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Drive-type-configuration">Drive type configuration</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-tar">tar</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Tar">Tar</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Thinkpad">Thinkpad</a>:</td><td>&nbsp;</td><td valign="top"><a href="#DCL-configuration">DCL configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tracks">tracks</a>:</td><td>&nbsp;</td><td valign="top"><a href="#More-cylinders">More cylinders</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Variable-format-devices">Variable format devices</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Variable-format-devices">Variable format devices</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Concept-Index_cp_letter-X">X</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-XDF">XDF</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XDF">XDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-XDF-_0028formatting-and-copying-disks_0029">XDF (formatting and copying disks)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#xdfcopy">xdfcopy</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-XDF-_0028mixed-sector-sizes_0029">XDF (mixed sector sizes)</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mixed-size-sectors">Mixed size sectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-XXDF">XXDF</a>:</td><td>&nbsp;</td><td valign="top"><a href="#XXDF">XXDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Concept-Index_cp_symbol-1"><b>2</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_symbol-2"><b>8</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Concept-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Concept-Index_cp_letter-X"><b>X</b></a>
 &nbsp; 
</td></tr></table>

<a name="SEC_Contents"></a>
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">
<ul class="no-bullet">
<li><a name="toc-General-Introduction" href="#General-Introduction">General Introduction</a></li>
<li><a name="toc-Where-to-get-fdutils-and-its-documentation" href="#Location">1 Where to get fdutils and its documentation</a></li>
<li><a name="toc-Basic-usage-1" href="#Basic-usage">2 Basic usage</a>
<ul class="no-bullet">
  <li><a name="toc-How-disks-are-organized" href="#Disk-organisation">2.1 How disks are organized</a></li>
  <li><a name="toc-File-systems-supported-by-Linux" href="#File-systems">2.2 File systems supported by Linux</a></li>
  <li><a name="toc-What_0027s-in-a-name" href="#Device-names">2.3 What&rsquo;s in a name</a></li>
  <li><a name="toc-What-to-do-if-you-get-an-unidentified-floppy-disk" href="#Identifying-disks">2.4 What to do if you get an unidentified floppy disk</a></li>
  <li><a name="toc-Nickel-tours-1" href="#Nickel-tours">2.5 Nickel tours</a>
  <ul class="no-bullet">
    <li><a name="toc-mtools-1" href="#Mtools">2.5.1 mtools</a></li>
    <li><a name="toc-Tar-_0028Tape-ARchive_0029" href="#Tar">2.5.2 Tar (Tape ARchive)</a></li>
    <li><a name="toc-CPIO-_0028CoPy-In_002fOut_0029" href="#CPIO">2.5.3 CPIO (CoPy In/Out)</a></li>
  </ul></li>
  <li><a name="toc-Ext2-_0028Second-Extended-File-System_0029" href="#Ext2">2.6 Ext2 (Second Extended File System)</a></li>
  <li><a name="toc-New-Features-of-1_002e2_002b-kernels" href="#New-features">2.7 New Features of 1.2+ kernels</a>
  <ul class="no-bullet">
    <li><a name="toc-New-features-of-1_002e2_002b-kernels" href="#kernel">2.7.1 New features of 1.2+ kernels</a></li>
    <li><a name="toc-New-features-of-mtools_002d3_002e0" href="#mtools">2.7.2 New features of mtools-3.0</a></li>
    <li><a name="toc-New-Utilities" href="#fdutils">2.7.3 New Utilities</a></li>
  </ul></li>
</ul></li>
<li><a name="toc-Device-numbers-1" href="#Device-numbers">3 Device numbers</a>
<ul class="no-bullet">
  <li><a name="toc-Variable-format-devices-1" href="#Variable-format-devices">3.1 Variable format devices</a></li>
  <li><a name="toc-Fixed-format-devices-1" href="#Fixed-format-devices">3.2 Fixed format devices</a></li>
  <li><a name="toc-The-geometry-list" href="#geometry-list">3.3 The geometry list</a></li>
  <li><a name="toc-Adding-new-formats-1" href="#Adding-new-formats">3.4 Adding new formats</a></li>
</ul></li>
<li><a name="toc-Media-description-1" href="#Media-description">4 Media description</a>
<ul class="no-bullet">
  <li><a name="toc-Introduction" href="#Introduction-_0028Mediaprm_0029">4.1 Introduction</a></li>
  <li><a name="toc-Syntax-1" href="#Syntax">4.2 Syntax</a>
  <ul class="no-bullet">
    <li><a name="toc-Selecting-the-density-1" href="#Selecting-the-density">4.2.1 Selecting the density</a></li>
    <li><a name="toc-Selecting-the-number-of-cylinders_002c-heads-and-sectors" href="#Selecting-the-number-of-cylinders-heads-and-sectors">4.2.2 Selecting the number of cylinders, heads and sectors</a></li>
    <li><a name="toc-Selecting-non_002dstandard-sector-sizes-1" href="#Selecting-non_002dstandard-sector-sizes">4.2.3 Selecting non-standard sector sizes</a></li>
    <li><a name="toc-Legacy-formats-1" href="#Legacy-formats">4.2.4 Legacy formats</a></li>
    <li><a name="toc-Expert-options-1" href="#Expert-options">4.2.5 Expert options</a></li>
  </ul></li>
  <li><a name="toc-The-media-description-dictionary-in-_002fetc_002ffdmediaprm" href="#Media-definition-file">4.3 The media description dictionary in /etc/fdmediaprm</a></li>
</ul></li>
<li><a name="toc-Drive-descriptions-1" href="#Drive-descriptions">5 Drive descriptions</a>
<ul class="no-bullet">
  <li><a name="toc-Syntax-2" href="#Syntax-of-a-drive-description">5.1 Syntax</a>
  <ul class="no-bullet">
    <li><a name="toc-Density-1" href="#Density">5.1.1 Density</a></li>
    <li><a name="toc-Form-factor-1" href="#Form-factor">5.1.2 Form factor</a></li>
    <li><a name="toc-Cmos-code-1" href="#Cmos-code">5.1.3 Cmos code</a></li>
    <li><a name="toc-Other-parameters-1" href="#Other-parameters">5.1.4 Other parameters</a></li>
  </ul></li>
  <li><a name="toc-The-drive-definition-file-in-_002fusr_002flocal_002fetc_002ffddriveprm" href="#Drive-definition-file">5.2 The drive definition file in <samp>/usr/local/etc/fddriveprm</samp></a></li>
</ul></li>
<li><a name="toc-Storing-more-data-on-a-floppy-disk" href="#Extended-formats">6 Storing more data on a floppy disk</a>
<ul class="no-bullet">
  <li><a name="toc-More-sectors-per-cylinder" href="#More-sectors">6.1 More sectors per cylinder</a></li>
  <li><a name="toc-Using-interleave" href="#Interleave">6.2 Using interleave</a></li>
  <li><a name="toc-Sector-skewing-1" href="#Sector-skewing">6.3 Sector skewing</a></li>
  <li><a name="toc-More-Cylinders" href="#More-cylinders">6.4 More Cylinders</a></li>
  <li><a name="toc-Larger-sectors-1" href="#Larger-sectors">6.5 Larger sectors</a></li>
  <li><a name="toc-Mixed-sector-size-_0028MSS_0029-formats" href="#Mixed-size-sectors">6.6 Mixed sector size (MSS) formats</a></li>
  <li><a name="toc-Smart-use-of-the-data-transfer-rate" href="#Smart-use-of-the-dtr">6.7 Smart use of the data transfer rate</a></li>
  <li><a name="toc-2M-formats" href="#g_t2M">6.8 2M formats</a></li>
  <li><a name="toc-XDF-formats" href="#XDF">6.9 XDF formats</a></li>
  <li><a name="toc-XXDF-formats" href="#XXDF">6.10 XXDF formats</a></li>
</ul></li>
<li><a name="toc-How-autodetection-works" href="#Autodetection">7 How autodetection works</a>
<ul class="no-bullet">
  <li><a name="toc-Example" href="#Example">7.1 Example</a></li>
</ul></li>
<li><a name="toc-Configuring-the-floppy-driver-via-LILO-or-insmod" href="#Boottime-configuration">8 Configuring the floppy driver via LILO or insmod</a></li>
<li><a name="toc-Floppy-ioctls-1" href="#Floppy-ioctls">9 Floppy ioctls</a></li>
<li><a name="toc-Command-list" href="#Commands">10 Command list</a>
<ul class="no-bullet">
  <li><a name="toc-diskd-1" href="#diskd">10.1 diskd</a>
  <ul class="no-bullet">
    <li><a name="toc-Warning" href="#Warning">10.1.1 Warning</a></li>
    <li><a name="toc-Options" href="#Options">10.1.2 Options</a></li>
    <li><a name="toc-Bugs" href="#Bugs">10.1.3 Bugs</a></li>
  </ul></li>
  <li><a name="toc-diskseekd-1" href="#diskseekd">10.2 diskseekd</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-1" href="#Options-1">10.2.1 Options</a></li>
    <li><a name="toc-Bugs-1" href="#Bugs-1">10.2.2 Bugs</a></li>
  </ul></li>
  <li><a name="toc-fdmount-1" href="#fdmount">10.3 fdmount</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-2" href="#Options-2">10.3.1 Options</a></li>
    <li><a name="toc-Security" href="#Security">10.3.2 Security</a></li>
    <li><a name="toc-Daemon-mode" href="#Daemon-mode">10.3.3 Daemon mode</a></li>
    <li><a name="toc-Diagnostics" href="#Diagnostics">10.3.4 Diagnostics</a></li>
    <li><a name="toc-Bugs-2" href="#Bugs-2">10.3.5 Bugs</a></li>
  </ul></li>
  <li><a name="toc-fdrawcmd-1" href="#fdrawcmd">10.4 fdrawcmd</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-3" href="#Options-3">10.4.1 Options</a></li>
    <li><a name="toc-Commands-1" href="#Commands-1">10.4.2 Commands</a>
    <ul class="no-bullet">
      <li><a name="toc-Commands-available-on-all-FDCs" href="#Commands-available-on-all-FDCs">10.4.2.1 Commands available on all FDCs</a></li>
      <li><a name="toc-Commands-available-on-82072-and-later" href="#Commands-available-on-82072-and-later">10.4.2.2 Commands available on 82072 and later</a></li>
      <li><a name="toc-Commands-available-on-82072A-and-later" href="#Commands-available-on-82072A-and-later">10.4.2.3 Commands available on 82072A and later</a></li>
      <li><a name="toc-Commands-available-on-82077-and-later" href="#Commands-available-on-82077-and-later">10.4.2.4 Commands available on 82077 and later</a></li>
      <li><a name="toc-Commands-available-on-82077AA-and-later" href="#Commands-available-on-82077AA-and-later">10.4.2.5 Commands available on 82077AA and later</a></li>
      <li><a name="toc-Commands-available-on-82078" href="#Commands-available-on-82078">10.4.2.6 Commands available on 82078</a></li>
    </ul></li>
    <li><a name="toc-Modes" href="#Modes">10.4.3 Modes</a></li>
  </ul></li>
  <li><a name="toc-floppycontrol-1" href="#floppycontrol">10.5 floppycontrol</a>
  <ul class="no-bullet">
    <li><a name="toc-General-Options" href="#General-options">10.5.1 General Options</a></li>
    <li><a name="toc-One-time-actions-1" href="#One-time-actions">10.5.2 One time actions</a></li>
    <li><a name="toc-Printing-current-settings" href="#Printing-options">10.5.3 Printing current settings</a></li>
    <li><a name="toc-Drive-type-configuration-and-autodetection" href="#Drive-type-configuration">10.5.4 Drive type configuration and autodetection</a></li>
    <li><a name="toc-Configuration-of-the-disk-change-line" href="#DCL-configuration">10.5.5 Configuration of the disk change line</a></li>
    <li><a name="toc-Timing-Parameters" href="#Timing-parameters">10.5.6 Timing Parameters</a></li>
    <li><a name="toc-Debugging-messages" href="#Debugging">10.5.7 Debugging messages</a></li>
    <li><a name="toc-Error-Handling-Options" href="#Error-handling-options">10.5.8 Error Handling Options</a></li>
    <li><a name="toc-Write-error-reporting-1" href="#Write-error-reporting">10.5.9 Write error reporting</a></li>
    <li><a name="toc-Other-drive-configuration-options" href="#Misc-options">10.5.10 Other drive configuration options</a></li>
  </ul></li>
  <li><a name="toc-floppymeter-1" href="#floppymeter">10.6 floppymeter</a>
  <ul class="no-bullet">
    <li><a name="toc-Bugs-3" href="#Bugs-3">10.6.1 Bugs</a></li>
  </ul></li>
  <li><a name="toc-getfdprm-1" href="#getfdprm">10.7 getfdprm</a></li>
  <li><a name="toc-makefloppies-1" href="#makefloppies">10.8 makefloppies</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-4" href="#Options-4">10.8.1 Options</a></li>
    <li><a name="toc-Bugs-4" href="#Bugs-4">10.8.2 Bugs</a></li>
  </ul></li>
  <li><a name="toc-setfdprm-1" href="#setfdprm">10.9 setfdprm</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-5" href="#Options-5">10.9.1 Options</a></li>
    <li><a name="toc-Bugs-5" href="#Bugs-5">10.9.2 Bugs</a></li>
  </ul></li>
  <li><a name="toc-superformat-1" href="#superformat">10.10 superformat</a>
  <ul class="no-bullet">
    <li><a name="toc-Common-Options" href="#Common-options">10.10.1 Common Options</a></li>
    <li><a name="toc-Advanced-Options" href="#Advanced-options">10.10.2 Advanced Options</a></li>
    <li><a name="toc-Sector-skewing-options-1" href="#Sector-skewing-options">10.10.3 Sector skewing options</a></li>
    <li><a name="toc-Examples-1" href="#Examples">10.10.4 Examples</a></li>
    <li><a name="toc-Troubleshooting-1" href="#Troubleshooting">10.10.5 Troubleshooting</a></li>
    <li><a name="toc-Bugs-6" href="#Superformat-bugs">10.10.6 Bugs</a></li>
  </ul></li>
  <li><a name="toc-xdfcopy-1" href="#xdfcopy">10.11 xdfcopy</a>
  <ul class="no-bullet">
    <li><a name="toc-Options-6" href="#Options-6">10.11.1 Options</a>
    <ul class="no-bullet">
      <li><a name="toc-Selecting-a-format" href="#Selecting-a-format">10.11.1.1 Selecting a format</a></li>
    </ul></li>
    <li><a name="toc-Misc-options-1" href="#Misc-options-1">10.11.2 Misc options</a></li>
    <li><a name="toc-Options-for-power-users" href="#Options-for-power-users">10.11.3 Options for power users</a></li>
  </ul></li>
</ul></li>
<li><a name="toc-Compile_002dtime-configuration-via-GNU-autoconf" href="#Compile_002dtime-configuration">11 Compile-time configuration via GNU autoconf</a></li>
<li><a name="toc-Acronyms-1" href="#Acronyms">Appendix A Acronyms</a></li>
<li><a name="toc-Interesting-formats-1" href="#Interesting-formats">Appendix B Interesting formats</a></li>
<li><a name="toc-Command-Index-1" href="#Command-Index">Command Index</a></li>
<li><a name="toc-Concept-index" href="#Concept-Index">Concept index</a></li>

</ul>
</div>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h3><a name="FOOT1" href="#DOCF1">(1)</a></h3>
<p>In that case, the <code>MAKEFLOPPIES</code> program
(<a href="#makefloppies">makefloppies</a>) no longer works to generate a correct name for
these formats, and you have to make them manually.</p>
<h3><a name="FOOT2" href="#DOCF2">(2)</a></h3>
<p>The actual location of this
file depends on the value of the <code>sysconfdir</code> compile time
configuration variable (see <a href="#Compile_002dtime-configuration">Compile-time configuration</a> for details)</p>
<h3><a name="FOOT3" href="#DOCF3">(3)</a></h3>
<p>drives do not always
rotate at exactly 5 or 6 rotations per second, but some may be slightly
faster or slightly slower than spec</p>
<h3><a name="FOOT4" href="#DOCF4">(4)</a></h3>
<p>The actual location of this
file depends on the value of the <code>sysconfdir</code> compile time
configuration variable (see <a href="#Compile_002dtime-configuration">Compile-time configuration</a> for details)</p>
<h3><a name="FOOT5" href="#DOCF5">(5)</a></h3>
<p>except of course if
several formats only differ in the number of sectors per track, in which
case the formats with the most sectors should come first</p>
<h3><a name="FOOT6" href="#DOCF6">(6)</a></h3>
<p>Version
3.0 or higher</p>
</div>
<hr>



</body>
</html>
