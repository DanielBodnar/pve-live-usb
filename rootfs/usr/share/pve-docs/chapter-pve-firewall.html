<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>Proxmox VE Firewall</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:55em">
<div id="header">
<h1>Proxmox VE Firewall</h1>
<span id="author">Proxmox Server Solutions Gmbh</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:support@proxmox.com">support@proxmox.com</a>&gt;</span><br>
<span id="revnumber">version 5.2,</span>
<span id="revdate">Mon May 14 12:47:00 UTC 2018</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph" id="chapter_pve_firewall">
<p>Proxmox VE Firewall provides an easy way to protect your IT
infrastructure. You can setup firewall rules for all hosts
inside a cluster, or define rules for virtual machines and
containers. Features like firewall macros, security groups, IP sets
and aliases help to make that task easier.</p></div>
<div class="paragraph">
<p>While all configuration is stored on the cluster file system, the
<span class="monospaced">iptables</span>-based firewall runs on each cluster node, and thus provides
full isolation between virtual machines. The distributed nature of
this system also provides much higher bandwidth than a central
firewall solution.</p></div>
<div class="paragraph">
<p>The firewall has full support for IPv4 and IPv6. IPv6 support is fully
transparent, and we filter traffic for both protocols by default. So
there is no need to maintain a different set of rules for IPv6.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_zones">Zones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Proxmox VE firewall groups the network into the following logical zones:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Host
</dt>
<dd>
<p>
Traffic from/to a cluster node
</p>
</dd>
<dt class="hdlist1">
VM
</dt>
<dd>
<p>
Traffic from/to a specific VM
</p>
</dd>
</dl></div>
<div class="paragraph">
<p>For each zone, you can define firewall rules for incoming and/or
outgoing traffic.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_files">Configuration Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All firewall related configuration is stored on the proxmox cluster
file system. So those files are automatically distributed to all
cluster nodes, and the <span class="monospaced">pve-firewall</span> service updates the underlying
<span class="monospaced">iptables</span> rules automatically on changes.</p></div>
<div class="paragraph">
<p>You can configure anything using the GUI (i.e. <strong>Datacenter</strong> &#8594; <strong>Firewall</strong>,
or on a <strong>Node</strong> &#8594; <strong>Firewall</strong>), or you can edit the configuration files
directly using your preferred editor.</p></div>
<div class="paragraph">
<p>Firewall configuration files contains sections of key-value
pairs. Lines beginning with a <span class="monospaced">#</span> and blank lines are considered
comments. Sections starts with a header line containing the section
name enclosed in <span class="monospaced">[</span> and <span class="monospaced">]</span>.</p></div>
<div class="sect2">
<h3 id="pve_firewall_cluster_wide_setup">Cluster Wide Setup</h3>
<div class="paragraph">
<p>The cluster wide firewall configuration is stored at:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>/etc/pve/firewall/cluster.fw</pre>
</div></div>
<div class="paragraph">
<p>The configuration can contain the following sections:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">[OPTIONS]</span>
</dt>
<dd>
<p>
This is used to set cluster wide firewall options.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">enable</span>: <span class="monospaced">&lt;integer&gt; (0 - N)</span> 
</dt>
<dd>
<p>
Enable or disable the firewall cluster wide.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">policy_in</span>: <span class="monospaced">&lt;ACCEPT | DROP | REJECT&gt;</span> 
</dt>
<dd>
<p>
Input policy.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">policy_out</span>: <span class="monospaced">&lt;ACCEPT | DROP | REJECT&gt;</span> 
</dt>
<dd>
<p>
Output policy.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[RULES]</span>
</dt>
<dd>
<p>
This sections contains cluster wide firewall rules for all nodes.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[IPSET &lt;name&gt;]</span>
</dt>
<dd>
<p>
Cluster wide IP set definitions.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[GROUP &lt;name&gt;]</span>
</dt>
<dd>
<p>
Cluster wide security group definitions.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[ALIASES]</span>
</dt>
<dd>
<p>
Cluster wide Alias definitions.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="_enabling_the_firewall">Enabling the Firewall</h4>
<div class="paragraph">
<p>The firewall is completely disabled by default, so you need to
set the enable option here:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>[OPTIONS]
# enable firewall (cluster wide setting, default is disabled)
enable: 1</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Important" src="data:image/png;base64,
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
EQn3XQAAAABJRU5ErkJggg==">
</td>
<td class="content">If you enable the firewall, traffic to all hosts is blocked by
default. Only exceptions is WebGUI(8006) and ssh(22) from your local
network.</td>
</tr></table>
</div>
<div class="paragraph">
<p>If you want to administrate your Proxmox VE hosts from remote, you
need to create rules to allow traffic from those remote IPs to the web
GUI (port 8006). You may also want to allow ssh (port 22), and maybe
SPICE (port 3128).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Tip" src="data:image/png;base64,
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">
</td>
<td class="content">Please open a SSH connection to one of your Proxmox VE hosts before
enabling the firewall. That way you still have access to the host if
something goes wrong .</td>
</tr></table>
</div>
<div class="paragraph">
<p>To simplify that task, you can instead create an IPSet called
&#8220;management&#8221;, and add all remote IPs there. This creates all required
firewall rules to access the GUI from remote.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="pve_firewall_host_specific_configuration">Host Specific Configuration</h3>
<div class="paragraph">
<p>Host related configuration is read from:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>/etc/pve/nodes/&lt;nodename&gt;/host.fw</pre>
</div></div>
<div class="paragraph">
<p>This is useful if you want to overwrite rules from <span class="monospaced">cluster.fw</span>
config. You can also increase log verbosity, and set netfilter related
options. The configuration can contain the following sections:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">[OPTIONS]</span>
</dt>
<dd>
<p>
This is used to set host related firewall options.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">enable</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable host firewall rules.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">log_level_in</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for incoming traffic.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">log_level_out</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for outgoing traffic.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">ndp</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable NDP.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">nf_conntrack_max</span>: <span class="monospaced">&lt;integer&gt; (32768 - N)</span> 
</dt>
<dd>
<p>
Maximum number of tracked connections.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">nf_conntrack_tcp_timeout_established</span>: <span class="monospaced">&lt;integer&gt; (7875 - N)</span> 
</dt>
<dd>
<p>
Conntrack established timeout.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">nosmurfs</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable SMURFS filter.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">smurf_log_level</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for SMURFS filter.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">tcp_flags_log_level</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for illegal tcp flags filter.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">tcpflags</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Filter illegal combinations of TCP flags.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[RULES]</span>
</dt>
<dd>
<p>
This sections contains host specific firewall rules.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="pve_firewall_vm_container_configuration">VM/Container Configuration</h3>
<div class="paragraph">
<p>VM firewall configuration is read from:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>/etc/pve/firewall/&lt;VMID&gt;.fw</pre>
</div></div>
<div class="paragraph">
<p>and contains the following data:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">[OPTIONS]</span>
</dt>
<dd>
<p>
This is used to set VM/Container related firewall options.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">dhcp</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable DHCP.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">enable</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable/disable firewall rules.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">ipfilter</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable default IP filters. This is equivalent to adding an empty ipfilter-net&lt;id&gt; ipset for every interface. Such ipsets implicitly contain sane default restrictions such as restricting IPv6 link local addresses to the one derived from the interface&#8217;s MAC address. For containers the configured IP addresses will be implicitly added.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">log_level_in</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for incoming traffic.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">log_level_out</span>: <span class="monospaced">&lt;alert | crit | debug | emerg | err | info | nolog | notice | warning&gt;</span> 
</dt>
<dd>
<p>
Log level for outgoing traffic.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">macfilter</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable/disable MAC address filter.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">ndp</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Enable NDP.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">policy_in</span>: <span class="monospaced">&lt;ACCEPT | DROP | REJECT&gt;</span> 
</dt>
<dd>
<p>
Input policy.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">policy_out</span>: <span class="monospaced">&lt;ACCEPT | DROP | REJECT&gt;</span> 
</dt>
<dd>
<p>
Output policy.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">radv</span>: <span class="monospaced">&lt;boolean&gt;</span> 
</dt>
<dd>
<p>
Allow sending Router Advertisement.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[RULES]</span>
</dt>
<dd>
<p>
This sections contains VM/Container firewall rules.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[IPSET &lt;name&gt;]</span>
</dt>
<dd>
<p>
IP set definitions.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">[ALIASES]</span>
</dt>
<dd>
<p>
IP Alias definitions.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="_enabling_the_firewall_for_vms_and_containers">Enabling the Firewall for VMs and Containers</h4>
<div class="paragraph">
<p>Each virtual network device has its own firewall enable flag. So you
can selectively enable the firewall for each interface. This is
required in addition to the general firewall <span class="monospaced">enable</span> option.</p></div>
<div class="paragraph">
<p>The firewall requires a special network device setup, so you need to
restart the VM/container after enabling the firewall on a network
interface.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firewall_rules">Firewall Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Firewall rules consists of a direction (<span class="monospaced">IN</span> or <span class="monospaced">OUT</span>) and an
action (<span class="monospaced">ACCEPT</span>, <span class="monospaced">DENY</span>, <span class="monospaced">REJECT</span>). You can also specify a macro
name. Macros contain predefined sets of rules and options. Rules can be
disabled by prefixing them with <span class="monospaced">|</span>.</p></div>
<div class="listingblock">
<div class="title">Firewall rules syntax</div>
<div class="content monospaced">
<pre>[RULES]

DIRECTION ACTION [OPTIONS]
|DIRECTION ACTION [OPTIONS] # disabled rule

DIRECTION MACRO(ACTION) [OPTIONS] # use predefined macro</pre>
</div></div>
<div class="paragraph">
<p>The following options can be used to refine rule matches.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">--dest</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
Restrict packet destination address. This can refer to a single IP address, an IP set (<em>+ipsetname</em>) or an IP alias definition. You can also specify an address range like <em>20.34.101.207-201.3.9.99</em>, or a list of IP addresses and networks (entries are separated by comma). Please do not mix IPv4 and IPv6 addresses inside such lists.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">--dport</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
Restrict TCP/UDP destination port. You can use service names or simple numbers (0-65535), as defined in <em>/etc/services</em>. Port ranges can be specified with <em>\d+:\d+</em>, for example <em>80:85</em>, and you can use comma separated list to match several ports or ranges.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">--iface</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
Network interface name. You have to use network configuration key names for VMs and containers (<em>net\d+</em>). Host related rules can use arbitrary strings.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">--proto</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
IP protocol. You can use protocol names (<em>tcp</em>/<em>udp</em>) or simple numbers, as defined in <em>/etc/protocols</em>.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">--source</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
Restrict packet source address. This can refer to a single IP address, an IP set (<em>+ipsetname</em>) or an IP alias definition. You can also specify an address range like <em>20.34.101.207-201.3.9.99</em>, or a list of IP addresses and networks (entries are separated by comma). Please do not mix IPv4 and IPv6 addresses inside such lists.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">--sport</span> <span class="monospaced">&lt;string&gt;</span> 
</dt>
<dd>
<p>
Restrict TCP/UDP source port. You can use service names or simple numbers (0-65535), as defined in <em>/etc/services</em>. Port ranges can be specified with <em>\d+:\d+</em>, for example <em>80:85</em>, and you can use comma separated list to match several ports or ranges.
</p>
</dd>
</dl></div>
<div class="paragraph">
<p>Here are some examples:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>[RULES]
IN SSH(ACCEPT) -i net0
IN SSH(ACCEPT) -i net0 # a comment
IN SSH(ACCEPT) -i net0 -source 192.168.2.192 # only allow SSH from 192.168.2.192
IN SSH(ACCEPT) -i net0 -source 10.0.0.1-10.0.0.10 # accept SSH for ip range
IN SSH(ACCEPT) -i net0 -source 10.0.0.1,10.0.0.2,10.0.0.3 #accept ssh for ip list
IN SSH(ACCEPT) -i net0 -source +mynetgroup # accept ssh for ipset mynetgroup
IN SSH(ACCEPT) -i net0 -source myserveralias #accept ssh for alias myserveralias

|IN SSH(ACCEPT) -i net0 # disabled rule

IN  DROP # drop all incoming packages
OUT ACCEPT # accept all outgoing packages</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="pve_firewall_security_groups">Security Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A security group is a collection of rules, defined at cluster level, which
can be used in all VMs' rules. For example you can define a group named
&#8220;webserver&#8221; with rules to open the <em>http</em> and <em>https</em> ports.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/pve/firewall/cluster.fw

[group webserver]
IN  ACCEPT -p tcp -dport 80
IN  ACCEPT -p tcp -dport 443</pre>
</div></div>
<div class="paragraph">
<p>Then, you can add this group to a VM&#8217;s firewall</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/pve/firewall/&lt;VMID&gt;.fw

[RULES]
GROUP webserver</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="pve_firewall_ip_aliases">IP Aliases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IP Aliases allow you to associate IP addresses of networks with a
name. You can then refer to those names:</p></div>
<div class="ulist"><ul>
<li>
<p>
inside IP set definitions
</p>
</li>
<li>
<p>
in <span class="monospaced">source</span> and <span class="monospaced">dest</span> properties of firewall rules
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_standard_ip_alias_span_class_monospaced_local_network_span">Standard IP Alias <span class="monospaced">local_network</span></h3>
<div class="paragraph">
<p>This alias is automatically defined. Please use the following command
to see assigned values:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># pve-firewall localnet
local hostname: example
local IP address: 192.168.2.100
network auto detect: 192.168.0.0/20
using detected local_network: 192.168.0.0/20</pre>
</div></div>
<div class="paragraph">
<p>The firewall automatically sets up rules to allow everything needed
for cluster communication (corosync, API, SSH) using this alias.</p></div>
<div class="paragraph">
<p>The user can overwrite these values in the <span class="monospaced">cluster.fw</span> alias
section. If you use a single host on a public network, it is better to
explicitly assign the local IP address</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>#  /etc/pve/firewall/cluster.fw
[ALIASES]
local_network 1.2.3.4 # use the single ip address</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pve_firewall_ip_sets">IP Sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IP sets can be used to define groups of networks and hosts. You can
refer to them with &#8216;+name` in the firewall rules&#8217; <span class="monospaced">source</span> and <span class="monospaced">dest</span>
properties.</p></div>
<div class="paragraph">
<p>The following example allows HTTP traffic from the <span class="monospaced">management</span> IP
set.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>IN HTTP(ACCEPT) -source +management</pre>
</div></div>
<div class="sect2">
<h3 id="_standard_ip_set_span_class_monospaced_management_span">Standard IP set <span class="monospaced">management</span></h3>
<div class="paragraph">
<p>This IP set applies only to host firewalls (not VM firewalls).  Those
IPs are allowed to do normal management tasks (PVE GUI, VNC, SPICE,
SSH).</p></div>
<div class="paragraph">
<p>The local cluster network is automatically added to this IP set (alias
<span class="monospaced">cluster_network</span>), to enable inter-host cluster
communication. (multicast,ssh,&#8230;)</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/pve/firewall/cluster.fw

[IPSET management]
192.168.2.10
192.168.2.10/24</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_standard_ip_set_span_class_monospaced_blacklist_span">Standard IP set <span class="monospaced">blacklist</span></h3>
<div class="paragraph">
<p>Traffic from these IPs is dropped by every host&#8217;s and VM&#8217;s firewall.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/pve/firewall/cluster.fw

[IPSET blacklist]
77.240.159.182
213.87.123.0/24</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="pve_firewall_ipfilter_section">Standard IP set <span class="monospaced">ipfilter-net*</span></h3>
<div class="paragraph">
<p>These filters belong to a VM&#8217;s network interface and are mainly used to prevent
IP spoofing. If such a set exists for an interface then any outgoing traffic
with a source IP not matching its interface&#8217;s corresponding ipfilter set will
be dropped.</p></div>
<div class="paragraph">
<p>For containers with configured IP addresses these sets, if they exist (or are
activated via the general <span class="monospaced">IP Filter</span> option in the VM&#8217;s firewall&#8217;s <strong>options</strong>
tab), implicitly contain the associated IP addresses.</p></div>
<div class="paragraph">
<p>For both virtual machines and containers they also implicitly contain the
standard MAC-derived IPv6 link-local address in order to allow the neighbor
discovery protocol to work.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>/etc/pve/firewall/&lt;VMID&gt;.fw

[IPSET ipfilter-net0] # only allow specified IPs on net0
192.168.2.10</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_services_and_commands">Services and Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The firewall runs two service daemons on each node:</p></div>
<div class="ulist"><ul>
<li>
<p>
pvefw-logger: NFLOG daemon (ulogd replacement).
</p>
</li>
<li>
<p>
pve-firewall: updates iptables rules
</p>
</li>
</ul></div>
<div class="paragraph">
<p>There is also a CLI command named <span class="monospaced">pve-firewall</span>, which can be used to
start and stop the firewall service:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># pve-firewall start
# pve-firewall stop</pre>
</div></div>
<div class="paragraph">
<p>To get the status use:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># pve-firewall status</pre>
</div></div>
<div class="paragraph">
<p>The above command reads and compiles all firewall rules, so you will
see warnings if your firewall configuration contains any errors.</p></div>
<div class="paragraph">
<p>If you want to see the generated iptables rules you can use:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># iptables-save</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_tips_and_tricks">Tips and Tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_to_allow_ftp">How to allow FTP</h3>
<div class="paragraph">
<p>FTP is an old style protocol which uses port 21 and several other dynamic ports. So you
need a rule to accept port 21. In addition, you need to load the <span class="monospaced">ip_conntrack_ftp</span> module.
So please run:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>modprobe ip_conntrack_ftp</pre>
</div></div>
<div class="paragraph">
<p>and add <span class="monospaced">ip_conntrack_ftp</span> to <span class="monospaced">/etc/modules</span> (so that it works after a reboot).</p></div>
</div>
<div class="sect2">
<h3 id="_suricata_ips_integration">Suricata IPS integration</h3>
<div class="paragraph">
<p>If you want to use the <a href="http://suricata-ids.org/">Suricata IPS</a>
(Intrusion Prevention System), it&#8217;s possible.</p></div>
<div class="paragraph">
<p>Packets will be forwarded to the IPS only after the firewall ACCEPTed
them.</p></div>
<div class="paragraph">
<p>Rejected/Dropped firewall packets don&#8217;t go to the IPS.</p></div>
<div class="paragraph">
<p>Install suricata on proxmox host:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># apt-get install suricata
# modprobe nfnetlink_queue</pre>
</div></div>
<div class="paragraph">
<p>Don&#8217;t forget to add <span class="monospaced">nfnetlink_queue</span> to <span class="monospaced">/etc/modules</span> for next reboot.</p></div>
<div class="paragraph">
<p>Then, enable IPS for a specific VM with:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/pve/firewall/&lt;VMID&gt;.fw

[OPTIONS]
ips: 1
ips_queues: 0</pre>
</div></div>
<div class="paragraph">
<p><span class="monospaced">ips_queues</span> will bind a specific cpu queue for this VM.</p></div>
<div class="paragraph">
<p>Available queues are defined in</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre># /etc/default/suricata
NFQUEUE=0</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notes_on_ipv6">Notes on IPv6</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The firewall contains a few IPv6 specific options. One thing to note is that
IPv6 does not use the ARP protocol anymore, and instead uses NDP (Neighbor
Discovery Protocol) which works on IP level and thus needs IP addresses to
succeed. For this purpose link-local addresses derived from the interface&#8217;s MAC
address are used. By default the <span class="monospaced">NDP</span> option is enabled on both host and VM
level to allow neighbor discovery (NDP) packets to be sent and received.</p></div>
<div class="paragraph">
<p>Beside neighbor discovery NDP is also used for a couple of other things, like
autoconfiguration and advertising routers.</p></div>
<div class="paragraph">
<p>By default VMs are allowed to send out router solicitation messages (to query
for a router), and to receive router advertisement packets. This allows them to
use stateless auto configuration. On the other hand VMs cannot advertise
themselves as routers unless the &#8220;Allow Router Advertisement&#8221; (<span class="monospaced">radv: 1</span>) option
is set.</p></div>
<div class="paragraph">
<p>As for the link local addresses required for NDP, there&#8217;s also an &#8220;IP Filter&#8221;
(<span class="monospaced">ipfilter: 1</span>) option which can be enabled which has the same effect as adding
an <span class="monospaced">ipfilter-net*</span> ipset for each of the VM&#8217;s network interfaces containing the
corresponding link local addresses.  (See the
<a href="/pve-docs/chapter-pve-firewall.html#pve_firewall_ipfilter_section">Standard IP set <span class="monospaced">ipfilter-net*</span></a> section for details.)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_ports_used_by_proxmox_ve">Ports used by Proxmox VE</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Web interface: 8006
</p>
</li>
<li>
<p>
VNC Web console: 5900-5999
</p>
</li>
<li>
<p>
SPICE proxy: 3128
</p>
</li>
<li>
<p>
sshd (used for cluster actions): 22
</p>
</li>
<li>
<p>
rpcbind: 111
</p>
</li>
<li>
<p>
corosync multicast (if you run a cluster): 5404, 5405 UDP
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 5.2<br>
Last updated
 Mon May 14 12:47:00 UTC 2018
</div>
</div>
</body>
</html>
